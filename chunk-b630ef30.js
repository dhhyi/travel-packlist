import{b as Pt,c as ft,d as Fe}from"./chunk-d561ae35.js";import{A as St,b as st,c as Le,d as dt,e as ut,i as ct,p as Et,r as ge,s as Tt,v as Oe,y as mt,z as pt}from"./chunk-b7386d12.js";import{b as oe,c as Ee,d as _e,e as Me,g as Lt,h as he,j as be,k as $e,l as gt,m as Ot,n as It,o as ve,p as Nt,q as De}from"./chunk-e44d150d.js";import{a as Rt,b as Ct,d as J,e as Q,f as Z,g as Ie,h as K,i as de,j as Ne,k as ue,l as ce,m as ie,o as ne,p as At,s as L}from"./chunk-48ddef1f.js";import"./chunk-2c5cb6d3.js";import{j as Ge,k as fe}from"./chunk-daf74bd7.js";import{$b as tt,Ab as D,Ac as M,B as me,Bb as V,Bc as h,Cc as k,Dc as at,Eb as He,Fb as p,Gb as G,Lb as A,Mb as Y,Nb as H,Oa as s,Ob as Se,Pb as m,Q as Be,Qa as j,Qb as ee,Rb as l,Sb as Je,Tb as Ze,U as ze,Va as ye,Vb as F,Wb as te,Xb as Re,Y as We,Za as N,Zb as z,_b as et,ac as w,ba as R,bc as ae,cc as se,db as je,ec as it,fc as nt,ga as E,gc as ot,ha as T,hc as _t,ic as Ce,jc as Ae,lc as rt,n as Te,nc as lt,pb as pe,qb as u,r as we,rb as c,rc as Pe,sb as le,tb as Ye,ub as q,vb as X,wb as f,wc as C,x as ke,xb as d,xc as x,yb as a,zb as $}from"./chunk-864a163a.js";import"./chunk-e39c6cd7.js";var Ve=(()=>{class n{parser=R(ne);state=R(L);questions=this.state.clipboard.questions;items=this.state.clipboard.items;itemsCount=C(()=>this.items().length);questionsCount=C(()=>this.questions().length);cutQuestion(e){this.questions.update(t=>[...t,e.toString()]);}cutItem(e){this.items.update(t=>[...t,e.toString()]);}paste(){let e={questions:this.questions().map(t=>this.parser.parseQuestion(t)),items:this.items().map(t=>this.parser.parseItem(t))};return this.questions.set([]),this.items.set([]),e;}static ɵfac=function(t){return new(t||n)();};static ɵprov=We({token:n,factory:n.ɵfac,providedIn:"root"});}return n;})();var xt=["content"],Ut=["keyword"],wt=["variable"],yt=["select"],Gt=n=>({width:n});function Ft(n,_){if(n&1&&(D(0,"span",5),w(1),V()),n&2){let e=_.$implicit;s(),ae(e);}}function Qt(n,_){if(n&1&&(D(0,"span",6),w(1),V()),n&2){let e=_.$implicit,t=l();z("text-green",t.highlighVariable()&&t.variableActive(e))("text-red",t.highlighVariable()&&!t.variableActive(e)),s(),ae(e);}}function Kt(n,_){if(n&1&&(D(0,"option",8),w(1),V()),n&2){let e=l(2).$implicit,t=l();G("value",t.NOT),s(),se("NOT ",t.variablePlaceholder(e));}}function qt(n,_){if(n&1&&(D(0,"option",8),w(1),V()),n&2){let e=l(2).$implicit,t=l();G("value",t.AND),s(),se("",t.variablePlaceholder(e)," AND x");}}function Xt(n,_){if(n&1&&(D(0,"option",8),w(1),V()),n&2){let e=l(2).$implicit,t=l();G("value",t.OR),s(),se("",t.variablePlaceholder(e)," OR x");}}function kt(n,_){if(n&1&&(D(0,"option",8),w(1,"REMOVE"),V()),n&2){let e=l(4);G("value",e.REMOVE);}}function Bt(n,_){if(n&1&&u(0,kt,2,1,"option",8),n&2){let e=l(2).$implicit,t=l();c(e!==t.PLEASE_SELECT?0:-1);}}function zt(n,_){if(n&1&&(D(0,"option",9),w(1),V()),n&2){let e=l().$implicit,t=l().$implicit,i=l();G("value",e)("selected",t===e)("disabled",e===i.PLEASE_SELECT),s(),se(" ",e," ");}}function Wt(n,_){if(n&1&&u(0,Kt,2,2,"option",8)(1,qt,2,2,"option",8)(2,Xt,2,2,"option",8)(3,Bt,1,1)(4,zt,2,4,"option",9),n&2){let e,t=_.$implicit,i=l(2);c((e=t)===i.NOT?0:e===i.AND?1:e===i.OR?2:e===i.REMOVE?3:4);}}function jt(n,_){if(n&1){let e=p();D(0,"select",7,4),ee("change",function(){let i=E(e),o=i.$implicit,r=i.selection,S=Re(1);return T(r(S.value,o));}),q(2,Wt,5,1,null,null,le),V();}if(n&2){let e=_.options,t=_.width;et(rt(2,Gt,t)),s(2),X(e);}}var Qe="NOT",Ke="AND",qe="OR",Xe="REMOVE",Mt=(()=>{class n{condition=h.required();selectVariables=h.required();content=k.required("content",{read:ye});keywordTemplate=k.required("keyword",{read:j});variableTemplate=k.required("variable",{read:j});selectTemplate=k.required("select",{read:j});state=R(L);activeAnswers=this.state.active.answers;mode=this.state.router.rulesMode;highlighVariable=C(()=>this.mode()!=="edit"&&this.state.config.highlightVariableStatus());ALWAYS=de.string;PLEASE_SELECT=K.string;NOT=Qe;AND=Ke;OR=qe;REMOVE=Xe;conditionChanged=M();constructor(){x(()=>{this.mode(),this.condition(),this.selectVariables(),this.repaint();});}repaint(){this.content().clear(),this.paintKeyword("IF"),this.paintCondition(this.condition(),e=>{e?this.conditionChanged.emit(e):this.conditionChanged.emit(new K());});}calculateOptions(e){return[this.PLEASE_SELECT,this.ALWAYS,...this.selectVariables(),this.NOT,this.AND,this.OR,this.REMOVE].filter(t=>!e.includes(t));}createFromPrevious(e){return e===this.PLEASE_SELECT||e===this.ALWAYS?new K():new Ie(e);}selection(e,t){return e===this.NOT?new Ne(this.createFromPrevious(t)):e===this.AND?new ue(this.createFromPrevious(t),new K()):e===this.OR?new ce(this.createFromPrevious(t),new K()):e===this.REMOVE?null:e===this.ALWAYS?new de():new Ie(e);}paintKeyword(e){this.content().createEmbeddedView(this.keywordTemplate(),{$implicit:e});}paintSelect(e,t,i){this.content().createEmbeddedView(this.selectTemplate(),{$implicit:e,options:this.calculateOptions(i),selection:(o,r)=>{t(this.selection(o,r));},width:(e.length*9+30).toString()+"px"});}paintVariable(e){this.content().createEmbeddedView(this.variableTemplate(),{$implicit:e});}paintCondition(e,t,i=[]){if(e instanceof Ne){let o=i.filter(r=>r!==this.ALWAYS);this.paintKeyword("NOT"),this.paintCondition(e.not,r=>{t(r?new Ne(r):null);},o);}else if(e instanceof ue){let o=[...i,this.ALWAYS];this.paintCondition(e.left,r=>{t(r?new ue(r,e.right):e.right);},o),this.paintKeyword("AND"),this.paintCondition(e.right,r=>{t(r?new ue(e.left,r):e.left);},o);}else if(e instanceof ce){let o=[...i,this.ALWAYS];this.paintCondition(e.left,r=>{t(r?new ce(r,e.right):e.right);},o),this.paintKeyword("OR"),this.paintCondition(e.right,r=>{t(r?new ce(e.left,r):e.left);},o);}else e instanceof Ie&&(this.mode()==="edit"?this.paintSelect(e.variable,t,i):this.paintVariable(e.variable));}variableActive(e){return this.activeAnswers()[e];}variablePlaceholder(e){return e===this.ALWAYS||e===this.PLEASE_SELECT?"x":e;}static ɵfac=function(t){return new(t||n)();};static ɵcmp=N({type:n,selectors:[["app-editor-condition"]],viewQuery:function(t,i){t&1&&(F(i.content,xt,5,ye),F(i.keywordTemplate,Ut,5,j),F(i.variableTemplate,wt,5,j),F(i.selectTemplate,yt,5,j)),t&2&&te(4);},hostAttrs:[1,"flex","flex-row","flex-wrap","items-center","justify-start","gap-2"],inputs:{condition:[1,"condition"],selectVariables:[1,"selectVariables"]},outputs:{conditionChanged:"conditionChanged"},decls:8,vars:0,consts:()=>{let e;return e="variable",[["content",""],["keyword",""],["variable",""],["select",""],["selectbox",""],["role","text",1,"font-bold"],[1,"font-mono","font-bold"],["role","combobox","aria-label",e,1,"font-mono",3,"change"],[3,"value"],[3,"value","selected","disabled"]];},template:function(t,i){t&1&&(He(0,null,0),je(2,Ft,2,1,"ng-template",null,1,Pe)(4,Qt,2,5,"ng-template",null,2,Pe)(6,jt,4,4,"ng-template",null,3,Pe));},encapsulation:2,changeDetection:0});}return n;})();function Yt(n,_){if(n&1&&(d(0,"option",4),w(1),a()),n&2){let e=_.$implicit;f("value",e),s(),ae(e);}}function Ht(n,_){n&1&&(d(0,"span"),A(1,0),a()),n&2&&(s(),Y(_),H(1));}function Jt(n,_){n&1&&(d(0,"span"),A(1,1),a());}function Zt(n,_){if(n&1&&(u(0,Ht,2,1,"span"),u(1,Jt,2,0,"span")),n&2){let e,t=l(2);c((e=t.form.controls.name.errors==null?null:t.form.controls.name.errors.pattern)?0:-1,e),s(),c(t.form.controls.name.errors!=null&&t.form.controls.name.errors.required?1:-1);}}function ei(n,_){if(n&1&&(d(0,"div",7),u(1,Zt,2,2),a()),n&2){let e=l();s(),c(e.form.controls.name.touched?1:-1);}}var bt=(()=>{class n{item=h.required();state=R(L);mode=this.state.router.rulesMode;categories=this.state.rules.categories;itemChanged=M();fb=R(ve).nonNullable;form=this.fb.group({category:this.fb.control(""),name:this.fb.control("",{validators:[this.validateNamePattern(),Ee.required.bind(this)]})});parser=R(ne);constructor(){x(()=>{this.item(),this.reset();});let e=fe(this.form.valueChanges.pipe(me(()=>this.form.valid)));x(()=>{let t=e();if(!t?.name)return;if(!t.category){this.addNewCategory();return;}let i=new Z(t.category,t.name).toString();this.itemChanged.emit(this.parser.parseItem(i));}),x(()=>{this.mode()==="edit"?this.form.enable({emitEvent:!1}):this.form.disable({emitEvent:!1}),this.reset();});}blockPatch=!1;reset(){if(!this.blockPatch){let e=this.item().name;this.item().weight&&(e+=` ${Ct(this.item().weight)}`),this.form.patchValue({category:this.item().category,name:e},{emitEvent:!1});}}focus(e){this.blockPatch=document.activeElement===e.target,this.form.controls.name.value===Z.NEW_ITEM_NAME&&this.form.controls.name.setValue("",{emitEvent:!1});}blur(){this.blockPatch=!1,this.reset();}async addNewCategory(e=""){let t=await ft("Enter new category name",e);if(t)try{this.parser.validateCategoryName(t),this.form.patchValue({category:t});}catch(i){if(i instanceof ie){let o=i.found;await Fe("Category name cannot contain '"+o+"'");}else await Fe("Invalid category name");this.addNewCategory(t);}else this.reset();}validateNamePattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateItemNameAndWeight(t),null;}catch(i){return i instanceof ie?{pattern:i.found}:{pattern:!0};}};}static ɵfac=function(t){return new(t||n)();};static ɵcmp=N({type:n,selectors:[["app-editor-item"]],inputs:{item:[1,"item"]},outputs:{itemChanged:"itemChanged"},decls:8,vars:2,consts:()=>{let e;e="item";let t;t="category";let i;i="item name";let o;o="Item name cannot contain the character '"+"\uFFFD0\uFFFD"+"'";let r;return r="Item name is required",[o,r,["role","group","aria-label",e,1,"flex",3,"formGroup"],["name","categories","formControlName","category","aria-label",t,1,"max-w-[5rem]"],[3,"value"],["value",""],["type","text","formControlName","name","aria-label",i,1,"w-0","flex-1",3,"focus","blur"],["role","alert",1,"text-red-light","m-1","text-sm"]];},template:function(t,i){t&1&&(d(0,"form",2)(1,"select",3),q(2,Yt,2,2,"option",4,Ye),d(4,"option",5),w(5,"+"),a()(),d(6,"input",6),m("focus",function(r){return i.focus(r);})("blur",function(){return i.blur();}),a()(),u(7,ei,2,1,"div",7)),t&2&&(f("formGroup",i.form),s(2),X(i.categories()),s(5),c(i.mode()==="edit"&&i.form.valid===!1&&i.form.dirty?7:-1));},dependencies:[De,he,Ot,It,oe,gt,_e,Me,be,$e],encapsulation:2,changeDetection:0});}return n;})();function ti(n,_){n&1&&(d(0,"span"),A(1,0),a()),n&2&&(s(),Y(_),H(1));}function ii(n,_){n&1&&(d(0,"span"),A(1,1),a());}function ni(n,_){n&1&&(d(0,"span"),A(1,2),a());}function oi(n,_){if(n&1&&(d(0,"span"),A(1,3),a()),n&2){let e=l();s(),Y(e),H(1);}}function _i(n,_){n&1&&u(0,ni,2,0,"span")(1,oi,2,1,"span"),n&2&&c(_===" "?0:1);}function ri(n,_){n&1&&(d(0,"span"),A(1,4),a());}function li(n,_){n&1&&(d(0,"span"),A(1,5),a());}function ai(n,_){n&1&&(d(0,"span"),A(1,6),a());}function si(n,_){if(n&1&&(d(0,"div",12),u(1,ti,2,1,"span"),u(2,ii,2,0,"span"),u(3,_i,2,1),u(4,ri,2,0,"span"),u(5,li,2,0,"span"),u(6,ai,2,0,"span"),a()),n&2){let e,t,i=l();s(),c((e=i.form.controls.question.errors==null?null:i.form.controls.question.errors.pattern)?1:-1,e),s(),c(i.form.controls.question.errors!=null&&i.form.controls.question.errors.required?2:-1),s(),c((t=i.form.controls.variable.errors==null?null:i.form.controls.variable.errors.pattern)?3:-1,t),s(),c(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.required?4:-1),s(),c(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.reserved?5:-1),s(),c(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.used?6:-1);}}var $t=(()=>{class n{question=h.required();parser=R(ne);state=R(L);variables=this.state.rules.variables;mode=this.state.router.rulesMode;highlighVariable=C(()=>this.mode()!=="edit"&&this.state.config.highlightVariableStatus());variableActive=C(()=>this.state.active.answers()[this.question().variable]);refactorVariables=this.state.config.refactorVariables;questionChanged=M();variableChanged=M();fb=R(ve).nonNullable;form=this.fb.group({question:this.fb.control("",{validators:[this.validateQuestionPattern(),Ee.required.bind(this)]}),variable:this.fb.control("",{validators:[this.validateVariablePattern(),di(),Ee.required.bind(this)],asyncValidators:[ui(Ge(this.variables),Ge(this.question))]})});constructor(){x(()=>{this.question(),this.reset();});let e=fe(this.form.valueChanges.pipe(me(()=>this.form.valid)));x(()=>{let t=e();t?.question&&t.question!==this.question().question&&t.variable?this.questionChanged.emit(new Q(t.question,t.variable)):t?.variable&&t.variable.trim()!==this.question().variable&&(this.question().variable===Q.NEW_VARIABLE_NAME||!this.refactorVariables()?this.questionChanged.emit(new Q(this.question().question,t.variable.trim())):this.variableChanged.emit([this.question().variable,t.variable.trim()]));}),x(()=>{this.mode()==="edit"?this.form.enable({emitEvent:!1}):this.form.disable({emitEvent:!1}),this.reset();});}reset(){this.form.patchValue(this.question(),{emitEvent:!1});}focusQuestion(){this.form.controls.question.value===Q.NEW_QUESTION_NAME&&this.form.controls.question.setValue("",{emitEvent:!1});}focusVariable(){this.form.controls.variable.value===Q.NEW_VARIABLE_NAME&&this.form.controls.variable.setValue("",{emitEvent:!1});}validateVariablePattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateVariableName(t),null;}catch(i){return i instanceof ie?{pattern:i.found}:{pattern:!0};}};}validateQuestionPattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateQuestionString(t),null;}catch(i){return i instanceof ie?{pattern:i.found}:{pattern:!0};}};}static ɵfac=function(t){return new(t||n)();};static ɵcmp=N({type:n,selectors:[["app-editor-question"]],inputs:{question:[1,"question"]},outputs:{questionChanged:"questionChanged",variableChanged:"variableChanged"},decls:6,vars:6,consts:()=>{let e;e="question";let t;t="question";let i;i="question";let o;o="variable";let r;r="variable";let S;S="Questions cannot contain this character: '"+"\uFFFD0\uFFFD"+"'";let g;g="Question is required";let P;P="Variables cannot contain spaces";let v;v="Variables cannot contain this character: '"+"\uFFFD0\uFFFD"+"'";let U;U="Variable name is required";let y;y="This variable name is reserved";let B;return B="This variable name is already used",[S,g,P,v,U,y,B,["role","group","aria-label",e,1,"flex","flex-col",3,"formGroup"],["type","text","placeholder",t,"aria-label",i,"formControlName","question",1,"grow",3,"focus"],[1,"flex","items-center","gap-2"],[1,"ml-2","h-4"],["type","text","placeholder",o,"aria-label",r,"formControlName","variable",1,"grow","font-mono","font-bold",3,"focus"],["role","alert",1,"text-red","m-1","flex","flex-col","text-sm"]];},template:function(t,i){t&1&&(d(0,"form",7)(1,"input",8),m("focus",function(){return i.focusQuestion();}),a(),d(2,"div",9),$(3,"app-icon-arrow-forward",10),d(4,"input",11),m("focus",function(){return i.focusVariable();}),a()(),u(5,si,7,6,"div",12),a()),t&2&&(f("formGroup",i.form),s(4),z("text-green",i.highlighVariable()&&i.variableActive())("text-red",i.highlighVariable()&&!i.variableActive()),s(),c(i.mode()==="edit"&&i.form.valid===!1&&i.form.dirty?5:-1));},dependencies:[De,he,oe,_e,Me,be,$e,pt],encapsulation:2,changeDetection:0});}return n;})();function di(){return n=>[de.string,Qe,Ke,qe,Xe].some(_=>_===n.value?.trim())?{reserved:!0}:null;}function ui(n,_){return e=>Te(e.value).pipe(ze(n.pipe(we(t=>[...t])),_),Be(([t,i,o])=>ke(()=>!i.find(r=>r===o.variable),Te(null),Te([t,i,o]).pipe(we(([r,S,g])=>{let P=S.findIndex(v=>v===g.variable);return S.splice(P,1),S.includes(r?.trim()??"")?{used:!0}:null;})))));}function ci(n,_){if(n&1){let e=p();d(0,"button",8),m("click",function(){E(e);let i=l();return T(i.resetCondition());}),a();}}function Ei(n,_){if(n&1){let e=p();d(0,"button",15),m("click",function(){E(e);let i=l(2).$index,o=l();return T(o.swapQuestions(i,i+1));}),a();}}function Ti(n,_){n&1&&$(0,"span",14);}function mi(n,_){if(n&1&&u(0,Ei,1,0,"button",13)(1,Ti,1,0,"span",14),n&2){let e=l(),t=e.$index,i=e.$count;c(t!==i-1?0:1);}}function pi(n,_){if(n&1){let e=p();d(0,"button",16),m("click",function(){E(e);let i=l().$index,o=l();return T(o.deleteQuestion(i));}),a();}}function Si(n,_){if(n&1){let e=p();d(0,"button",17),m("click",function(){E(e);let i=l().$index,o=l();return T(o.cutQuestion(i));}),a();}}function Ri(n,_){if(n&1){let e=p();d(0,"button",18),m("click",function(){E(e);let i=l().$index,o=l();return T(o.swapQuestions(i-1,i));}),a();}}function Ci(n,_){if(n&1){let e=p();d(0,"div",5),u(1,mi,2,1),d(2,"app-editor-question",9),m("questionChanged",function(i){let o=E(e).$index,r=l();return T(r.updateQuestion(o,i));})("variableChanged",function(i){E(e);let o=l();return T(o.variableChanged(i));}),a(),u(3,pi,1,0,"button",10)(4,Si,1,0,"button",11)(5,Ri,1,0,"button",12),a();}if(n&2){let e=_.$implicit,t=_.$index,i=_.$index,o=_.$count,r=l();s(),c(r.mode()==="swap"&&o>1?1:-1),s(),f("id",`r${r.index()}q${t}`)("question",e),s(),c(r.mode()==="delete"?3:r.mode()==="cut-paste"?4:r.mode()==="swap"&&i!==0?5:-1);}}function Ai(n,_){if(n&1){let e=p();d(0,"button",24),m("click",function(){E(e);let i=l(2).$index,o=l();return T(o.swapItems(i,i+1));}),a();}}function Pi(n,_){n&1&&$(0,"span",14);}function fi(n,_){if(n&1&&u(0,Ai,1,0,"button",23)(1,Pi,1,0,"span",14),n&2){let e=l(),t=e.$index,i=e.$count;c(t!==i-1?0:1);}}function Li(n,_){if(n&1){let e=p();d(0,"button",25),m("click",function(){E(e);let i=l().$index,o=l();return T(o.deleteItem(i));}),a();}}function gi(n,_){if(n&1){let e=p();d(0,"button",26),m("click",function(){E(e);let i=l().$index,o=l();return T(o.cutItem(i));}),a();}}function Oi(n,_){if(n&1){let e=p();d(0,"button",27),m("click",function(){E(e);let i=l().$index,o=l();return T(o.swapItems(i-1,i));}),a();}}function Ii(n,_){if(n&1){let e=p();d(0,"div",5),u(1,fi,2,1),d(2,"app-editor-item",19),m("itemChanged",function(i){let o=E(e).$index,r=l();return T(r.updateItem(o,i));}),a(),u(3,Li,1,0,"button",20)(4,gi,1,0,"button",21)(5,Oi,1,0,"button",22),a();}if(n&2){let e=_.$implicit,t=_.$index,i=_.$index,o=_.$count,r=l();s(),c(r.mode()==="swap"&&o>1?1:-1),s(),f("id",`r${r.index()}i${t}`)("item",e),s(),c(r.mode()==="delete"?3:r.mode()==="cut-paste"?4:r.mode()==="swap"&&i!==0?5:-1);}}function Ni(n,_){if(n&1){let e=p();d(0,"div",6)(1,"button",28),m("click",function(){E(e);let i=l();return T(i.addQuestion());}),A(2,0),a(),d(3,"button",29),m("click",function(){E(e);let i=l();return T(i.addItem());}),A(4,1),a()();}}function Mi(n,_){if(n&1){let e=p();d(0,"button",32),m("click",function(){E(e);let i=l(2);return T(i.delete());}),a();}}function hi(n,_){if(n&1){let e=p();d(0,"button",33),m("click",function(){E(e);let i=l(2);return T(i.paste());}),a();}}function bi(n,_){if(n&1&&(d(0,"div",7),u(1,Mi,1,0,"button",30),u(2,hi,1,0,"button",31),a()),n&2){let e=l();s(),c(e.mode()==="delete"?1:-1),s(),c(e.mode()==="cut-paste"?2:-1);}}var vt=(()=>{class n{index=h.required();rule=h.required();ruleChanged=M();deleteRule=M();renameVariable=M();state=R(L);mode=this.state.router.rulesMode;selectVariables=C(()=>{let e=this.rule().questions.map(i=>i.variable);return this.state.rules.variables().filter(i=>!e.includes(i));});confirmRuleDeletion=this.state.config.confirmRuleDeletion;clipboard=R(Ve);resetCondition(){this.updateCondition(new K());}updateCondition(e){let t=new J(e,this.rule().questions,this.rule().items);this.ruleChanged.emit(t);}emitNewQuestions(e){let t=new J(this.rule().condition,e,this.rule().items);this.ruleChanged.emit(t);}updateQuestion(e,t){let i=this.rule().questions;i[e]=t,this.emitNewQuestions(i);}addQuestion(){let e=new Q(Q.NEW_QUESTION_NAME,Q.NEW_VARIABLE_NAME),t=this.rule().questions.length;this.updateQuestion(t,e),this.state.router.fragment.set(`r${this.index().toString()}q${t.toString()}`);}deleteQuestion(e){let t=this.rule().questions;t.splice(e,1),this.emitNewQuestions(t);}cutQuestion(e){let t=this.rule().questions[e];this.deleteQuestion(e),this.clipboard.cutQuestion(t);}swapQuestions(e,t){let i=this.rule().questions,o=i[e];i[e]=i[t],i[t]=o,this.emitNewQuestions(i);}emitNewItems(e){let t=new J(this.rule().condition,this.rule().questions,e);this.ruleChanged.emit(t);}updateItem(e,t){let i=this.rule().items;i[e]=t,this.emitNewItems(i);}addItem(){let e=new Z(Z.NEW_CATEGORY_NAME,Z.NEW_ITEM_NAME),t=this.rule().items.length;this.updateItem(t,e),this.state.router.fragment.set(`r${this.index().toString()}i${t.toString()}`);}deleteItem(e){let t=this.rule().items;t.splice(e,1),this.emitNewItems(t);}cutItem(e){let t=this.rule().items[e];this.deleteItem(e),this.clipboard.cutItem(t);}swapItems(e,t){let i=this.rule().items,o=i[e];i[e]=i[t],i[t]=o,this.emitNewItems(i);}paste(){let{questions:e,items:t}=this.clipboard.paste(),i=new J(this.rule().condition,[...this.rule().questions,...e],[...this.rule().items,...t]);this.ruleChanged.emit(i);}variableChanged([e,t]){this.renameVariable.emit([e,t]);}async delete(){(!this.confirmRuleDeletion()||(await Pt("Do you really want to delete this rule?")))&&this.deleteRule.emit();}static ɵfac=function(t){return new(t||n)();};static ɵcmp=N({type:n,selectors:[["app-editor-rule"]],inputs:{index:[1,"index"],rule:[1,"rule"]},outputs:{ruleChanged:"ruleChanged",deleteRule:"deleteRule",renameVariable:"renameVariable"},decls:9,vars:4,consts:()=>{let e;e="condition";let t;t="reset condition";let i;i="delete question";let o;o="cut question";let r;r="move question up";let S;S="move question down";let g;g="delete item";let P;P="cut item";let v;v="move item up";let U;U="move item down";let y;y="add question";let B;B="add item";let O;O=" + Question ";let re;re=" + Item ";let I;I="delete rule";let Ue;return Ue="paste from clipboard",[O,re,["aria-label",e,"role","group",1,"mb-1","flex","items-center"],[1,"accessible-content","grow",3,"conditionChanged","condition","selectVariables"],["iconClear","","type","button","aria-label",t,1,"link"],[1,"mb-1","flex","items-center"],[1,"flex","justify-end","gap-2"],[1,"flex","justify-center"],["iconClear","","type","button","aria-label",t,1,"link",3,"click"],[1,"w-0","grow",3,"questionChanged","variableChanged","id","question"],["iconDelete","","type","button","aria-label",i,1,"link"],["iconCut","","type","button","aria-label",o,1,"link"],["iconArrowUpward","","type","button","aria-label",r,1,"link","p-1"],["iconArrowDownward","","type","button","aria-label",S,1,"link","p-1"],[1,"ml-6"],["iconArrowDownward","","type","button","aria-label",S,1,"link","p-1",3,"click"],["iconDelete","","type","button","aria-label",i,1,"link",3,"click"],["iconCut","","type","button","aria-label",o,1,"link",3,"click"],["iconArrowUpward","","type","button","aria-label",r,1,"link","p-1",3,"click"],[1,"grow",3,"itemChanged","id","item"],["iconDelete","","type","button","aria-label",g,1,"link"],["iconCut","","type","button","aria-label",P,1,"link"],["iconArrowUpward","","type","button","aria-label",v,1,"link","p-1"],["iconArrowDownward","","type","button","aria-label",U,1,"link","p-1"],["iconArrowDownward","","type","button","aria-label",U,1,"link","p-1",3,"click"],["iconDelete","","type","button","aria-label",g,1,"link",3,"click"],["iconCut","","type","button","aria-label",P,1,"link",3,"click"],["iconArrowUpward","","type","button","aria-label",v,1,"link","p-1",3,"click"],["type","button","aria-label",y,1,"h-8",3,"click"],["type","button","aria-label",B,1,"h-8",3,"click"],["iconDelete","","type","button","aria-label",I,1,"link"],["iconPaste","","type","button","aria-label",Ue,1,"link"],["iconDelete","","type","button","aria-label",I,1,"link",3,"click"],["iconPaste","","type","button","aria-label",Ue,1,"link",3,"click"]];},template:function(t,i){t&1&&(d(0,"div",2)(1,"app-editor-condition",3),m("conditionChanged",function(r){return i.updateCondition(r);}),a(),u(2,ci,1,0,"button",4),a(),q(3,Ci,6,4,"div",5,le),q(5,Ii,6,4,"div",5,le),u(7,Ni,5,0,"div",6)(8,bi,3,2,"div",7)),t&2&&(s(),f("condition",i.rule().condition)("selectVariables",i.selectVariables()),s(),c(i.mode()==="edit"?2:-1),s(),X(i.rule().questions),s(2),X(i.rule().items),s(2),c(i.mode()==="edit"?7:8));},dependencies:[Mt,$t,bt,ge,Tt,ct,Oe,St,mt],encapsulation:2,changeDetection:0});}return n;})();function $i(n,_){if(n&1){let e=p();D(0,"input",2,0),ee("input",function(){E(e);let i=Re(1),o=l();return T(o.changed(i.value));}),V();}if(n&2){let e=l();G("disabled",!e.isEditMode())("value",e.currentTitle()??"");}}var Dt=(()=>{class n{state=R(L);isEditMode=C(()=>this.state.router.rulesMode()==="edit");currentTitle=C(()=>this.state.rules.parsed.value().title);visible=C(()=>this.isEditMode()||!!this.currentTitle());titleChange=M();titleDebounce;changed(e){e!=this.currentTitle()&&(this.titleDebounce&&clearTimeout(this.titleDebounce),this.titleDebounce=setTimeout(()=>{this.titleChange.emit(e||void 0);},500));}static ɵfac=function(t){return new(t||n)();};static ɵcmp=N({type:n,selectors:[["app-editor-title"]],outputs:{titleChange:"titleChange"},decls:1,vars:1,consts:()=>{let e;e="title";let t;return t="Rules Title",[["title",""],["type","text","id","rules-title","placeholder",e,"aria-label",t,1,"card","my-1","w-full","outline-hidden",3,"disabled","value"],["type","text","id","rules-title","placeholder",e,"aria-label",t,1,"card","my-1","w-full","outline-hidden",3,"input","disabled","value"]];},template:function(t,i){t&1&&u(0,$i,2,2,"input",1),t&2&&c(i.visible()?0:-1);},encapsulation:2,changeDetection:0});}return n;})();var vi=["button"],Di=["*"],xe=(()=>{class n{state=R(L);mode=this.state.router.rulesMode;type=h.required();label=h.required();disabled=h(!1);button=k("button");focusPrevious=M();focusNext=M();focus(){let e=this.button();e&&(e.nativeElement.focus(),this.mode.set(this.type()));}static ɵfac=function(t){return new(t||n)();};static ɵcmp=N({type:n,selectors:[["app-toolbar-button"]],viewQuery:function(t,i){t&1&&F(i.button,vi,5),t&2&&te();},inputs:{type:[1,"type"],label:[1,"label"],disabled:[1,"disabled"]},outputs:{focusPrevious:"focusPrevious",focusNext:"focusNext"},ngContentSelectors:Di,decls:3,vars:6,consts:[["button",""],["type","button","role","radio",1,"link","h-full","w-full",3,"click","keypress","keydown.arrowLeft","keydown.arrowRight","tabIndex","disabled"]],template:function(t,i){if(t&1){let o=p();Je(),D(0,"button",1,0),ee("click",function(){return E(o),T(i.mode.set(i.type()));})("keypress",function(){return E(o),T(i.mode.set(i.type()));})("keydown.arrowLeft",function(){return E(o),T(i.focusPrevious.emit());})("keydown.arrowRight",function(){return E(o),T(i.focusNext.emit());}),Ze(2),V();}t&2&&(z("active",i.mode()===i.type()),G("tabIndex",i.mode()===i.type()?0:-1)("disabled",i.disabled()),pe("aria-label",i.label())("aria-checked",i.mode()===i.type()));},encapsulation:2,changeDetection:0});}return n;})();var Vi=["searchInput"];function xi(n,_){if(n&1&&(d(0,"div",12),A(1,1),a()),n&2){l();let e=Ae(0),t=Ae(1),i=Ae(2);s(),Y(e)(e)(i)(t)(t),H(1);}}function Ui(n,_){if(n&1&&(_t(0)(1)(2),u(3,xi,2,5,"div",12)),n&2){let e=l(),t=Ce(e.clipboardItems());s();let i=Ce(e.clipboardQuestions());s(),Ce(!!t&&!!i),s(),c(t>0||i>0?3:-1);}}function wi(n,_){if(n&1){let e=p();d(0,"div",11)(1,"input",13,0),ot("ngModelChange",function(i){E(e);let o=l();return nt(o.searchTerm,i)||(o.searchTerm=i),T(i);}),a(),d(3,"button",14),m("click",function(){E(e);let i=l();return T(i.clearSearch());}),a()();}if(n&2){let e=l();s(),it("ngModel",e.searchTerm);}}var Vt=(()=>{class n{toolbarButtons=at(xe);noOfVisibleRules=h.required();state=R(L);mode=this.state.router.rulesMode;editable=C(()=>this.state.rules.mode()==="local");searchTerm=this.state.router.filterRulesQuery;clipboard=R(Ve);clipboardItems=this.clipboard.itemsCount;clipboardQuestions=this.clipboard.questionsCount;sticky=C(()=>this.state.browser.scrollY()>48);searchInput=k.required("searchInput");constructor(){x(()=>{this.toolbarButtons().forEach(e=>{e.focusNext.subscribe(()=>{this.focusNext();}),e.focusPrevious.subscribe(()=>{this.focusPrevious();});});});}focusNext(){let e=this.toolbarButtons(),t=e.length,i=e.findIndex(o=>o.type()===this.mode());if(i!==-1){let o=(i+1)%t;e[o].focus();}}focusPrevious(){let e=this.toolbarButtons(),t=e.length,i=e.findIndex(o=>o.type()===this.mode());if(i!==-1){let o=(i-1+t)%t;e[o].focus();}}focusSearch(){setTimeout(()=>{this.searchInput().nativeElement.focus();},50);}clearSearch(){this.searchTerm.set(""),this.focusSearch();}static ɵfac=function(t){return new(t||n)();};static ɵcmp=N({type:n,selectors:[["app-toolbar"]],viewQuery:function(t,i){t&1&&(F(i.toolbarButtons,xe,5),F(i.searchInput,Vi,5)),t&2&&te(2);},inputs:{noOfVisibleRules:[1,"noOfVisibleRules"]},decls:16,vars:7,consts:()=>{let e;e="Editor Mode";let t;t="View";let i;i="Edit";let o;o="Delete";let r;r="Cut/Paste";let S;S="Swap";let g;g="Search";let P;P="clipboard";let v;v="{VAR_PLURAL, plural, =0 {} one {1 Item} other {{INTERPOLATION} Items}}",v=Se(v,{INTERPOLATION:"\uFFFD1\uFFFD",VAR_PLURAL:"\uFFFD0\uFFFD"});let U;U="{VAR_SELECT, select, true {and} other {}}",U=Se(U,{VAR_SELECT:"\uFFFD2\uFFFD"});let y;y="{VAR_PLURAL, plural, =0 {} one {1 Question} other {{INTERPOLATION} Questions}}",y=Se(y,{INTERPOLATION:"\uFFFD4\uFFFD",VAR_PLURAL:"\uFFFD3\uFFFD"});let B;B=" Clipboard: "+v+" "+U+" "+y+" ";let O;O="search in rules";let re;return re="clear search",[["searchInput",""],B,["role","toolbar","aria-orientation","horizontal",1,"bg-active","sticky","top-0","left-0","z-30","py-2"],["role","radiogroup","aria-label",e,1,"mb-1","grid","grid-cols-6","gap-2"],["type","view","label",t],[1,"my-auto","h-6","w-6"],["type","edit","label",i,3,"disabled"],["type","delete","label",o,3,"disabled"],["type","cut-paste","label",r,3,"disabled"],["type","swap","label",S,3,"disabled"],["type","search","label",g],[1,"mt-2","flex","items-center"],["role","status","aria-label",P,1,"mt-2","flex","justify-center","gap-4"],["type","text","role","searchbox","aria-label",O,1,"grow",3,"ngModelChange","ngModel"],["iconClear","","iconClass","h-6 w-6","type","button","aria-label",re,1,"link",3,"click"]];},template:function(t,i){t&1&&(d(0,"div",2)(1,"div",3)(2,"app-toolbar-button",4),$(3,"app-icon-view",5),a(),d(4,"app-toolbar-button",6),$(5,"app-icon-edit",5),a(),d(6,"app-toolbar-button",7),$(7,"app-icon-delete",5),a(),d(8,"app-toolbar-button",8),$(9,"app-icon-reorder",5),a(),d(10,"app-toolbar-button",9),$(11,"app-icon-swap",5),a(),d(12,"app-toolbar-button",10),$(13,"app-icon-search",5),a()(),u(14,Ui,4,4)(15,wi,4,1,"div",11),a()),t&2&&(z("shadow-md",i.sticky()),s(4),f("disabled",!i.editable()||!i.noOfVisibleRules()&&!!i.searchTerm()),s(2),f("disabled",!i.editable()||!i.noOfVisibleRules()),s(2),f("disabled",!i.editable()||i.noOfVisibleRules()<2&&!i.clipboardItems()&&!i.clipboardQuestions()),s(2),f("disabled",!i.editable()||!i.noOfVisibleRules()),s(4),c(i.mode()==="cut-paste"?14:i.mode()==="search"||i.searchTerm()?15:-1));},dependencies:[Nt,oe,_e,Lt,st,Et,ge,ut,Le,dt,Oe,xe],encapsulation:2,changeDetection:0});}return n;})();var yi=(n,_,e)=>({disabled:n,"mb-[2.25rem]":_,"mb-12":e}),Gi=(n,_)=>_.index;function Fi(n,_){if(n&1){let e=p();d(0,"button",10),m("click",function(){E(e);let i=l(2);return T(i.addRuleAndEdit());}),A(1,1),a();}}function Qi(n,_){if(n&1&&(d(0,"div",5)(1,"div",8)(2,"p"),A(3,0),a(),u(4,Fi,2,0,"button",9),a()()),n&2){let e=l();s(4),c(e.editable()?4:-1);}}function Ki(n,_){if(n&1){let e=p();d(0,"div",11)(1,"button",14),m("click",function(){E(e);let i=l().$implicit,o=l();return T(o.swapRules(i.index-1,i.index));}),a()();}}function qi(n,_){if(n&1){let e=p();u(0,Ki,2,0,"div",11),d(1,"div",12)(2,"app-editor-rule",13),m("ruleChanged",function(i){let o=E(e).$implicit,r=l();return T(r.updateRule(o.index,i));})("deleteRule",function(){let i=E(e).$implicit,o=l();return T(o.deleteRule(i.index));})("renameVariable",function(i){E(e);let o=l();return T(o.renameVariable(i));}),a()();}if(n&2){let e=_.$implicit,t=l();c(e.index>0&&t.mode()==="swap"&&!t.filter()?0:-1),s(),tt(lt(7,yi,t.showAsDisabled(e.rule),(t.mode()==="view"||t.mode()==="search")&&t.accessibility()==="compact",(t.mode()==="view"||t.mode()==="search")&&t.accessibility()==="accessible")),f("id",`rule-${e.index}`),pe("aria-label",t.ruleLabel(e.index)),s(),f("index",e.index)("rule",e.rule);}}function Xi(n,_){if(n&1){let e=p();d(0,"button",15),m("click",function(){E(e);let i=l();return T(i.addRule());}),A(1,2),a();}}function ki(n,_){if(n&1){let e=p();d(0,"a",16),m("click",function(){E(e);let i=l();return T(i.goToPacklist());}),$(1,"img",17),a();}}var co=(()=>{class n{refactor=R(At);state=R(L);parsedRules=this.state.rules.parsed.value;activeRules=this.state.active.rules;rulesTitle=C(()=>this.parsedRules().title);mode=this.state.router.rulesMode;accessibility=this.state.config.accessibility;filter=this.state.router.filterRulesQuery;editable=C(()=>this.state.rules.mode()==="local");visibleRules=C(()=>this.filter()===""?this.parsedRules().map((t,i)=>({rule:t,index:i})):this.parsedRules().map((t,i)=>({rule:t,index:i})).filter(t=>{let i=this.filter();return!i||this.refactor.contains(t.rule,i);}));goToPacklistButtonVisible=C(()=>this.state.browser.scrollY()>100);ruleLabel(e){return"Rule #"+(e+1).toString()+"";}updateRules(e,t){e.title=t;let i=Rt(e);this.state.localRules.updateRules(i);}updateTitle(e){this.updateRules(this.parsedRules(),e);}updateRule(e,t){let i=this.parsedRules();i[e]=t,this.updateRules([...i],this.rulesTitle());}deleteRule(e){let t=this.parsedRules();t.splice(e,1),this.updateRules([...t],this.rulesTitle());}addRule(){let e=this.parsedRules().length,t=[];for(let r=0;r<this.parsedRules().length;r++){let S=document.querySelector(`#rule-${r.toString()}`);if(S){let g=S.getBoundingClientRect();g.top>=0&&g.bottom<=window.innerHeight&&t.push(r);}}t.includes(e-1)||(e=t[0]+1);let i=new J(new K()),o=this.parsedRules();o.splice(e,0,i),this.updateRules([...o],this.rulesTitle()),this.state.router.fragment.set(`rule-${(e||0).toString()}`);}addRuleAndEdit(){this.addRule(),setTimeout(()=>{this.mode.set("edit");},0);}swapRules(e,t){let i=this.parsedRules(),o=i[e];i[e]=i[t],i[t]=o,this.updateRules([...i],this.rulesTitle());}showAsDisabled(e){return this.state.config.fadeOutDisabledRules()&&!this.activeRules().includes(e);}renameVariable([e,t]){let i=this.refactor.renameVariable(e,t,this.parsedRules());this.updateRules([...i],this.rulesTitle());}goToPacklist(){this.state.router.go("packlist");}static ɵfac=function(t){return new(t||n)();};static ɵcmp=N({type:n,selectors:[["app-rules"]],decls:7,vars:4,consts:()=>{let e;e="Add rule";let t;t="Add rule";let i;i="There are no rules defined.";let o;o=" + Rule ";let r;r="Swap rule above with rule below";let S;S=" + Rule ";let g;return g="application icon",[i,o,S,[3,"noOfVisibleRules"],[3,"titleChange"],[1,"flex","h-[calc(100vh-4rem)]","items-center","justify-center"],["aria-label",e,"type","button",1,"fixed","bottom-2","z-50"],["aria-hidden","true",1,"fixed","right-2","bottom-2","z-50"],[1,"flex","flex-col","items-center","gap-6"],["aria-label",t,"type","button"],["aria-label",t,"type","button",3,"click"],[1,"flex","justify-center"],["role","group","tabindex","0",1,"card","mb-1",3,"id"],[3,"ruleChanged","deleteRule","renameVariable","index","rule"],["iconSwap","","type","button","aria-label",r,1,"link",3,"click"],["aria-label",e,"type","button",1,"fixed","bottom-2","z-50",3,"click"],["aria-hidden","true",1,"fixed","right-2","bottom-2","z-50",3,"click"],["alt",g,"src","icon.svg",1,"h-12"]];},template:function(t,i){t&1&&($(0,"app-toolbar",3),d(1,"app-editor-title",4),m("titleChange",function(r){return i.updateTitle(r);}),a(),u(2,Qi,5,1,"div",5),q(3,qi,3,11,null,null,Gi),u(5,Xi,2,0,"button",6),u(6,ki,2,0,"a",7)),t&2&&(f("noOfVisibleRules",i.visibleRules().length),s(2),c(!i.visibleRules().length&&!i.filter()?2:-1),s(),X(i.visibleRules()),s(2),c(i.mode()==="edit"&&!i.filter()&&i.visibleRules().length?5:-1),s(),c(i.goToPacklistButtonVisible()?6:-1));},dependencies:[vt,Vt,Le,Dt],encapsulation:2,changeDetection:0});}return n;})();export{co as RulesComponent};/**i18n:02b940d651cca38199bf4688131265cf0357a49eef7b8ac774e63035febcc1d3*/