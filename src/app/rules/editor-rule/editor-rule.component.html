<div>
  <div>
    <app-editor-condition
      [variables]="variables()"
      [condition]="rule().condition"
      (conditionChanged)="updateCondition($event)"
    ></app-editor-condition>
    @if (mode.isMode("delete")) {
      <button (click)="resetCondition()">X</button>
    }
  </div>

  @for (question of rule().effects.questions; track $index) {
    <div>
      <app-editor-question
        [question]="question"
        (questionChanged)="updateQuestion($index, $event)"
      ></app-editor-question>
      @if (mode.isMode("delete")) {
        <button (click)="deleteQuestion($index)">X</button>
      } @else if (mode.isMode("cut-paste")) {
        <button (click)="cutQuestion($index)">C</button>
      }
    </div>
  }

  @for (item of rule().effects.items; track $index) {
    <div>
      <app-editor-item
        [item]="item"
        [categories]="categories()"
        (itemChanged)="updateItem($index, $event)"
      ></app-editor-item>
      @if (mode.isMode("delete")) {
        <button (click)="deleteItem($index)">X</button>
      } @else if (mode.isMode("cut-paste")) {
        <button (click)="cutItem($index)">C</button>
      }
    </div>
  }

  <div>
    @if (mode.isMode("delete")) {
      <button (click)="deleteRule()">Delete Rule</button>
    } @else if (mode.isMode("cut-paste")) {
      <button (click)="paste()">Paste</button>
    }
    @if (mode.isMode("edit")) {
      <button (click)="addQuestion()">+ Question</button>
      <button (click)="addItem()">+ Item</button>
    }
  </div>

  @if (errorMessage(); as error) {
    <pre>{{ error }}</pre>
    <pre>{{ ruleDebugString() }}</pre>
  }
</div>
