import{a as lt}from"./chunk-H2SPHNQA.js";import{c as it}from"./chunk-UESBYECV.js";import{b as W,c as k,d as K,e as de,f as nt,g as fe,j as Ce,k as ge,l as ot,m as rt,n as st,o as he,p as at,q as Ee,r as Qe,s as Te}from"./chunk-CBGKPZBP.js";import{a as X,b as P,c as H,d as Fe,e as y,f as U,g as ue,h as re,i as se,k as j,l as V,m as tt,n as M}from"./chunk-ZZCNHYQV.js";import{c as G}from"./chunk-GVLRKNS6.js";import{$a as B,Ab as p,B as le,Bb as c,Cb as Z,Db as me,E as ce,Eb as We,Fb as N,Gb as Q,Ha as l,Hb as Ke,Jb as Ye,Ka as z,Kb as Je,Lb as et,Pa as u,Q as ke,Qb as R,Rb as pe,T as ze,Ub as _e,W as Be,Za as Ve,_a as Ze,aa as h,bc as w,cb as E,dc as A,eb as f,gb as Xe,hb as b,ib as _,ja as C,jb as oe,ka as g,kb as He,l as ae,la as v,lb as L,mb as F,nb as s,ob as r,p as Pe,pb as m,qb as je,rb as T,ua as q,va as d,wb as S,x as Ue,xb as De,yb as $e,zb as Le}from"./chunk-QP6SEBO3.js";import"./chunk-XVUYO3C5.js";var pt=["content"],_t=["keyword"],ut=["variable"],dt=["select"],ft=(n,t)=>({"font-bold text-green-500":n,"font-bold text-red-500":t}),Ct=n=>({width:n});function gt(n,t){if(n&1&&(s(0,"span",5),N(1),r()),n&2){let e=t.$implicit;l(),Q(e);}}function ht(n,t){if(n&1&&(s(0,"span",6),N(1),r()),n&2){let e=t.$implicit,i=c();f("ngClass",pe(2,ft,i.highlighVariable()&&i.variableActive(e),i.highlighVariable()&&!i.variableActive(e))),l(),Q(e);}}function Et(n,t){n&1&&(s(0,"option",8),N(1,"NOT x"),r());}function Tt(n,t){n&1&&(s(0,"option",9),N(1,"x AND x"),r());}function vt(n,t){n&1&&(s(0,"option",10),N(1,"x OR x"),r());}function bt(n,t){if(n&1&&(s(0,"option",11),N(1),r()),n&2){let e=c().$implicit,i=c().$implicit,o=c();f("value",e)("selected",i===e)("disabled",e===o.please_select),l(),Ke(" ",e," ");}}function St(n,t){if(n&1&&E(0,Et,2,0,"option",8)(1,Tt,2,0,"option",9)(2,vt,2,0,"option",10)(3,bt,2,4,"option",11),n&2){let e,i=t.$implicit;_((e=i)==="not"?0:e==="and"?1:e==="or"?2:3);}}function Rt(n,t){if(n&1){let e=T();s(0,"select",7,4),p("change",function(){let o=C(e).selection,a=We(1);return g(o(a.value));}),L(2,St,4,1,null,null,oe),r();}if(n&2){let e=t.options,i=t.width;Xe(R(2,Ct,i)),l(2),F(e);}}var ve=class n{condition=d.required();selectVariables=d.required();content=B.required("content",{read:Ve});keywordTemplate=B.required("keyword",{read:z});variableTemplate=B.required("variable",{read:z});selectTemplate=B.required("select",{read:z});state=h(M);activeAnswers=this.state.signal("activeAnswers");mode=this.state.signal("rulesMode");highlighVariable=w(()=>this.mode()!=="edit"&&this.state.signal("highlightVariableStatus")());serializer=h(V);serializedCondition=w(()=>this.serializer.serialize(this.condition()));please_select=y.string;always=U.string;conditionChanged=q();constructor(){A(()=>{this.mode(),this.condition(),this.selectVariables(),this.repaint();});}repaint(){this.content().clear(),!(this.mode()!=="edit"&&this.condition()instanceof U)&&(this.paintKeyword("IF"),this.paintCondition(this.condition(),t=>{this.conditionChanged.emit(t);}));}calculateOptions(t){return[this.please_select,this.always,...this.selectVariables(),"not","and","or"].filter(e=>!t.includes(e));}selection(t){return t==="not"?new ue(new y()):t==="and"?new re(new y(),new y()):t==="or"?new se(new y(),new y()):t===this.always?new U():new Fe(t);}paintKeyword(t){this.content().createEmbeddedView(this.keywordTemplate(),{$implicit:t});}paintSelect(t,e,i){this.content().createEmbeddedView(this.selectTemplate(),{$implicit:t,options:this.calculateOptions(i),selection:o=>{e(this.selection(o));},width:(t.length*9+30).toString()+"px"});}paintVariable(t){this.content().createEmbeddedView(this.variableTemplate(),{$implicit:t});}paintCondition(t,e,i=[]){if(t instanceof ue){let o=i.filter(a=>a!==this.always);this.paintKeyword("NOT"),this.paintCondition(t.not,a=>{e(new ue(a));},o);}else if(t instanceof re){let o=[...i,this.always];this.paintCondition(t.left,a=>{e(new re(a,t.right));},o),this.paintKeyword("AND"),this.paintCondition(t.right,a=>{e(new re(t.left,a));},o);}else if(t instanceof se){let o=[...i,this.always];this.paintCondition(t.left,a=>{e(new se(a,t.right));},o),this.paintKeyword("OR"),this.paintCondition(t.right,a=>{e(new se(t.left,a));},o);}else t instanceof U?this.mode()==="edit"?this.paintSelect(this.always,e,i):this.paintVariable(this.always):t instanceof Fe&&(this.mode()==="edit"?this.paintSelect(t.variable,e,i):this.paintVariable(t.variable));}variableActive(t){return t===U.string||this.activeAnswers()[t];}static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-editor-condition"]],viewQuery:function(e,i){e&1&&(Z(i.content,pt,5,Ve),Z(i.keywordTemplate,_t,5,z),Z(i.variableTemplate,ut,5,z),Z(i.selectTemplate,dt,5,z)),e&2&&me(4);},inputs:{condition:[1,"condition"],selectVariables:[1,"selectVariables"]},outputs:{conditionChanged:"conditionChanged"},decls:8,vars:0,consts:[["content",""],["keyword",""],["variable",""],["select",""],["selectbox",""],[1,"font-bold"],[1,"font-mono",3,"ngClass"],[1,"font-mono",3,"change"],["value","not"],["value","and"],["value","or"],[3,"value","selected","disabled"]],template:function(e,i){e&1&&(je(0,null,0),E(2,gt,2,1,"ng-template",null,1,_e)(4,ht,2,5,"ng-template",null,2,_e)(6,Rt,4,4,"ng-template",null,3,_e));},dependencies:[G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;gap:8px;flex-wrap:wrap;align-items:center}"],changeDetection:0});};var wt=(n,t)=>({"font-bold text-green-500":n,"font-bold text-red-500":t});function It(n,t){n&1&&(s(0,"span"),S(1,0),r());}function xt(n,t){n&1&&(s(0,"span"),S(1,1),r());}function Nt(n,t){n&1&&(s(0,"span"),S(1,2),r());}function Ot(n,t){n&1&&(s(0,"span"),S(1,3),r());}function Mt(n,t){n&1&&(s(0,"span"),S(1,4),r());}function qt(n,t){n&1&&(s(0,"span"),S(1,5),r());}function yt(n,t){if(n&1&&(s(0,"div",11),E(1,It,2,0,"span")(2,xt,2,0,"span")(3,Nt,2,0,"span")(4,Ot,2,0,"span")(5,Mt,2,0,"span")(6,qt,2,0,"span"),r()),n&2){let e=c();l(),_(e.form.controls.question.errors!=null&&e.form.controls.question.errors.pattern?1:-1),l(),_(e.form.controls.question.errors!=null&&e.form.controls.question.errors.required?2:-1),l(),_(e.form.controls.variable.errors!=null&&e.form.controls.variable.errors.pattern?3:-1),l(),_(e.form.controls.variable.errors!=null&&e.form.controls.variable.errors.required?4:-1),l(),_(e.form.controls.variable.errors!=null&&e.form.controls.variable.errors.reserved?5:-1),l(),_(e.form.controls.variable.errors!=null&&e.form.controls.variable.errors.used?6:-1);}}var be=class n{question=d.required();state=h(M);variables=this.state.signal("variables");mode=this.state.signal("rulesMode");highlighVariable=w(()=>this.mode()!=="edit"&&this.state.signal("highlightVariableStatus")());variableActive=w(()=>this.state.signal("activeAnswers")()[this.question().variable]);refactorVariables=this.state.signal("refactorVariables");questionChanged=q();variableChanged=q();fb=h(he).nonNullable;form=this.fb.group({question:this.fb.control("",{validators:[k.pattern("[^,;#]+"),k.required]}),variable:this.fb.control("",{validators:[k.pattern(" *[^ ,;#]+ *"),At(),k.required],asyncValidators:[Pt(Qe(this.variables),Qe(this.question))]})});constructor(){A(()=>{this.question(),this.reset();});let t=Te(this.form.valueChanges.pipe(ce(500),le(()=>this.form.valid)));A(()=>{let e=t();e?.question&&e.question!==this.question().question&&e.variable?this.questionChanged.emit(new P(e.question,e.variable)):e?.variable&&e.variable.trim()!==this.question().variable&&(this.question().variable===P.NEW_VARIABLE_NAME||!this.refactorVariables()?this.questionChanged.emit(new P(this.question().question,e.variable.trim())):this.variableChanged.emit([this.question().variable,e.variable.trim()]));}),A(()=>{this.mode()==="edit"?this.form.enable({emitEvent:!1}):this.form.disable({emitEvent:!1}),this.reset();});}reset(){this.form.patchValue(this.question(),{emitEvent:!1});}focusQuestion(){this.form.controls.question.value===P.NEW_QUESTION_NAME&&this.form.controls.question.setValue("",{emitEvent:!1});}focusVariable(){this.form.controls.variable.value===P.NEW_VARIABLE_NAME&&this.form.controls.variable.setValue("",{emitEvent:!1});}static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-editor-question"]],inputs:{question:[1,"question"]},outputs:{questionChanged:"questionChanged",variableChanged:"variableChanged"},decls:7,vars:6,consts:()=>{let t;t="Frage";let e;e="Variable";let i;i="Fragen d\xFCrfen die Zeichen , ; # nicht enthalten";let o;o="Frage ist erforderlich";let a;a="Variablen d\xFCrfen keine Leerzeichen oder die Zeichen , ; # enthalten";let x;x="Variablenname ist erforderlich";let D;D="Dieser Variablenname ist reserviert";let ne;return ne="Dieser Variablenname wird bereits verwendet",[i,o,a,x,D,ne,[1,"flex","flex-col",3,"formGroup"],["type","text","placeholder",t,"formControlName","question",1,"grow",3,"focus"],[1,"flex","items-center","gap-2"],[1,"ml-3","font-mono"],["type","text","placeholder",e,"formControlName","variable",1,"grow","font-mono",3,"focus","ngClass"],[1,"m-1","flex","flex-col","text-sm","text-red-500"]];},template:function(e,i){e&1&&(s(0,"form",6)(1,"input",7),p("focus",function(){return i.focusQuestion();}),r(),s(2,"div",8)(3,"span",9),N(4,"->"),r(),s(5,"input",10),p("focus",function(){return i.focusVariable();}),r()(),E(6,yt,7,6,"div",11),r()),e&2&&(f("formGroup",i.form),l(5),f("ngClass",pe(3,wt,i.highlighVariable()&&i.variableActive(),i.highlighVariable()&&!i.variableActive())),l(),_(i.mode()==="edit"&&i.form.valid===!1&&i.form.touched?6:-1));},dependencies:[Ee,fe,W,K,de,Ce,ge,G],encapsulation:2,changeDetection:0});};function At(){return n=>[U.string].some(t=>t===n.value?.trim())?{reserved:!0}:null;}function Pt(n,t){return e=>ae(e.value).pipe(ze(n.pipe(Pe(i=>[...i])),t),ke(([i,o,a])=>Ue(()=>!o.find(x=>x===a.variable),ae(null),ae([i,o,a]).pipe(Pe(([x,D,ne])=>{let $=D.findIndex(mt=>mt===ne.variable);return D.splice($,1),D.includes(x?.trim()??"")?{used:!0}:null;})))));}function Vt(n,t){if(n&1&&(s(0,"option",4),N(1),r()),n&2){let e=t.$implicit;f("value",e),l(),Q(e);}}function Dt(n,t){n&1&&(s(0,"span"),S(1,0),r());}function $t(n,t){n&1&&(s(0,"span"),S(1,1),r());}function Lt(n,t){if(n&1&&E(0,Dt,2,0,"span")(1,$t,2,0,"span"),n&2){let e=c(2);_(e.form.controls.name.errors!=null&&e.form.controls.name.errors.pattern?0:-1),l(),_(e.form.controls.name.errors!=null&&e.form.controls.name.errors.required?1:-1);}}function Ft(n,t){if(n&1&&(s(0,"div",7),E(1,Lt,2,2),r()),n&2){let e=c();l(),_(e.form.controls.name.touched?1:-1);}}var Se=class n{item=d.required();state=h(M);mode=this.state.signal("rulesMode");categories=this.state.signal("categories");itemChanged=q();fb=h(he).nonNullable;form=this.fb.group({category:this.fb.control(""),name:this.fb.control("",{validators:[k.pattern("[^,;#]+"),k.required]})});parser=h(j);serializer=h(V);constructor(){A(()=>{this.item(),this.reset();});let t=Te(this.form.valueChanges.pipe(ce(500),le(()=>this.form.valid)));A(()=>{let e=t();if(!e)return;if(!e.category){this.addNewCategory();return;}let[i,o]=this.parser.extractItemNameAndWeight(e.name);this.itemChanged.emit(new H(e.category,i,o));}),A(()=>{this.mode()==="edit"?this.form.enable({emitEvent:!1}):this.form.disable({emitEvent:!1}),this.reset();});}blockPatch=!1;reset(){if(!this.blockPatch){let t=this.item().name;this.item().weight&&(t+=` ${this.serializer.serializeWeight(this.item().weight)}`),this.form.patchValue({category:this.item().category,name:t},{emitEvent:!1});}}focus(t){this.blockPatch=document.activeElement===t.target,this.form.controls.name.value===H.NEW_ITEM_NAME&&this.form.controls.name.setValue("",{emitEvent:!1});}blur(){this.blockPatch=!1,this.reset();}async addNewCategory(){let t=await it("Enter new category name");if(t){if(/[,;#]/.test(t)){alert("Category name cannot contain , ; #"),this.form.patchValue({category:""});return;}this.form.patchValue({category:t});}else this.reset();}static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-editor-item"]],inputs:{item:[1,"item"]},outputs:{itemChanged:"itemChanged"},decls:8,vars:2,consts:()=>{let t;t="Der Artikelname darf die Zeichen , ; # nicht enthalten";let e;return e="Artikelname ist erforderlich",[t,e,[1,"flex",3,"formGroup"],["name","categories","formControlName","category",1,"max-w-24"],[3,"value"],["value",""],["type","text","formControlName","name",1,"grow",3,"focus","blur"],[1,"m-1","text-sm","text-red-500"]];},template:function(e,i){e&1&&(s(0,"form",2)(1,"select",3),L(2,Vt,2,2,"option",4,He),s(4,"option",5),N(5,"+"),r()(),s(6,"input",6),p("focus",function(a){return i.focus(a);})("blur",function(){return i.blur();}),r()(),E(7,Ft,2,1,"div",7)),e&2&&(f("formGroup",i.form),l(2),F(i.categories()),l(5),_(i.mode()==="edit"&&i.form.valid===!1&&i.form.touched?7:-1));},dependencies:[Ee,fe,rt,st,W,ot,K,de,Ce,ge],encapsulation:2,changeDetection:0});};var Y=class n{serializer=h(V);parser=h(j);state=h(M);questions=this.state.signal("clipboardQuestions");items=this.state.signal("clipboardItems");itemsCount=w(()=>this.items().length);questionsCount=w(()=>this.questions().length);cutQuestion(t){this.questions.update(e=>[...e,this.serializer.serialize(t)]);}cutItem(t){this.items.update(e=>[...e,this.serializer.serialize(t)]);}paste(){let t={questions:this.questions().map(e=>this.parser.parseQuestion(e)),items:this.items().map(e=>this.parser.parseItem(e))};return this.questions.set([]),this.items.set([]),t;}static ɵfac=function(e){return new(e||n)();};static ɵprov=Be({token:n,factory:n.ɵfac,providedIn:"root"});};var J=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-delete"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var Re=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-cut"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M760-120 480-400l-94 94q8 15 11 32t3 34q0 66-47 113T240-80q-66 0-113-47T80-240q0-66 47-113t113-47q17 0 34 3t32 11l94-94-94-94q-15 8-32 11t-34 3q-66 0-113-47T80-720q0-66 47-113t113-47q66 0 113 47t47 113q0 17-3 34t-11 32l494 494v40H760ZM600-520l-80-80 240-240h120v40L600-520ZM240-640q33 0 56.5-23.5T320-720q0-33-23.5-56.5T240-800q-33 0-56.5 23.5T160-720q0 33 23.5 56.5T240-640Zm240 180q8 0 14-6t6-14q0-8-6-14t-14-6q-8 0-14 6t-6 14q0 8 6 14t14 6ZM240-160q33 0 56.5-23.5T320-240q0-33-23.5-56.5T240-320q-33 0-56.5 23.5T160-240q0 33 23.5 56.5T240-160Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var we=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-paste"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h167q11-35 43-57.5t70-22.5q40 0 71.5 22.5T594-840h166q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560h-80v120H280v-120h-80v560Zm280-560q17 0 28.5-11.5T520-800q0-17-11.5-28.5T480-840q-17 0-28.5 11.5T440-800q0 17 11.5 28.5T480-760Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var Ie=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-down"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var ee=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-clear"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","m456-320 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104 56 56Zm-96 160q-19 0-36-8.5T296-192L80-480l216-288q11-15 28-23.5t36-8.5h440q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H360ZM180-480l180 240h440v-480H360L180-480Zm400 0Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};function Qt(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c();return g(o.resetCondition());}),m(1,"app-icon-clear"),r();}}function Gt(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c(2).$index,a=c();return g(a.swapQuestions(o,o+1));}),m(1,"app-icon-down"),r();}}function Ut(n,t){n&1&&m(0,"span",9);}function kt(n,t){if(n&1&&E(0,Gt,2,0,"button",4)(1,Ut,1,0,"span",9),n&2){let e=c().$index,i=c();_(e<i.rule().questions.length-1?0:1);}}function zt(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c().$index,a=c();return g(a.deleteQuestion(o));}),m(1,"app-icon-delete"),r();}}function Bt(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c().$index,a=c();return g(a.cutQuestion(o));}),m(1,"app-icon-cut"),r();}}function Zt(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c().$index,a=c();return g(a.swapQuestions(o-1,o));}),m(1,"app-icon-up"),r();}}function Xt(n,t){if(n&1){let e=T();s(0,"div",2),E(1,kt,2,1),s(2,"app-editor-question",8),p("questionChanged",function(o){let a=C(e).$index,x=c();return g(x.updateQuestion(a,o));})("variableChanged",function(o){C(e);let a=c();return g(a.variableChanged(o));}),r(),E(3,zt,2,0,"button",4)(4,Bt,2,0,"button",4)(5,Zt,2,0,"button",4),r();}if(n&2){let e=t.$implicit,i=t.$index,o=c();l(),_(o.mode()==="swap"?1:-1),l(),f("question",e),l(),_(o.mode()==="delete"?3:o.mode()==="cut-paste"?4:o.mode()==="swap"&&i>0?5:-1);}}function Ht(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c(2).$index,a=c();return g(a.swapItems(o,o+1));}),m(1,"app-icon-down"),r();}}function jt(n,t){n&1&&m(0,"span",9);}function Wt(n,t){if(n&1&&E(0,Ht,2,0,"button",4)(1,jt,1,0,"span",9),n&2){let e=c().$index,i=c();_(e<i.rule().items.length-1?0:1);}}function Kt(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c().$index,a=c();return g(a.deleteItem(o));}),m(1,"app-icon-delete"),r();}}function Yt(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c().$index,a=c();return g(a.cutItem(o));}),m(1,"app-icon-cut"),r();}}function Jt(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c().$index,a=c();return g(a.swapItems(o-1,o));}),m(1,"app-icon-up"),r();}}function ei(n,t){if(n&1){let e=T();s(0,"div",2),E(1,Wt,2,1),s(2,"app-editor-item",10),p("itemChanged",function(o){let a=C(e).$index,x=c();return g(x.updateItem(a,o));}),r(),E(3,Kt,2,0,"button",4)(4,Yt,2,0,"button",4)(5,Jt,2,0,"button",4),r();}if(n&2){let e=t.$implicit,i=t.$index,o=c();l(),_(o.mode()==="swap"?1:-1),l(),f("item",e),l(),_(o.mode()==="delete"?3:o.mode()==="cut-paste"?4:o.mode()==="swap"&&i>0?5:-1);}}function ti(n,t){if(n&1){let e=T();s(0,"div",5)(1,"button",11),p("click",function(){C(e);let o=c();return g(o.addQuestion());}),S(2,0),r(),s(3,"button",11),p("click",function(){C(e);let o=c();return g(o.addItem());}),S(4,1),r()();}}function ii(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c(2);return g(o.deleteRule.emit());}),m(1,"app-icon-delete"),r();}}function ni(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c(2);return g(o.paste());}),m(1,"app-icon-paste"),r();}}function oi(n,t){if(n&1&&(s(0,"div",6),E(1,ii,2,0,"button",4)(2,ni,2,0,"button",4),r()),n&2){let e=c();l(),_(e.mode()==="delete"?1:-1),l(),_(e.mode()==="cut-paste"?2:-1);}}function ri(n,t){if(n&1&&(s(0,"pre"),N(1),r(),s(2,"pre"),N(3),r()),n&2){let e=c();l(),Q(t),l(2),Q(e.ruleDebugString());}}var xe=class n{rule=d.required();ruleChanged=q();deleteRule=q();renameVariable=q();ruleDebugString=w(()=>this.serializer.serialize(this.rule()));errorMessage=Ze(null);state=h(M);mode=this.state.signal("rulesMode");selectVariables=w(()=>{let t=this.rule().questions.map(i=>i.variable);return this.state.get("variables").filter(i=>!t.includes(i));});clipboard=h(Y);parser=h(j);serializer=h(V);compileRule(t){try{return this.parser.parseRule(this.serializer.serialize(t)),this.errorMessage.set(null),!0;}catch(e){return e instanceof Error&&this.errorMessage.set(e.message),!1;}}resetCondition(){this.updateCondition(new y());}updateCondition(t){let e=new X(t,this.rule().questions,this.rule().items);this.compileRule(e)&&this.ruleChanged.emit(e);}emitNewQuestions(t){let e=new X(this.rule().condition,t,this.rule().items);this.compileRule(e)&&this.ruleChanged.emit(e);}updateQuestion(t,e){let i=this.rule().questions;i[t]=e,this.emitNewQuestions(i);}addQuestion(){let t=new P(P.NEW_QUESTION_NAME,P.NEW_VARIABLE_NAME);this.updateQuestion(this.rule().questions.length,t);}deleteQuestion(t){let e=this.rule().questions;e.splice(t,1),this.emitNewQuestions(e);}cutQuestion(t){let e=this.rule().questions[t];this.deleteQuestion(t),this.clipboard.cutQuestion(e);}swapQuestions(t,e){let i=this.rule().questions,o=i[t];i[t]=i[e],i[e]=o,this.emitNewQuestions(i);}emitNewItems(t){let e=new X(this.rule().condition,this.rule().questions,t);this.compileRule(e)&&this.ruleChanged.emit(e);}updateItem(t,e){let i=this.rule().items;i[t]=e,this.emitNewItems(i);}addItem(){let t=new H(H.NEW_CATEGORY_NAME,H.NEW_ITEM_NAME);this.updateItem(this.rule().items.length,t);}deleteItem(t){let e=this.rule().items;e.splice(t,1),this.emitNewItems(e);}cutItem(t){let e=this.rule().items[t];this.deleteItem(t),this.clipboard.cutItem(e);}swapItems(t,e){let i=this.rule().items,o=i[t];i[t]=i[e],i[e]=o,this.emitNewItems(i);}paste(){let{questions:t,items:e}=this.clipboard.paste(),i=new X(this.rule().condition,[...this.rule().questions,...t],[...this.rule().items,...e]);this.ruleChanged.emit(i);}variableChanged([t,e]){this.renameVariable.emit([t,e]);}static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-editor-rule"]],inputs:{rule:[1,"rule"]},outputs:{ruleChanged:"ruleChanged",deleteRule:"deleteRule",renameVariable:"renameVariable"},decls:10,vars:5,consts:()=>{let t;t="+ Frage";let e;return e="+ Gegenstand",[t,e,[1,"mb-1","flex","items-center"],[1,"grow",3,"conditionChanged","condition","selectVariables"],["type","button",1,"icon"],[1,"flex","justify-end","gap-2"],[1,"flex","justify-center"],["type","button",1,"icon",3,"click"],[1,"grow",3,"questionChanged","variableChanged","question"],[1,"ml-6"],[1,"grow",3,"itemChanged","item"],["type","button",3,"click"]];},template:function(e,i){if(e&1&&(s(0,"div",2)(1,"app-editor-condition",3),p("conditionChanged",function(a){return i.updateCondition(a);}),r(),E(2,Qt,2,0,"button",4),r(),L(3,Xt,6,3,"div",2,oe),L(5,ei,6,3,"div",2,oe),E(7,ti,5,0,"div",5)(8,oi,3,2,"div",6)(9,ri,4,2)),e&2){let o;l(),f("condition",i.rule().condition)("selectVariables",i.selectVariables()),l(),_(i.mode()==="edit"?2:-1),l(),F(i.rule().questions),l(2),F(i.rule().items),l(2),_(i.mode()==="edit"?7:8),l(2),_((o=i.errorMessage())?9:-1,o);}},dependencies:[ve,be,Se,J,Re,we,Ie,lt,ee],encapsulation:2,changeDetection:0});};var Ne=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-view"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-72q-45 0-76.5-31.5T372-500q0-45 31.5-76.5T480-608q45 0 76.5 31.5T588-500q0 45-31.5 76.5T480-392Zm0 192q-146 0-266-81.5T40-500q54-137 174-218.5T480-800q146 0 266 81.5T920-500q-54 137-174 218.5T480-200Zm0-300Zm0 220q113 0 207.5-59.5T832-500q-50-101-144.5-160.5T480-720q-113 0-207.5 59.5T128-500q50 101 144.5 160.5T480-280Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var Oe=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-edit"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var Me=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-reorder"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M160-501q0 71 47.5 122T326-322l-62-62 56-56 160 160-160 160-56-56 64-64q-105-6-176.5-81T80-500q0-109 75.5-184.5T340-760h140v80H340q-75 0-127.5 52T160-501Zm400 261v-80h320v80H560Zm0-220v-80h320v80H560Zm0-220v-80h320v80H560Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var te=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-swap"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M320-440v-287L217-624l-57-56 200-200 200 200-57 56-103-103v287h-80ZM600-80 400-280l57-56 103 103v-287h80v287l103-103 57 56L600-80Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var qe=class n{class=d("h-4 w-4");static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-icon-search"]],inputs:{class:[1,"class"]},decls:2,vars:2,consts:[["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"]],template:function(e,i){e&1&&(v(),s(0,"svg",0),m(1,"path",1),r()),e&2&&b(i.class());},encapsulation:2,changeDetection:0});};var si=["searchInput"],ai=n=>({"sticky left-0 top-0 z-30 shadow-md":n}),ie=n=>({"ring ring-slate-700":n}),ye=n=>({"fill-slate-400":n});function li(n,t){n&1&&(s(0,"span"),S(1,2),r());}function ci(n,t){if(n&1&&(s(0,"span"),S(1,3),r()),n&2){let e=t;l(),De(e)(e),$e(1);}}function mi(n,t){if(n&1&&(s(0,"span"),S(1,4),r()),n&2){let e=t;l(),De(e)(e),$e(1);}}function pi(n,t){if(n&1&&E(0,ci,2,2,"span")(1,mi,2,2,"span"),n&2){let e,i,o=c(2);_((e=o.clipboard.itemsCount())?0:-1,e),l(),_((i=o.clipboard.questionsCount())?1:-1,i);}}function _i(n,t){if(n&1&&(s(0,"div",11)(1,"span"),S(2,1),r(),E(3,li,2,0,"span")(4,pi,2,2),r()),n&2){let e=c();l(3),_(e.clipboard.itemsCount()===0&&e.clipboard.questionsCount()===0?3:4);}}function ui(n,t){if(n&1){let e=T();s(0,"div",12)(1,"input",13,0),et("ngModelChange",function(o){C(e);let a=c();return Je(a.searchTerm,o)||(a.searchTerm=o),g(o);}),r(),s(3,"button",14),p("click",function(){C(e);let o=c();return g(o.clearSearch());}),m(4,"app-icon-clear"),r()();}if(n&2){let e=c();l(),Ye("ngModel",e.searchTerm);}}var Ae=class n{noOfVisibleRules=d.required();state=h(M);mode=this.state.signal("rulesMode");searchTerm=this.state.signal("filterRulesQuery");clipboard=h(Y);sticky=w(()=>this.state.signal("scrollY")()>48);searchInput=B.required("searchInput");focusSearch(){setTimeout(()=>{this.searchInput().nativeElement.focus();},50);}clearSearch(){this.searchTerm.set(""),this.focusSearch();}static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-toolbar"]],viewQuery:function(e,i){e&1&&Z(i.searchInput,si,5),e&2&&me();},inputs:{noOfVisibleRules:[1,"noOfVisibleRules"]},decls:16,vars:38,consts:()=>{let t;t="Zwischenablage:";let e;e="leer";let i;i="{VAR_PLURAL, plural, one {1 Gegenstand} other {{INTERPOLATION} Gegenst\xE4nde}}",i=Le(i,{INTERPOLATION:"\uFFFD1\uFFFD",VAR_PLURAL:"\uFFFD0\uFFFD"});let o;return o="{VAR_PLURAL, plural, one {1 Frage} other {{INTERPOLATION} Fragen}}",o=Le(o,{INTERPOLATION:"\uFFFD1\uFFFD",VAR_PLURAL:"\uFFFD0\uFFFD"}),[["searchInput",""],t,e,i,o,[1,"bg-active","py-2",3,"ngClass"],[1,"mb-1","grid","grid-cols-6","gap-2"],["type","button",1,"icon",3,"click","ngClass"],[1,"my-auto","h-6","w-6"],["type","button",1,"icon",3,"click","ngClass","disabled"],[1,"my-auto","h-6","w-6",3,"ngClass"],[1,"mt-2","flex","justify-center","gap-5"],[1,"mt-2","flex","items-center"],["type","text",1,"grow",3,"ngModelChange","ngModel"],["type","button",1,"icon","m-3",3,"click"]];},template:function(e,i){e&1&&(s(0,"div",5)(1,"div",6)(2,"button",7),p("click",function(){return i.mode.set("view");}),m(3,"app-icon-view",8),r(),s(4,"button",9),p("click",function(){return i.mode.set("edit");}),m(5,"app-icon-edit",10),r(),s(6,"button",9),p("click",function(){return i.mode.set("delete");}),m(7,"app-icon-delete",10),r(),s(8,"button",9),p("click",function(){return i.mode.set("cut-paste");}),m(9,"app-icon-reorder",10),r(),s(10,"button",9),p("click",function(){return i.mode.set("swap");}),m(11,"app-icon-swap",10),r(),s(12,"button",7),p("click",function(){return i.mode.set("search"),i.focusSearch();}),m(13,"app-icon-search",8),r()(),E(14,_i,5,1,"div",11)(15,ui,5,1,"div",12),r()),e&2&&(f("ngClass",R(16,ai,i.sticky())),l(2),f("ngClass",R(18,ie,i.mode()==="view")),l(2),f("ngClass",R(20,ie,i.mode()==="edit"))("disabled",!i.noOfVisibleRules()&&!!i.searchTerm()),l(),f("ngClass",R(22,ye,!i.noOfVisibleRules()&&!!i.searchTerm())),l(),f("ngClass",R(24,ie,i.mode()==="delete"))("disabled",!i.noOfVisibleRules()),l(),f("ngClass",R(26,ye,!i.noOfVisibleRules())),l(),f("ngClass",R(28,ie,i.mode()==="cut-paste"))("disabled",i.noOfVisibleRules()<2),l(),f("ngClass",R(30,ye,i.noOfVisibleRules()<2)),l(),f("ngClass",R(32,ie,i.mode()==="swap"))("disabled",!i.noOfVisibleRules()),l(),f("ngClass",R(34,ye,!i.noOfVisibleRules())),l(),f("ngClass",R(36,ie,i.mode()==="search")),l(2),_(i.mode()==="cut-paste"?14:i.mode()==="search"||i.searchTerm()?15:-1));},dependencies:[at,W,K,nt,G,Ne,Oe,J,Me,te,qe,ee],encapsulation:2,changeDetection:0});};var di=(n,t)=>t.index,fi=n=>({disabled:n});function Ci(n,t){if(n&1){let e=T();s(0,"div",3)(1,"button",6),p("click",function(){C(e);let o=c().$implicit,a=c();return g(a.swapRules(o.index-1,o.index));}),m(2,"app-icon-swap"),r()();}}function gi(n,t){if(n&1){let e=T();E(0,Ci,3,0,"div",3),s(1,"div",4)(2,"app-editor-rule",5),p("ruleChanged",function(o){let a=C(e).$implicit,x=c();return g(x.updateRule(a.index,o));})("deleteRule",function(){let o=C(e).$implicit,a=c();return g(a.deleteRule(o.index));})("renameVariable",function(o){C(e);let a=c();return g(a.renameVariable(o));}),r()();}if(n&2){let e=t.$implicit,i=c();_(e.index>0&&i.mode()==="swap"&&!i.filter()?0:-1),l(),f("id","rule-"+e.index)("ngClass",R(4,fi,i.showAsDisabled(e.rule))),l(),f("rule",e.rule);}}function hi(n,t){if(n&1){let e=T();s(0,"button",7),p("click",function(){C(e);let o=c();return g(o.addRule());}),S(1,0),r();}}var Ge=class n{serializer=h(V);refactor=h(tt);state=h(M);parsedRules=this.state.signal("parsedRules");activeRules=this.state.signal("activeRules");mode=this.state.signal("rulesMode");filter=this.state.signal("filterRulesQuery");visibleRules=w(()=>this.filter()===""?this.parsedRules().map((e,i)=>({rule:e,index:i})):this.parsedRules().map((e,i)=>({rule:e,index:i})).filter(e=>{let i=this.filter();return!i||this.refactor.contains(e.rule,i);}));updateRules(t){let e=this.serializer.serializeRules(t);this.state.set("rules",e);}updateRule(t,e){let i=this.parsedRules();i[t]=e,this.updateRules([...i]);}deleteRule(t){let e=this.parsedRules();e.splice(t,1),this.updateRules([...e]);}addRule(){let t=this.parsedRules().length,e=[];for(let a=0;a<this.parsedRules().length;a++){let x=document.querySelector(`#rule-${a.toString()}`);if(x){let D=x.getBoundingClientRect();D.top>=0&&D.bottom<=window.innerHeight&&e.push(a);}}e.includes(t-1)||(t=e[0]+1);let i=new X(new y()),o=this.parsedRules();o.splice(t,0,i),this.updateRules([...o]);}swapRules(t,e){let i=this.parsedRules(),o=i[t];i[t]=i[e],i[e]=o,this.updateRules([...i]);}showAsDisabled(t){return this.state.get("fadeOutDisabledRules")&&!this.activeRules().includes(t);}renameVariable([t,e]){let i=this.refactor.renameVariable(t,e,this.parsedRules());this.updateRules(i);}static ɵfac=function(e){return new(e||n)();};static ɵcmp=u({type:n,selectors:[["app-rules"]],decls:4,vars:2,consts:()=>{let t;return t="+ Regel",[t,[3,"noOfVisibleRules"],["type","button",1,"sticky","bottom-0","z-50"],[1,"flex","justify-center"],[1,"card","mb-1",3,"id","ngClass"],[3,"ruleChanged","deleteRule","renameVariable","rule"],["type","button",1,"icon",3,"click"],["type","button",1,"sticky","bottom-0","z-50",3,"click"]];},template:function(e,i){e&1&&(m(0,"app-toolbar",1),L(1,gi,3,6,null,null,di),E(3,hi,2,0,"button",2)),e&2&&(f("noOfVisibleRules",i.visibleRules().length),l(),F(i.visibleRules()),l(2),_(i.mode()==="edit"&&!i.filter()?3:-1));},dependencies:[xe,Ae,te,G],encapsulation:2,changeDetection:0});};export{Ge as default};/**i18n:717214697a29241ab35fda4f803c9965e2e966609f94cbb4e7c0189a1847a6bb*/