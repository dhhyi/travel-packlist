import{b as Rt,c as Ct,d as Fe}from"./chunk-950c003f.js";import{A as Tt,b as rt,c as fe,d as lt,e as at,i as st,p as dt,r as Le,s as ut,v as ge,y as Et,z as ct}from"./chunk-edf3e826.js";import{b as re,c as ce,d as le,e as he,g as At,h as be,j as $e,k as ve,l as Pt,m as ft,n as Lt,o as De,p as gt,q as xe}from"./chunk-2f218f0f.js";import{a as ee,b as X,c as te,d as Oe,e as k,f as de,g as Ie,h as ue,i as Ee,j as oe,l as _e,m as Ne,n as mt,o as St,q as pt,r as Me,u as L}from"./chunk-fd75c108.js";import{l as Pe}from"./chunk-9f7bbd74.js";import"./chunk-ebb84b43.js";import{$b as Q,A as Te,Ab as v,Ac as M,Bc as B,Cc as _t,Db as We,Eb as p,Fb as K,Kb as A,Lb as G,Mb as F,Na as a,Nb as Se,Ob as m,Pa as Z,Pb as ie,Qb as r,Rb as je,Sb as Ye,Ua as Ge,Ub as q,Vb as ne,Wb as pe,X as ke,Ya as I,Yb as H,Zb as He,_b as Je,aa as R,ac as ae,bc as se,cb as Be,dc as Ze,ec as et,fa as c,fc as tt,ga as T,gc as it,hc as Re,ic as Ce,kc as nt,mc as ot,ob as me,pb as u,qb as E,qc as Ae,rb as Y,sb as ze,tb as D,ub as x,vb as f,vc as C,wb as d,wc as V,xb as s,yb as b,zb as $,zc as N}from"./chunk-5cc3cef7.js";import"./chunk-0b432020.js";var Ve=(()=>{class n{parser=R(_e);state=R(L);questions=this.state.clipboard.questions;items=this.state.clipboard.items;itemsCount=C(()=>this.items().length);questionsCount=C(()=>this.questions().length);cutQuestion(e){this.questions.update(t=>[...t,pt(e)]);}cutItem(e){this.items.update(t=>[...t,Me(e)]);}paste(){let e={questions:this.questions().map(t=>this.parser.parseQuestion(t)),items:this.items().map(t=>this.parser.parseItem(t))};return this.questions.set([]),this.items.set([]),e;}static ɵfac=function(t){return new(t||n)();};static ɵprov=ke({token:n,factory:n.ɵfac,providedIn:"root"});}return n;})();var vt=["content"],Dt=["keyword"],xt=["variable"],Vt=["select"],Ut=n=>({width:n});function wt(n,_){if(n&1&&($(0,"span",5),Q(1),v()),n&2){let e=_.$implicit;a(),ae(e);}}function yt(n,_){if(n&1&&($(0,"span",6),Q(1),v()),n&2){let e=_.$implicit,t=r();H("text-green",t.highlighVariable()&&t.variableActive(e))("text-red",t.highlighVariable()&&!t.variableActive(e)),a(),ae(e);}}function Gt(n,_){if(n&1&&($(0,"option",8),Q(1),v()),n&2){let e=r(2).$implicit,t=r();K("value",t.NOT),a(),se("NOT ",t.variablePlaceholder(e));}}function Ft(n,_){if(n&1&&($(0,"option",8),Q(1),v()),n&2){let e=r(2).$implicit,t=r();K("value",t.AND),a(),se("",t.variablePlaceholder(e)," AND x");}}function Qt(n,_){if(n&1&&($(0,"option",8),Q(1),v()),n&2){let e=r(2).$implicit,t=r();K("value",t.OR),a(),se("",t.variablePlaceholder(e)," OR x");}}function Kt(n,_){if(n&1&&($(0,"option",8),Q(1,"REMOVE"),v()),n&2){let e=r(4);K("value",e.REMOVE);}}function qt(n,_){if(n&1&&u(0,Kt,2,1,"option",8),n&2){let e=r(2).$implicit,t=r();E(e!==t.PLEASE_SELECT?0:-1);}}function Xt(n,_){if(n&1&&($(0,"option",9),Q(1),v()),n&2){let e=r().$implicit,t=r().$implicit,i=r();K("value",e)("selected",t===e)("disabled",e===i.PLEASE_SELECT),a(),se(" ",e," ");}}function kt(n,_){if(n&1&&u(0,Gt,2,2,"option",8)(1,Ft,2,2,"option",8)(2,Qt,2,2,"option",8)(3,qt,1,1)(4,Xt,2,4,"option",9),n&2){let e,t=_.$implicit,i=r(2);E((e=t)===i.NOT?0:e===i.AND?1:e===i.OR?2:e===i.REMOVE?3:4);}}function Bt(n,_){if(n&1){let e=p();$(0,"select",7,4),ie("change",function(){let i=c(e),o=i.$implicit,l=i.selection,P=pe(1);return T(l(P.value,o));}),D(2,kt,5,1,null,null,Y),v();}if(n&2){let e=_.options,t=_.width;He(nt(2,Ut,t)),a(2),x(e);}}var Qe="NOT",Ke="AND",qe="OR",Xe="REMOVE",Ot=(()=>{class n{condition=M.required();selectVariables=M.required();content=B.required("content",{read:Ge});keywordTemplate=B.required("keyword",{read:Z});variableTemplate=B.required("variable",{read:Z});selectTemplate=B.required("select",{read:Z});state=R(L);activeAnswers=this.state.active.answers;mode=this.state.router.rulesMode;highlighVariable=C(()=>this.mode()!=="edit"&&this.state.config.highlightVariableStatus());ALWAYS=de.string;PLEASE_SELECT=k.string;NOT=Qe;AND=Ke;OR=qe;REMOVE=Xe;conditionChanged=N();constructor(){V(()=>{this.mode(),this.condition(),this.selectVariables(),this.repaint();});}repaint(){this.content().clear(),this.paintKeyword("IF"),this.paintCondition(this.condition(),e=>{e?this.conditionChanged.emit(e):this.conditionChanged.emit(new k());});}calculateOptions(e){return[this.PLEASE_SELECT,this.ALWAYS,...this.selectVariables(),this.NOT,this.AND,this.OR,this.REMOVE].filter(t=>!e.includes(t));}createFromPrevious(e){return e===this.PLEASE_SELECT||e===this.ALWAYS?new k():new Oe(e);}selection(e,t){return e===this.NOT?new Ie(this.createFromPrevious(t)):e===this.AND?new ue(this.createFromPrevious(t),new k()):e===this.OR?new Ee(this.createFromPrevious(t),new k()):e===this.REMOVE?null:e===this.ALWAYS?new de():new Oe(e);}paintKeyword(e){this.content().createEmbeddedView(this.keywordTemplate(),{$implicit:e});}paintSelect(e,t,i){this.content().createEmbeddedView(this.selectTemplate(),{$implicit:e,options:this.calculateOptions(i),selection:(o,l)=>{t(this.selection(o,l));},width:(e.length*9+30).toString()+"px"});}paintVariable(e){this.content().createEmbeddedView(this.variableTemplate(),{$implicit:e});}paintCondition(e,t,i=[]){if(e instanceof Ie){let o=i.filter(l=>l!==this.ALWAYS);this.paintKeyword("NOT"),this.paintCondition(e.not,l=>{t(l?new Ie(l):null);},o);}else if(e instanceof ue){let o=[...i,this.ALWAYS];this.paintCondition(e.left,l=>{t(l?new ue(l,e.right):e.right);},o),this.paintKeyword("AND"),this.paintCondition(e.right,l=>{t(l?new ue(e.left,l):e.left);},o);}else if(e instanceof Ee){let o=[...i,this.ALWAYS];this.paintCondition(e.left,l=>{t(l?new Ee(l,e.right):e.right);},o),this.paintKeyword("OR"),this.paintCondition(e.right,l=>{t(l?new Ee(e.left,l):e.left);},o);}else e instanceof Oe&&(this.mode()==="edit"?this.paintSelect(e.variable,t,i):this.paintVariable(e.variable));}variableActive(e){return this.activeAnswers()[e];}variablePlaceholder(e){return e===this.ALWAYS||e===this.PLEASE_SELECT?"x":e;}static ɵfac=function(t){return new(t||n)();};static ɵcmp=I({type:n,selectors:[["app-editor-condition"]],viewQuery:function(t,i){t&1&&(q(i.content,vt,5,Ge),q(i.keywordTemplate,Dt,5,Z),q(i.variableTemplate,xt,5,Z),q(i.selectTemplate,Vt,5,Z)),t&2&&ne(4);},hostAttrs:[1,"flex","flex-row","flex-wrap","items-center","justify-start","gap-2"],inputs:{condition:[1,"condition"],selectVariables:[1,"selectVariables"]},outputs:{conditionChanged:"conditionChanged"},decls:8,vars:0,consts:()=>{let e;return e="variable",[["content",""],["keyword",""],["variable",""],["select",""],["selectbox",""],["role","text",1,"font-bold"],[1,"font-mono","font-bold"],["role","combobox","aria-label",e,1,"font-mono",3,"change"],[3,"value"],[3,"value","selected","disabled"]];},template:function(t,i){t&1&&(We(0,null,0),Be(2,wt,2,1,"ng-template",null,1,Ae)(4,yt,2,5,"ng-template",null,2,Ae)(6,Bt,4,4,"ng-template",null,3,Ae));},encapsulation:2,changeDetection:0});}return n;})();function zt(n,_){if(n&1&&(d(0,"option",4),Q(1),s()),n&2){let e=_.$implicit;f("value",e),a(),ae(e);}}function Wt(n,_){n&1&&(d(0,"span"),A(1,0),s()),n&2&&(a(),G(_),F(1));}function jt(n,_){n&1&&(d(0,"span"),A(1,1),s());}function Yt(n,_){if(n&1&&(u(0,Wt,2,1,"span"),u(1,jt,2,0,"span")),n&2){let e,t=r(2);E((e=t.form.controls.name.errors==null?null:t.form.controls.name.errors.pattern)?0:-1,e),a(),E(t.form.controls.name.errors!=null&&t.form.controls.name.errors.required?1:-1);}}function Ht(n,_){if(n&1&&(d(0,"div",7),u(1,Yt,2,2),s()),n&2){let e=r();a(),E(e.form.controls.name.touched?1:-1);}}var Nt=(()=>{class n{item=M.required();state=R(L);mode=this.state.router.rulesMode;categories=this.state.rules.categories;itemChanged=N();fb=R(De).nonNullable;form=this.fb.group({category:this.fb.control(""),name:this.fb.control("",{validators:[this.validateNamePattern(),ce.required.bind(this)]})});parser=R(_e);constructor(){V(()=>{this.item(),this.reset();});let e=Pe(this.form.valueChanges.pipe(Te(()=>this.form.valid)));V(()=>{let t=e();if(!t?.name)return;if(!t.category){this.addNewCategory();return;}let i=Me(new te(t.category,t.name));this.itemChanged.emit(this.parser.parseItem(i));}),V(()=>{this.mode()==="edit"?this.form.enable({emitEvent:!1}):this.form.disable({emitEvent:!1}),this.reset();});}blockPatch=!1;reset(){if(!this.blockPatch){let e=this.item().name;this.item().weight&&(e+=` ${St(this.item().weight)}`),this.form.patchValue({category:this.item().category,name:e},{emitEvent:!1});}}focus(e){this.blockPatch=document.activeElement===e.target,this.form.controls.name.value===te.NEW_ITEM_NAME&&this.form.controls.name.setValue("",{emitEvent:!1});}blur(){this.blockPatch=!1,this.reset();}async addNewCategory(e=""){let t=await Ct("Enter new category name",e);if(t)try{this.parser.validateCategoryName(t),this.form.patchValue({category:t});}catch(i){if(i instanceof oe){let o=i.found;await Fe("Category name cannot contain '"+o+"'");}else await Fe("Invalid category name");this.addNewCategory(t);}else this.reset();}validateNamePattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateItemNameAndWeight(t),null;}catch(i){return i instanceof oe?{pattern:i.found}:{pattern:!0};}};}static ɵfac=function(t){return new(t||n)();};static ɵcmp=I({type:n,selectors:[["app-editor-item"]],inputs:{item:[1,"item"]},outputs:{itemChanged:"itemChanged"},decls:8,vars:2,consts:()=>{let e;e="item";let t;t="category";let i;i="item name";let o;o="Item name cannot contain the character '"+"\uFFFD0\uFFFD"+"'";let l;return l="Item name is required",[o,l,["role","group","aria-label",e,1,"flex",3,"formGroup"],["name","categories","formControlName","category","aria-label",t,1,"max-w-[5rem]"],[3,"value"],["value",""],["type","text","formControlName","name","aria-label",i,1,"w-0","flex-1",3,"focus","blur"],["role","alert",1,"text-red-light","m-1","text-sm"]];},template:function(t,i){t&1&&(d(0,"form",2)(1,"select",3),D(2,zt,2,2,"option",4,ze),d(4,"option",5),Q(5,"+"),s()(),d(6,"input",6),m("focus",function(l){return i.focus(l);})("blur",function(){return i.blur();}),s()(),u(7,Ht,2,1,"div",7)),t&2&&(f("formGroup",i.form),a(2),x(i.categories()),a(5),E(i.mode()==="edit"&&i.form.valid===!1&&i.form.dirty?7:-1));},dependencies:[xe,be,ft,Lt,re,Pt,le,he,$e,ve],encapsulation:2,changeDetection:0});}return n;})();function Jt(n,_){n&1&&(d(0,"span"),A(1,0),s()),n&2&&(a(),G(_),F(1));}function Zt(n,_){n&1&&(d(0,"span"),A(1,1),s());}function ei(n,_){n&1&&(d(0,"span"),A(1,2),s());}function ti(n,_){if(n&1&&(d(0,"span"),A(1,3),s()),n&2){let e=r();a(),G(e),F(1);}}function ii(n,_){n&1&&u(0,ei,2,0,"span")(1,ti,2,1,"span"),n&2&&E(_===" "?0:1);}function ni(n,_){n&1&&(d(0,"span"),A(1,4),s());}function oi(n,_){n&1&&(d(0,"span"),A(1,5),s());}function _i(n,_){n&1&&(d(0,"span"),A(1,6),s());}function ri(n,_){if(n&1&&(d(0,"div",14),u(1,Jt,2,1,"span"),u(2,Zt,2,0,"span"),u(3,ii,2,1),u(4,ni,2,0,"span"),u(5,oi,2,0,"span"),u(6,_i,2,0,"span"),s()),n&2){let e,t,i=r();a(),E((e=i.form.controls.question.errors==null?null:i.form.controls.question.errors.pattern)?1:-1,e),a(),E(i.form.controls.question.errors!=null&&i.form.controls.question.errors.required?2:-1),a(),E((t=i.form.controls.variable.errors==null?null:i.form.controls.variable.errors.pattern)?3:-1,t),a(),E(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.required?4:-1),a(),E(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.reserved?5:-1),a(),E(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.used?6:-1);}}function li(n,_){if(n&1&&(d(0,"span"),A(1,7),s()),n&2){let e=r().$implicit;a(),G(e.variable),F(1);}}function ai(n,_){if(n&1&&(d(0,"span"),A(1,8),s()),n&2){let e=r().$implicit;a(),G(e.variable),F(1);}}function si(n,_){if(n&1&&u(0,li,2,1,"span")(1,ai,2,1,"span"),n&2){let e,t=_.$implicit;E((e=t.type)==="duplicate"?0:e==="unused"?1:-1);}}function di(n,_){if(n&1&&(d(0,"div",15),D(1,si,2,1,null,null,Y),s()),n&2){let e=r();a(),x(e.warnings());}}var Mt=(()=>{class n{question=M.required();parser=R(_e);state=R(L);mode=this.state.router.rulesMode;highlighVariable=C(()=>this.mode()!=="edit"&&this.state.config.highlightVariableStatus());variableActive=C(()=>this.state.active.answers()[this.question().variable]);refactorVariables=this.state.config.refactorVariables;warnings=C(()=>this.state.rules.parsed.hasValue()?(this.state.rules.parsed.value().warnings??[]).filter(e=>e.variable===this.question().variable):[]);questionChanged=N();variableChanged=N();fb=R(De).nonNullable;form=this.fb.group({question:this.fb.control("",{validators:[this.validateQuestionPattern(),ce.required.bind(this)]}),variable:this.fb.control("",{validators:[this.validateVariablePattern(),ui(),ce.required.bind(this)]})});constructor(){V(()=>{this.question(),this.reset();});let e=Pe(this.form.valueChanges.pipe(Te(()=>this.form.valid)));V(()=>{let t=e();if(t?.question&&t.question!==this.question().question&&t.variable)this.questionChanged.emit(new X(t.question,t.variable));else if(t?.variable&&t.variable.trim()!==this.question().variable){let i=this.warnings().find(o=>o.type==="duplicate");this.question().variable===X.NEW_VARIABLE_NAME||!this.refactorVariables()||i?this.questionChanged.emit(new X(this.question().question,t.variable.trim())):this.variableChanged.emit([this.question().variable,t.variable.trim()]);}}),V(()=>{this.mode()==="edit"?this.form.enable({emitEvent:!1}):this.form.disable({emitEvent:!1}),this.reset();});}reset(){this.form.patchValue(this.question(),{emitEvent:!1});}focusQuestion(){this.form.controls.question.value===X.NEW_QUESTION_NAME&&this.form.controls.question.setValue("",{emitEvent:!1});}focusVariable(){this.form.controls.variable.value===X.NEW_VARIABLE_NAME&&this.form.controls.variable.setValue("",{emitEvent:!1});}validateVariablePattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateVariableName(t),null;}catch(i){return i instanceof oe?{pattern:i.found}:{pattern:!0};}};}validateQuestionPattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateQuestionString(t),null;}catch(i){return i instanceof oe?{pattern:i.found}:{pattern:!0};}};}static ɵfac=function(t){return new(t||n)();};static ɵcmp=I({type:n,selectors:[["app-editor-question"]],inputs:{question:[1,"question"]},outputs:{questionChanged:"questionChanged",variableChanged:"variableChanged"},decls:7,vars:7,consts:()=>{let e;e="question";let t;t="question";let i;i="question";let o;o="variable";let l;l="variable";let P;P="Questions cannot contain this character: '"+"\uFFFD0\uFFFD"+"'";let h;h="Question is required";let g;g="Variables cannot contain spaces";let U;U="Variables cannot contain this character: '"+"\uFFFD0\uFFFD"+"'";let w;w="Variable name is required";let y;y="This variable name is reserved";let z;z="This variable name is already used";let W;W=" Variable "+"\uFFFD0\uFFFD"+" is declared more than once. ";let j;return j=" Variable "+"\uFFFD0\uFFFD"+" is not used in any condition. ",[P,h,g,U,w,y,z,W,j,["role","group","aria-label",e,1,"flex","flex-col",3,"formGroup"],["type","text","placeholder",t,"aria-label",i,"formControlName","question",1,"grow",3,"focus"],[1,"flex","items-center","gap-2"],[1,"ml-2","h-4"],["type","text","placeholder",o,"aria-label",l,"formControlName","variable",1,"grow","font-mono","font-bold",3,"focus"],["role","alert",1,"text-red","m-1","flex","flex-col","text-sm"],["role","status",1,"text-yellow-normal","m-1","flex","flex-col","text-sm"]];},template:function(t,i){t&1&&(d(0,"form",9)(1,"input",10),m("focus",function(){return i.focusQuestion();}),s(),d(2,"div",11),b(3,"app-icon-arrow-forward",12),d(4,"input",13),m("focus",function(){return i.focusVariable();}),s()(),u(5,ri,7,6,"div",14),u(6,di,3,0,"div",15),s()),t&2&&(f("formGroup",i.form),a(4),H("text-green",i.highlighVariable()&&i.variableActive())("text-red",i.highlighVariable()&&!i.variableActive()),a(),E(i.mode()==="edit"&&i.form.valid===!1&&i.form.dirty?5:-1),a(),E(i.mode()==="edit"&&i.warnings().length?6:-1));},dependencies:[xe,be,re,le,he,$e,ve,ct],encapsulation:2,changeDetection:0});}return n;})();function ui(){return n=>[de.string,Qe,Ke,qe,Xe].some(_=>_===n.value?.trim())?{reserved:!0}:null;}function Ei(n,_){if(n&1){let e=p();d(0,"button",10),m("click",function(){c(e);let i=r();return T(i.resetCondition());}),s();}}function ci(n,_){if(n&1&&(d(0,"span"),A(1,0),s()),n&2){let e=r().$implicit;a(),G(e.variable),F(1);}}function Ti(n,_){if(n&1&&u(0,ci,2,1,"span"),n&2){let e,t=_.$implicit;E((e=t.type)==="undeclared"?0:-1);}}function mi(n,_){if(n&1&&(d(0,"div",7),D(1,Ti,1,1,null,null,Y),s()),n&2){let e=r();a(),x(e.conditionWarnings());}}function Si(n,_){if(n&1){let e=p();d(0,"button",17),m("click",function(){c(e);let i=r(2).$index,o=r();return T(o.swapQuestions(i,i+1));}),s();}}function pi(n,_){n&1&&b(0,"span",16);}function Ri(n,_){if(n&1&&u(0,Si,1,0,"button",15)(1,pi,1,0,"span",16),n&2){let e=r(),t=e.$index,i=e.$count;E(t!==i-1?0:1);}}function Ci(n,_){if(n&1){let e=p();d(0,"button",18),m("click",function(){c(e);let i=r().$index,o=r();return T(o.deleteQuestion(i));}),s();}}function Ai(n,_){if(n&1){let e=p();d(0,"button",19),m("click",function(){c(e);let i=r().$index,o=r();return T(o.cutQuestion(i));}),s();}}function Pi(n,_){if(n&1){let e=p();d(0,"button",20),m("click",function(){c(e);let i=r().$index,o=r();return T(o.swapQuestions(i-1,i));}),s();}}function fi(n,_){if(n&1){let e=p();d(0,"div",4),u(1,Ri,2,1),d(2,"app-editor-question",11),m("questionChanged",function(i){let o=c(e).$index,l=r();return T(l.updateQuestion(o,i));})("variableChanged",function(i){c(e);let o=r();return T(o.variableChanged(i));}),s(),u(3,Ci,1,0,"button",12)(4,Ai,1,0,"button",13)(5,Pi,1,0,"button",14),s();}if(n&2){let e=_.$implicit,t=_.$index,i=_.$index,o=_.$count,l=r();a(),E(l.mode()==="swap"&&o>1?1:-1),a(),f("id",`r${l.index()}q${t}`)("question",e),a(),E(l.mode()==="delete"?3:l.mode()==="cut-paste"?4:l.mode()==="swap"&&i!==0?5:-1);}}function Li(n,_){if(n&1){let e=p();d(0,"button",26),m("click",function(){c(e);let i=r(2).$index,o=r();return T(o.swapItems(i,i+1));}),s();}}function gi(n,_){n&1&&b(0,"span",16);}function Oi(n,_){if(n&1&&u(0,Li,1,0,"button",25)(1,gi,1,0,"span",16),n&2){let e=r(),t=e.$index,i=e.$count;E(t!==i-1?0:1);}}function Ii(n,_){if(n&1){let e=p();d(0,"button",27),m("click",function(){c(e);let i=r().$index,o=r();return T(o.deleteItem(i));}),s();}}function Ni(n,_){if(n&1){let e=p();d(0,"button",28),m("click",function(){c(e);let i=r().$index,o=r();return T(o.cutItem(i));}),s();}}function Mi(n,_){if(n&1){let e=p();d(0,"button",29),m("click",function(){c(e);let i=r().$index,o=r();return T(o.swapItems(i-1,i));}),s();}}function hi(n,_){if(n&1){let e=p();d(0,"div",4),u(1,Oi,2,1),d(2,"app-editor-item",21),m("itemChanged",function(i){let o=c(e).$index,l=r();return T(l.updateItem(o,i));}),s(),u(3,Ii,1,0,"button",22)(4,Ni,1,0,"button",23)(5,Mi,1,0,"button",24),s();}if(n&2){let e=_.$implicit,t=_.$index,i=_.$index,o=_.$count,l=r();a(),E(l.mode()==="swap"&&o>1?1:-1),a(),f("id",`r${l.index()}i${t}`)("item",e),a(),E(l.mode()==="delete"?3:l.mode()==="cut-paste"?4:l.mode()==="swap"&&i!==0?5:-1);}}function bi(n,_){if(n&1){let e=p();d(0,"div",8)(1,"button",30),m("click",function(){c(e);let i=r();return T(i.addQuestion());}),A(2,1),s(),d(3,"button",31),m("click",function(){c(e);let i=r();return T(i.addItem());}),A(4,2),s()();}}function $i(n,_){if(n&1){let e=p();d(0,"button",34),m("click",function(){c(e);let i=r(2);return T(i.delete());}),s();}}function vi(n,_){if(n&1){let e=p();d(0,"button",35),m("click",function(){c(e);let i=r(2);return T(i.paste());}),s();}}function Di(n,_){if(n&1&&(d(0,"div",9),u(1,$i,1,0,"button",32),u(2,vi,1,0,"button",33),s()),n&2){let e=r();a(),E(e.mode()==="delete"?1:-1),a(),E(e.mode()==="cut-paste"?2:-1);}}var ht=(()=>{class n{index=M.required();rule=M.required();ruleChanged=N();deleteRule=N();renameVariable=N();state=R(L);mode=this.state.router.rulesMode;selectVariables=C(()=>{let e=this.rule().questions.map(i=>i.variable),t=this.state.rules.variables();return Array.from(t).filter(i=>!e.includes(i));});confirmRuleDeletion=this.state.config.confirmRuleDeletion;clipboard=R(Ve);refactor=R(Ne);conditionWarnings=C(()=>{let e=this.state.rules.parsed.hasValue()?this.state.rules.parsed.value().warnings??[]:[];if(e.length){let t=this.refactor.extractVariablesFromCondition(this.rule().condition);return e.filter(i=>t.has(i.variable));}else return[];});resetCondition(){this.updateCondition(new k());}updateCondition(e){let t=new ee(e,this.rule().questions,this.rule().items);this.ruleChanged.emit(t);}emitNewQuestions(e){let t=new ee(this.rule().condition,e,this.rule().items);this.ruleChanged.emit(t);}updateQuestion(e,t){let i=this.rule().questions;i[e]=t,this.emitNewQuestions(i);}addQuestion(){let e=new X(X.NEW_QUESTION_NAME,X.NEW_VARIABLE_NAME),t=this.rule().questions.length;this.updateQuestion(t,e),this.state.router.fragment.set(`r${this.index().toString()}q${t.toString()}`);}deleteQuestion(e){let t=this.rule().questions;t.splice(e,1),this.emitNewQuestions(t);}cutQuestion(e){let t=this.rule().questions[e];this.deleteQuestion(e),this.clipboard.cutQuestion(t);}swapQuestions(e,t){let i=this.rule().questions,o=i[e];i[e]=i[t],i[t]=o,this.emitNewQuestions(i);}emitNewItems(e){let t=new ee(this.rule().condition,this.rule().questions,e);this.ruleChanged.emit(t);}updateItem(e,t){let i=this.rule().items;i[e]=t,this.emitNewItems(i);}addItem(){let e=new te(te.NEW_CATEGORY_NAME,te.NEW_ITEM_NAME),t=this.rule().items.length;this.updateItem(t,e),this.state.router.fragment.set(`r${this.index().toString()}i${t.toString()}`);}deleteItem(e){let t=this.rule().items;t.splice(e,1),this.emitNewItems(t);}cutItem(e){let t=this.rule().items[e];this.deleteItem(e),this.clipboard.cutItem(t);}swapItems(e,t){let i=this.rule().items,o=i[e];i[e]=i[t],i[t]=o,this.emitNewItems(i);}paste(){let{questions:e,items:t}=this.clipboard.paste(),i=new ee(this.rule().condition,[...this.rule().questions,...e],[...this.rule().items,...t]);this.ruleChanged.emit(i);}variableChanged([e,t]){this.renameVariable.emit([e,t]);}async delete(){(!this.confirmRuleDeletion()||(await Rt("Do you really want to delete this rule?")))&&this.deleteRule.emit();}static ɵfac=function(t){return new(t||n)();};static ɵcmp=I({type:n,selectors:[["app-editor-rule"]],inputs:{index:[1,"index"],rule:[1,"rule"]},outputs:{ruleChanged:"ruleChanged",deleteRule:"deleteRule",renameVariable:"renameVariable"},decls:11,vars:5,consts:()=>{let e;e="condition";let t;t="reset condition";let i;i=" Variable "+"\uFFFD0\uFFFD"+" is not declared in any question. ";let o;o="delete question";let l;l="cut question";let P;P="move question up";let h;h="move question down";let g;g="delete item";let U;U="cut item";let w;w="move item up";let y;y="move item down";let z;z="add question";let W;W="add item";let j;j=" + Question ";let S;S=" + Item ";let we;we="delete rule";let ye;return ye="paste from clipboard",[i,j,S,["aria-label",e,"role","group"],[1,"mb-1","flex","items-center"],[1,"accessible-content","grow",3,"conditionChanged","condition","selectVariables"],["iconClear","","type","button","aria-label",t,1,"link"],["role","status",1,"text-yellow-normal","m-1","flex","flex-col","text-sm"],[1,"flex","justify-end","gap-2"],[1,"flex","justify-center"],["iconClear","","type","button","aria-label",t,1,"link",3,"click"],[1,"w-0","grow",3,"questionChanged","variableChanged","id","question"],["iconDelete","","type","button","aria-label",o,1,"link"],["iconCut","","type","button","aria-label",l,1,"link"],["iconArrowUpward","","type","button","aria-label",P,1,"link","p-1"],["iconArrowDownward","","type","button","aria-label",h,1,"link","p-1"],[1,"ml-6"],["iconArrowDownward","","type","button","aria-label",h,1,"link","p-1",3,"click"],["iconDelete","","type","button","aria-label",o,1,"link",3,"click"],["iconCut","","type","button","aria-label",l,1,"link",3,"click"],["iconArrowUpward","","type","button","aria-label",P,1,"link","p-1",3,"click"],[1,"grow",3,"itemChanged","id","item"],["iconDelete","","type","button","aria-label",g,1,"link"],["iconCut","","type","button","aria-label",U,1,"link"],["iconArrowUpward","","type","button","aria-label",w,1,"link","p-1"],["iconArrowDownward","","type","button","aria-label",y,1,"link","p-1"],["iconArrowDownward","","type","button","aria-label",y,1,"link","p-1",3,"click"],["iconDelete","","type","button","aria-label",g,1,"link",3,"click"],["iconCut","","type","button","aria-label",U,1,"link",3,"click"],["iconArrowUpward","","type","button","aria-label",w,1,"link","p-1",3,"click"],["type","button","aria-label",z,1,"h-8",3,"click"],["type","button","aria-label",W,1,"h-8",3,"click"],["iconDelete","","type","button","aria-label",we,1,"link"],["iconPaste","","type","button","aria-label",ye,1,"link"],["iconDelete","","type","button","aria-label",we,1,"link",3,"click"],["iconPaste","","type","button","aria-label",ye,1,"link",3,"click"]];},template:function(t,i){t&1&&(d(0,"div",3)(1,"div",4)(2,"app-editor-condition",5),m("conditionChanged",function(l){return i.updateCondition(l);}),s(),u(3,Ei,1,0,"button",6),s(),u(4,mi,3,0,"div",7),s(),D(5,fi,6,4,"div",4,Y),D(7,hi,6,4,"div",4,Y),u(9,bi,5,0,"div",8)(10,Di,3,2,"div",9)),t&2&&(a(2),f("condition",i.rule().condition)("selectVariables",i.selectVariables()),a(),E(i.mode()==="edit"?3:-1),a(),E(i.mode()==="edit"&&i.conditionWarnings().length?4:-1),a(),x(i.rule().questions),a(2),x(i.rule().items),a(2),E(i.mode()==="edit"?9:10));},dependencies:[Ot,Mt,Nt,Le,ut,st,ge,Tt,Et],encapsulation:2,changeDetection:0});}return n;})();function xi(n,_){if(n&1){let e=p();$(0,"input",2,0),ie("input",function(){c(e);let i=pe(1),o=r();return T(o.changed(i.value));}),v();}if(n&2){let e=r();K("disabled",!e.isEditMode())("value",e.currentTitle()??"");}}var bt=(()=>{class n{state=R(L);isEditMode=C(()=>this.state.router.rulesMode()==="edit");currentTitle=C(()=>this.state.rules.parsed.value().title);visible=C(()=>this.isEditMode()||!!this.currentTitle());titleChange=N();titleDebounce;changed(e){e!=this.currentTitle()&&(this.titleDebounce&&clearTimeout(this.titleDebounce),this.titleDebounce=setTimeout(()=>{this.titleChange.emit(e||void 0);},500));}static ɵfac=function(t){return new(t||n)();};static ɵcmp=I({type:n,selectors:[["app-editor-title"]],outputs:{titleChange:"titleChange"},decls:1,vars:1,consts:()=>{let e;e="title";let t;return t="Rules Title",[["title",""],["type","text","id","rules-title","placeholder",e,"aria-label",t,1,"card","my-1","w-full","outline-hidden",3,"disabled","value"],["type","text","id","rules-title","placeholder",e,"aria-label",t,1,"card","my-1","w-full","outline-hidden",3,"input","disabled","value"]];},template:function(t,i){t&1&&u(0,xi,2,2,"input",1),t&2&&E(i.visible()?0:-1);},encapsulation:2,changeDetection:0});}return n;})();var Vi=["button"],Ui=["*"],Ue=(()=>{class n{state=R(L);mode=this.state.router.rulesMode;type=M.required();label=M.required();disabled=M(!1);button=B("button");focusPrevious=N();focusNext=N();focus(){let e=this.button();e&&(e.nativeElement.focus(),this.mode.set(this.type()));}static ɵfac=function(t){return new(t||n)();};static ɵcmp=I({type:n,selectors:[["app-toolbar-button"]],viewQuery:function(t,i){t&1&&q(i.button,Vi,5),t&2&&ne();},inputs:{type:[1,"type"],label:[1,"label"],disabled:[1,"disabled"]},outputs:{focusPrevious:"focusPrevious",focusNext:"focusNext"},ngContentSelectors:Ui,decls:3,vars:6,consts:[["button",""],["type","button","role","radio",1,"link","h-full","w-full",3,"click","keypress","keydown.arrowLeft","keydown.arrowRight","tabIndex","disabled"]],template:function(t,i){if(t&1){let o=p();je(),$(0,"button",1,0),ie("click",function(){return c(o),T(i.mode.set(i.type()));})("keypress",function(){return c(o),T(i.mode.set(i.type()));})("keydown.arrowLeft",function(){return c(o),T(i.focusPrevious.emit());})("keydown.arrowRight",function(){return c(o),T(i.focusNext.emit());}),Ye(2),v();}t&2&&(H("active",i.mode()===i.type()),K("tabIndex",i.mode()===i.type()?0:-1)("disabled",i.disabled()),me("aria-label",i.label())("aria-checked",i.mode()===i.type()));},encapsulation:2,changeDetection:0});}return n;})();var wi=["searchInput"];function yi(n,_){if(n&1&&(d(0,"div",12),A(1,1),s()),n&2){r();let e=Ce(0),t=Ce(1),i=Ce(2);a(),G(e)(e)(i)(t)(t),F(1);}}function Gi(n,_){if(n&1&&(it(0)(1)(2),u(3,yi,2,5,"div",12)),n&2){let e=r(),t=Re(e.clipboardItems());a();let i=Re(e.clipboardQuestions());a(),Re(!!t&&!!i),a(),E(t>0||i>0?3:-1);}}function Fi(n,_){if(n&1){let e=p();d(0,"div",11)(1,"input",13,0),tt("ngModelChange",function(i){c(e);let o=r();return et(o.searchTerm,i)||(o.searchTerm=i),T(i);}),s(),d(3,"button",14),m("click",function(){c(e);let i=r();return T(i.clearSearch());}),s()();}if(n&2){let e=r();a(),Ze("ngModel",e.searchTerm);}}var $t=(()=>{class n{toolbarButtons=_t(Ue);noOfVisibleRules=M.required();state=R(L);mode=this.state.router.rulesMode;editable=C(()=>this.state.rules.mode()==="local");searchTerm=this.state.router.filterRulesQuery;clipboard=R(Ve);clipboardItems=this.clipboard.itemsCount;clipboardQuestions=this.clipboard.questionsCount;sticky=C(()=>this.state.browser.scrollY()>48);searchInput=B.required("searchInput");constructor(){V(()=>{this.toolbarButtons().forEach(e=>{e.focusNext.subscribe(()=>{this.focusNext();}),e.focusPrevious.subscribe(()=>{this.focusPrevious();});});});}focusNext(){let e=this.toolbarButtons(),t=e.length,i=e.findIndex(o=>o.type()===this.mode());if(i!==-1){let o=(i+1)%t;e[o].focus();}}focusPrevious(){let e=this.toolbarButtons(),t=e.length,i=e.findIndex(o=>o.type()===this.mode());if(i!==-1){let o=(i-1+t)%t;e[o].focus();}}focusSearch(){setTimeout(()=>{this.searchInput().nativeElement.focus();},50);}clearSearch(){this.searchTerm.set(""),this.focusSearch();}static ɵfac=function(t){return new(t||n)();};static ɵcmp=I({type:n,selectors:[["app-toolbar"]],viewQuery:function(t,i){t&1&&(q(i.toolbarButtons,Ue,5),q(i.searchInput,wi,5)),t&2&&ne(2);},inputs:{noOfVisibleRules:[1,"noOfVisibleRules"]},decls:16,vars:7,consts:()=>{let e;e="Editor Mode";let t;t="View";let i;i="Edit";let o;o="Delete";let l;l="Cut/Paste";let P;P="Swap";let h;h="Search";let g;g="clipboard";let U;U="{VAR_PLURAL, plural, =0 {} one {1 Item} other {{INTERPOLATION} Items}}",U=Se(U,{INTERPOLATION:"\uFFFD1\uFFFD",VAR_PLURAL:"\uFFFD0\uFFFD"});let w;w="{VAR_SELECT, select, true {and} other {}}",w=Se(w,{VAR_SELECT:"\uFFFD2\uFFFD"});let y;y="{VAR_PLURAL, plural, =0 {} one {1 Question} other {{INTERPOLATION} Questions}}",y=Se(y,{INTERPOLATION:"\uFFFD4\uFFFD",VAR_PLURAL:"\uFFFD3\uFFFD"});let z;z=" Clipboard: "+U+" "+w+" "+y+" ";let W;W="search in rules";let j;return j="clear search",[["searchInput",""],z,["role","toolbar","aria-orientation","horizontal",1,"bg-active","sticky","top-0","left-0","z-30","py-2"],["role","radiogroup","aria-label",e,1,"mb-1","grid","grid-cols-6","gap-2"],["type","view","label",t],[1,"my-auto","h-6","w-6"],["type","edit","label",i,3,"disabled"],["type","delete","label",o,3,"disabled"],["type","cut-paste","label",l,3,"disabled"],["type","swap","label",P,3,"disabled"],["type","search","label",h],[1,"mt-2","flex","items-center"],["role","status","aria-label",g,1,"mt-2","flex","justify-center","gap-4"],["type","text","role","searchbox","aria-label",W,1,"grow",3,"ngModelChange","ngModel"],["iconClear","","iconClass","h-6 w-6","type","button","aria-label",j,1,"link",3,"click"]];},template:function(t,i){t&1&&(d(0,"div",2)(1,"div",3)(2,"app-toolbar-button",4),b(3,"app-icon-view",5),s(),d(4,"app-toolbar-button",6),b(5,"app-icon-edit",5),s(),d(6,"app-toolbar-button",7),b(7,"app-icon-delete",5),s(),d(8,"app-toolbar-button",8),b(9,"app-icon-reorder",5),s(),d(10,"app-toolbar-button",9),b(11,"app-icon-swap",5),s(),d(12,"app-toolbar-button",10),b(13,"app-icon-search",5),s()(),u(14,Gi,4,4)(15,Fi,4,1,"div",11),s()),t&2&&(H("shadow-md",i.sticky()),a(4),f("disabled",!i.editable()||!i.noOfVisibleRules()&&!!i.searchTerm()),a(2),f("disabled",!i.editable()||!i.noOfVisibleRules()),a(2),f("disabled",!i.editable()||i.noOfVisibleRules()<2&&!i.clipboardItems()&&!i.clipboardQuestions()),a(2),f("disabled",!i.editable()||!i.noOfVisibleRules()),a(4),E(i.mode()==="cut-paste"?14:i.mode()==="search"||i.searchTerm()?15:-1));},dependencies:[gt,re,le,At,rt,dt,Le,at,fe,lt,ge,Ue],encapsulation:2,changeDetection:0});}return n;})();var Qi=(n,_,e)=>({disabled:n,"mb-[2.25rem]":_,"mb-12":e}),Ki=(n,_)=>_.index;function qi(n,_){if(n&1){let e=p();d(0,"button",10),m("click",function(){c(e);let i=r(2);return T(i.addRuleAndEdit());}),A(1,1),s();}}function Xi(n,_){if(n&1&&(d(0,"div",5)(1,"div",8)(2,"p"),A(3,0),s(),u(4,qi,2,0,"button",9),s()()),n&2){let e=r();a(4),E(e.editable()?4:-1);}}function ki(n,_){if(n&1){let e=p();d(0,"div",11)(1,"button",14),m("click",function(){c(e);let i=r().$implicit,o=r();return T(o.swapRules(i.index-1,i.index));}),s()();}}function Bi(n,_){if(n&1){let e=p();u(0,ki,2,0,"div",11),d(1,"div",12)(2,"app-editor-rule",13),m("ruleChanged",function(i){let o=c(e).$implicit,l=r();return T(l.updateRule(o.index,i));})("deleteRule",function(){let i=c(e).$implicit,o=r();return T(o.deleteRule(i.index));})("renameVariable",function(i){c(e);let o=r();return T(o.renameVariable(i));}),s()();}if(n&2){let e=_.$implicit,t=r();E(e.index>0&&t.mode()==="swap"&&!t.filter()?0:-1),a(),Je(ot(7,Qi,t.showAsDisabled(e.rule),(t.mode()==="view"||t.mode()==="search")&&t.accessibility()==="compact",(t.mode()==="view"||t.mode()==="search")&&t.accessibility()==="accessible")),f("id",`rule-${e.index}`),me("aria-label",t.ruleLabel(e.index)),a(),f("index",e.index)("rule",e.rule);}}function zi(n,_){if(n&1){let e=p();d(0,"button",15),m("click",function(){c(e);let i=r();return T(i.addRule());}),A(1,2),s();}}function Wi(n,_){if(n&1){let e=p();d(0,"a",16),m("click",function(){c(e);let i=r();return T(i.goToPacklist());}),b(1,"img",17),s();}}var mo=(()=>{class n{refactor=R(Ne);state=R(L);parsedRules=this.state.rules.parsed.value;activeRules=this.state.active.rules;rulesTitle=C(()=>this.parsedRules().title);mode=this.state.router.rulesMode;accessibility=this.state.config.accessibility;filter=this.state.router.filterRulesQuery;editable=C(()=>this.state.rules.mode()==="local");visibleRules=C(()=>this.filter()===""?this.parsedRules().map((t,i)=>({rule:t,index:i})):this.parsedRules().map((t,i)=>({rule:t,index:i})).filter(t=>{let i=this.filter();return!i||this.refactor.contains(t.rule,i);}));goToPacklistButtonVisible=C(()=>this.state.browser.scrollY()>100);ruleLabel(e){return"Rule #"+(e+1).toString()+"";}updateRules(e,t){e.title=t;let i=mt(e);this.state.localRules.updateRules(i);}updateTitle(e){this.updateRules(this.parsedRules(),e);}updateRule(e,t){let i=this.parsedRules();i[e]=t,this.updateRules([...i],this.rulesTitle());}deleteRule(e){let t=this.parsedRules();t.splice(e,1),this.updateRules([...t],this.rulesTitle());}addRule(){let e=this.parsedRules().length,t=[];for(let l=0;l<this.parsedRules().length;l++){let P=document.querySelector(`#rule-${l.toString()}`);if(P){let h=P.getBoundingClientRect();h.top>=0&&h.bottom<=window.innerHeight&&t.push(l);}}t.includes(e-1)||(e=t[0]+1);let i=new ee(new k()),o=this.parsedRules();o.splice(e,0,i),this.updateRules([...o],this.rulesTitle()),this.state.router.fragment.set(`rule-${(e||0).toString()}`);}addRuleAndEdit(){this.addRule(),setTimeout(()=>{this.mode.set("edit");},0);}swapRules(e,t){let i=this.parsedRules(),o=i[e];i[e]=i[t],i[t]=o,this.updateRules([...i],this.rulesTitle());}showAsDisabled(e){return this.state.config.fadeOutDisabledRules()&&!this.activeRules().includes(e);}renameVariable([e,t]){let i=this.refactor.renameVariable(e,t,this.parsedRules());this.updateRules([...i],this.rulesTitle());}goToPacklist(){this.state.router.go("packlist");}static ɵfac=function(t){return new(t||n)();};static ɵcmp=I({type:n,selectors:[["app-rules"]],decls:7,vars:4,consts:()=>{let e;e="Add rule";let t;t="Add rule";let i;i="There are no rules defined.";let o;o=" + Rule ";let l;l="Swap rule above with rule below";let P;P=" + Rule ";let h;return h="application icon",[i,o,P,[3,"noOfVisibleRules"],[3,"titleChange"],[1,"flex","h-[calc(100vh-4rem)]","items-center","justify-center"],["aria-label",e,"type","button",1,"fixed","bottom-2","z-50"],["aria-hidden","true",1,"fixed","right-2","bottom-2","z-50"],[1,"flex","flex-col","items-center","gap-6"],["aria-label",t,"type","button"],["aria-label",t,"type","button",3,"click"],[1,"flex","justify-center"],["role","group","tabindex","0",1,"card","mb-1",3,"id"],[3,"ruleChanged","deleteRule","renameVariable","index","rule"],["iconSwap","","type","button","aria-label",l,1,"link",3,"click"],["aria-label",e,"type","button",1,"fixed","bottom-2","z-50",3,"click"],["aria-hidden","true",1,"fixed","right-2","bottom-2","z-50",3,"click"],["alt",h,"src","icon.svg",1,"h-12"]];},template:function(t,i){t&1&&(b(0,"app-toolbar",3),d(1,"app-editor-title",4),m("titleChange",function(l){return i.updateTitle(l);}),s(),u(2,Xi,5,1,"div",5),D(3,Bi,3,11,null,null,Ki),u(5,zi,2,0,"button",6),u(6,Wi,2,0,"a",7)),t&2&&(f("noOfVisibleRules",i.visibleRules().length),a(2),E(!i.visibleRules().length&&!i.filter()?2:-1),a(),x(i.visibleRules()),a(2),E(i.mode()==="edit"&&!i.filter()&&i.visibleRules().length?5:-1),a(),E(i.goToPacklistButtonVisible()?6:-1));},dependencies:[ht,$t,fe,bt],encapsulation:2,changeDetection:0});}return n;})();export{mo as RulesComponent};/**i18n:02aae89da1045ac2cdc4a3c2bd37bfe4ea4a29a6a927b3235b2a5699c115d91b*/