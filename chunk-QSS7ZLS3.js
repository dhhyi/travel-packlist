import{h as _,i as ee,k as te}from"./chunk-GVLRKNS6.js";import{B as X,W as c,Z,_a as p,aa as o,bc as l,dc as b,oa as x,p as G}from"./chunk-QP6SEBO3.js";import{a as g,b as Y}from"./chunk-XVUYO3C5.js";var d=class{constructor(e,t=[],s=[]){this.condition=e;this.questions=t;this.items=s;}},f=class{constructor(e,t){this.question=e;this.variable=t;}static NEW_QUESTION_NAME="Neue Frage";static NEW_VARIABLE_NAME="new_variable";},K=class{constructor(e,t,s){this.category=e;this.name=t;this.weight=s;}static NEW_ITEM_NAME="Neuer Gegenstand";static NEW_CATEGORY_NAME="Neu";},u=class{constructor(e){this.variable=e;}evaluate(e){return e[this.variable];}},C=class r extends u{static string="please_select";constructor(){super(r.string);}},v=class r extends u{static string="always";constructor(){super(r.string);}evaluate(){return!0;}},h=class{constructor(e){this.not=e;}evaluate(e){return!this.not.evaluate(e);}},y=class{constructor(e,t){this.left=e;this.right=t;}evaluate(e){return this.left.evaluate(e)&&this.right.evaluate(e);}},m=class{constructor(e,t){this.left=e;this.right=t;}evaluate(e){return this.left.evaluate(e)||this.right.evaluate(e);}};var P=class r{serializeRules(e){return e.map(this.serialize.bind(this)).map(t=>t+";").join(`

`);}serializeEffects(e){return e.questions.map(this.serialize.bind(this)).concat(e.items.map(this.serialize.bind(this)));}serializeWeight(e,t,s=-1){if(!e)return"0g";let n=(s<0?e/1e3:(e/1e3).toFixed(s)).toString()+"kg",i=(e*1).toString()+"g";return t?t==="kg"?n:i:n.length<=i.length?n:i;}serialize(e){if(e instanceof d){let s=[];if(!(e.condition instanceof v)){let i=this.serialize(e.condition);i&&s.push(i," ");}s.push(":-");let n=this.serializeEffects(e);if(n.length===1&&s.length===1)s.push(" ",n[0]);else for(let i=0;i<n.length;i++){let S=n[i];i>0&&s.push(","),s.push(`
`,"   ",S);}return s.join("");}else{if(e instanceof f)return e.question+" $"+e.variable;if(e instanceof K){let s=`[${e.category}] ${e.name}`.trim();return e.weight&&(s+=" "+this.serializeWeight(e.weight)),s;}else{if(e instanceof u)return e.variable;if(e instanceof h)return"NOT "+this.serialize(e.not);if(e instanceof y)return this.serialize(e.left)+" AND "+this.serialize(e.right);if(e instanceof m)return this.serialize(e.left)+" OR "+this.serialize(e.right);}}let t=e;throw new Error("Cannot serialize unknown input",t);}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});};var le={isTrackWeight:()=>!1},ce=new Z("PARSER_CONFIG_PROVIDER"),se=/^\s*\[(?<category>.+?)\]\s*(?<name>.+)\s*$/,re=/^\s*(?<question>.*)\s+\$(?<variable>[^ ]+)\s*$/,I=class r{injector=o(x);parseCondition(e){let t=e.replaceAll(/NOT\s+NOT/g,"").trim().split(" ");if(t.includes("OR")){let s=t.indexOf("OR");return new m(this.parseCondition(t.slice(0,s).join(" ")),this.parseCondition(t.slice(s+1).join(" ")));}else if(t.includes("AND")){let s=t.indexOf("AND");return new y(this.parseCondition(t.slice(0,s).join(" ")),this.parseCondition(t.slice(s+1).join(" ")));}else{if(t[0]==="NOT")return new h(this.parseCondition(t.slice(1).join(" ")));if(t.length===1&&t[0].trim()){let s=t[0].trim();return s===v.string?new v():s===C.string?new C():new u(s);}else throw new Error("Konnte keine Bedingung in '"+e+"' parsen");}}parseQuestion(e){let t=re.exec(e);if(!t?.groups)throw new Error("Konnte keine Frage in '"+e+"' parsen");return new f(t.groups.question,t.groups.variable);}isTrackWeight(){return this.injector.get(ce,le).isTrackWeight();}extractItemNameAndWeight(e,t=!1){if(!e)return["",0];if(!t&&!this.isTrackWeight())return[e.trim(),0];let s=/^(.+)\s+(\d+(\.\d+)?)(k?g)?$/.exec(e.trim());if(s){let n=s[1].trim(),i=parseFloat(s[2])*(s[4]==="kg"?1e3:1);return[n,i];}else return[e.trim(),0];}parseItem(e){let t=se.exec(e);if(!t?.groups)throw new Error("Konnte keinen Gegenstand in '"+e+"' parsen");let[s,n]=this.extractItemNameAndWeight(t.groups.name);return new K(t.groups.category,s,n);}parseEffects(e){let t=e.split(",").map(i=>i.trim()).filter(Boolean),s=[],n=[];for(let i of t)if(re.test(i))s.push(this.parseQuestion(i));else if(se.test(i))n.push(this.parseItem(i));else throw new Error("Konnte keinen Effekt in '"+i+"' parsen");return{questions:s,items:n};}parseRule(e){let t=e.split(":-");if(t.length!==2)throw new Error("Konnte keine Regel in '"+e+"' parsen");let s;t[0].trim()?s=this.parseCondition(t[0]):s=new v();let{questions:n,items:i}=this.parseEffects(t[1]);return new d(s,n,i);}parseRules(e){return e.split(`
`).filter(s=>!s.trim().startsWith("#")).map(s=>s.replace(/#.*/,"")).join(`
`).split(";").map(s=>s.trim()).filter(Boolean).map(this.parseRule.bind(this));}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});};var O=class r{serializer=o(P);parser=o(I);extractVariables(e){return e.reduce((t,s)=>[...t,...s.questions.map(n=>n.variable)],[]);}extractCategories(e){let t=new Set();for(let s of e)for(let n of s.items)t.add(n.category);return Array.from(t);}renameVariable(e,t,s){if(s instanceof Array)return s.map(i=>this.renameVariable(e,t,i));if(s instanceof f)return s.variable===e?new f(s.question,t):s;if(s instanceof d)return new d(this.renameVariable(e,t,s.condition),s.questions.map(i=>this.renameVariable(e,t,i)),s.items);if(s instanceof u)return s.variable===e?new u(t):s;if(s instanceof h)return new h(this.renameVariable(e,t,s.not));if(s instanceof y)return new y(this.renameVariable(e,t,s.left),this.renameVariable(e,t,s.right));if(s instanceof m)return new m(this.renameVariable(e,t,s.left),this.renameVariable(e,t,s.right));let n=s;throw new Error("Unknown item type",n);}filterActive(e){let t=e.rules.filter(n=>n.condition.evaluate(e.model)),s=this.extractVariables(t).reduce((n,i)=>Y(g({},n),{[i]:e.model[i]}),{});return t.length===e.rules.length?{model:s,rules:t}:this.filterActive({model:s,rules:t});}contains(e,t){let s=t.toLowerCase();if(e instanceof d)return this.contains(e.condition,t)||e.questions.some(i=>this.contains(i,t))||e.items.some(i=>this.contains(i,t));if(e instanceof f)return e.question.toLowerCase().includes(s)||e.variable.toLowerCase().includes(s);if(e instanceof K)return e.category.toLowerCase().includes(s)||e.name.toLowerCase().includes(s);if(e instanceof u)return e.variable.toLowerCase().includes(s);if(e instanceof h)return this.contains(e.not,t);if(e instanceof y)return this.contains(e.left,t)||this.contains(e.right,t);if(e instanceof m)return this.contains(e.left,t)||this.contains(e.right,t);let n=e;throw new Error("Unknown item type",n);}countItemsAndWeights(e){return e.reduce((t,s)=>s.items.reduce((n,i)=>{let S;if(this.parser.isTrackWeight())S=i.weight?1:0;else{let[,W]=this.parser.extractItemNameAndWeight(this.serializer.serialize(i),!0);S=W?1:0;}return{items:n.items+1,weights:n.weights+S};},t),{items:0,weights:0});}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});};var ie=`:-
   [N\xFCtzliches] Papiertaschent\xFCcher,
   [N\xFCtzliches] Rucksack;

:- Reist du l\xE4nger als 3 Tage? $longer;

longer :-
   Hast du eine Waschmaschine oder einen W\xE4scheservice zur Verf\xFCgung? $laundry,
   Willst du arbeiten? $work,
   [Elektronik] Handy-Ladeger\xE4t,
   [Elektronik] Tablet;

longer AND NOT laundry :-
   [Kleidung] genug Hemden,
   [Kleidung] genug Unterw\xE4sche,
   [Kleidung] Ersatzhosen;

laundry :-
   [Kleidung] 3 Hemden,
   [Kleidung] 3 S\xE4tze Unterw\xE4sche;

work :-
   [Elektronik] Laptop;

:-
   Wird es sonnig sein? $sunny,
   Wird es regnerisch sein? $rainy,
   Reist du ins Ausland? $abroad;

sunny :-
   Erwartest du einen hohen UV-Index? $uv,
   [N\xFCtzliches] Sonnenbrille,
   [Kleidung] Kurze Hosen;

rainy :-
   [Kleidung] Regenjacke;

NOT rainy :-
   [Kleidung] Jacke;

NOT sunny :-
   [Kleidung] Lange Hosen;

uv :-
   [N\xFCtzliches] Sonnencreme;

abroad :-
   [Dokumente] Reisepass,
   [Dokumente] Visum;
`;function z(r,e){let t=r.getItem("state"),s;if(t){let n=JSON.parse(t);s=g(g({},e),n);}else s=g({},e);return s;}function ne(r,e){if(typeof r!=typeof e)return!1;if(r&&e&&typeof r=="object"){let t=Object.keys(r),s=Object.keys(e);return t.length===s.length&&t.every(n=>ne(r[n],e[n]));}return r===e;}function ue(r,e){let t=Object.keys(e).filter(s=>!ne(r[s],e[s])).map(s=>[s,r[s]]);return t.length===0?null:Object.fromEntries(t);}function V(r,e,t){let s=ue(e,t);s===null?r.removeItem("state"):r.setItem("state",JSON.stringify(s));}var ae=["en","de"],M={answers:{},checkedItems:[],collapsedCategories:[],rules:void 0,fadeOutDisabledRules:!1,highlightVariableStatus:!1,refactorVariables:!0,categorySorting:"alphabetically",trackWeight:!1,answersLocked:!1,theme:"system",fontSize:"normal",language:"auto",exportReminder:!1,lastExportHash:"",lastExportDate:0},q=Object.keys(M),k=class r{state=z(localStorage,M);injector=o(x);signalMap=new Map();constructor(){this.loadLegacyState(),this.initializeSignals();}initializeSignals(){for(let e of q){let t=p(this.state[e]);b(()=>{let s=t();s!==this.state[e]&&(this.state[e]=s,this.persist());},{manualCleanup:!0,injector:this.injector}),this.signalMap.set(e,t);}}loadLegacyState(){if(localStorage.getItem("answers")&&(this.state.answers=JSON.parse(localStorage.getItem("answers")),localStorage.removeItem("answers")),localStorage.getItem("checkedItems")&&(this.state.checkedItems=JSON.parse(localStorage.getItem("checkedItems")),localStorage.removeItem("checkedItems")),localStorage.getItem("collapsedCategories")&&(this.state.collapsedCategories=JSON.parse(localStorage.getItem("collapsedCategories")),localStorage.removeItem("collapsedCategories")),localStorage.getItem("rules")&&(this.state.rules=localStorage.getItem("rules"),localStorage.removeItem("rules")),localStorage.getItem("config")){let e=JSON.parse(localStorage.getItem("config"));this.state.fadeOutDisabledRules=e.fadeOutDisabledRules,this.state.trackWeight=e.trackWeight,this.state.answersLocked=e.answersLocked,this.state.theme=e.theme,this.state.language=e.language,localStorage.removeItem("config");}this.persist();}persist(){V(localStorage,this.state,M);}handles(e){return q.includes(e);}signal(e){return this.signalMap.get(e);}set(e,t){this.signal(e).set(t);}get(e){return this.signal(e)();}reset(){this.state=g({},M),this.persist(),q.forEach(e=>{this.signal(e).set(M[e]);});}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});};var N=class r{state=o(k);parser=o(I);refactor=o(O);signalMap=new Map();constructor(){this.initializeSignals();}initializeSignals(){this.signalMap.set("isMobile",l(()=>{let a=navigator.userAgent;return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(a);}));let e=p(window.scrollY);window.addEventListener("scroll",()=>{e.set(window.scrollY);}),this.signalMap.set("scrollY",e.asReadonly()),this.signalMap.set("preferredLanguage",l(()=>{let a=this.state.signal("language")();return a==="auto"?navigator.languages.map(R=>R.split("-")[0]).find(R=>ae.includes(R))??"en":a;})),this.signalMap.set("rulesContainComments",l(()=>{let a=this.state.signal("rules")();return!!a&&a.includes("#");}));let t=l(()=>{let a=this.state.signal("rules")();return a||ie;});this.signalMap.set("rulesOrTemplate",t);let s=l(()=>{try{return{parsedRules:this.parser.parseRules(t()),ruleParserError:""};}catch(a){a instanceof Error?console.warn(a.message):console.error(a);let T=a instanceof Error?a.message:"An unknown error occurred";return{parsedRules:[],ruleParserError:T};}}),n=l(()=>{let{ruleParserError:a,parsedRules:T}=s();if(!a){let{items:j,weights:R}=this.refactor.countItemsAndWeights(T);return R/j;}return 0;});this.signalMap.set("percentageOfItemsWithWeights",n);let i=l(()=>s().parsedRules);this.signalMap.set("parsedRules",i),this.signalMap.set("ruleParserError",l(()=>s().ruleParserError)),this.signalMap.set("categories",l(()=>this.refactor.extractCategories(i()))),this.signalMap.set("variables",l(()=>this.refactor.extractVariables(i())));let S=l(()=>this.refactor.filterActive({rules:i(),model:this.state.signal("answers")()})),W=l(()=>S().rules);this.signalMap.set("activeRules",W),this.signalMap.set("activeAnswers",l(()=>S().model)),this.signalMap.set("activeQuestions",l(()=>W().flatMap(a=>a.questions))),this.signalMap.set("activeItems",l(()=>W().flatMap(a=>a.items)));let B=l(()=>pe(t()).toString(16));this.signalMap.set("rulesHash",B);let D=p(new Date().getTime());this.signalMap.set("lastRulesAction",D.asReadonly()),b(()=>{t(),D.set(new Date().getTime());}),this.signalMap.set("exportFileName",l(()=>{let a=new Date(D()).toISOString().replace(/\..*$/,"").replace(/[T:]/g,"-"),T=B();return`travel-packlist-rules-${a}-${T}.txt`;})),this.signalMap.set("exportNeeded",l(()=>{let a=this.signal("rulesHash")(),T=this.state.signal("lastExportHash")(),j=a!==T;return!!this.state.signal("rules")()&&j;}));}handles(e){return this.signalMap.has(e);}signal(e){return this.signalMap.get(e);}get(e){return this.signal(e)();}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});},pe=function(r,e=0){let t=3735928559^e,s=1103547991^e;for(let n=0,i;n<r.length;n++)i=r.charCodeAt(n),t=Math.imul(t^i,2654435761),s=Math.imul(s^i,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&s)+(t>>>0);};var Q={rulesMode:"view",filterRulesQuery:void 0},F=Object.keys(Q),A=class r{route=o(ee);router=o(te);signalMap=new Map();constructor(){for(let e of F)this.signalMap.set(e,this.createSignal(e));}createSignal(e){let t=p(void 0);return this.router.events.pipe(X(s=>s instanceof _),G(()=>this.route.snapshot.queryParams[e]??Q[e])).subscribe(s=>{s!==""&&t.set(s);}),b(()=>{let s=t()||void 0;s===Q[e]&&(s=void 0),this.route.snapshot.queryParams[e]!==s&&this.router.navigate([],{queryParams:{[e]:s},queryParamsHandling:"merge",relativeTo:this.route,replaceUrl:!0});}),t;}handles(e){return F.includes(e);}signal(e){return this.signalMap.get(e);}get(e){return this.signal(e)();}set(e,t){this.signal(e).set(t);}reset(){for(let e of F)this.signal(e).set(void 0);}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});};var E={clipboardItems:[],clipboardQuestions:[]},H=Object.keys(E),$=class r{state=z(sessionStorage,E);injector=o(x);signalMap=new Map();constructor(){this.initializeSignals();}initializeSignals(){for(let e of H){let t=p(this.state[e]);b(()=>{let s=t();s!==this.state[e]&&(this.state[e]=s,this.persist());},{manualCleanup:!0,injector:this.injector}),this.signalMap.set(e,t);}}persist(){V(sessionStorage,this.state,E);}handles(e){return H.includes(e);}signal(e){return this.signalMap.get(e);}set(e,t){this.signal(e).set(t);}get(e){return this.signal(e)();}reset(){this.state=g({},E),this.persist(),H.forEach(e=>{this.signal(e).set(E[e]);});}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});};var J={serviceWorkerStatus:"init"},U=Object.keys(J),L=class r{signalMap=new Map();constructor(){this.initializeSignals();}initializeSignals(){for(let e of U){let t=p(J[e]);this.signalMap.set(e,t);}}handles(e){return U.includes(e);}signal(e){return this.signalMap.get(e);}get(e){return this.signal(e)();}set(e,t){this.signal(e).set(t);}reset(){for(let e of U)this.signal(e).set(J[e]);}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});};var oe=class r{persistent=o(k);router=o(A);session=o($);transient=o(L);derived=o(N);get(e){if(this.persistent.handles(e))return this.persistent.get(e);if(this.router.handles(e))return this.router.get(e);if(this.session.handles(e))return this.session.get(e);if(this.transient.handles(e))return this.transient.get(e);if(this.derived.handles(e))return this.derived.get(e);throw new Error(`Key ${e} not handled in state`);}signal(e){if(this.persistent.handles(e))return this.persistent.signal(e);if(this.router.handles(e))return this.router.signal(e);if(this.session.handles(e))return this.session.signal(e);if(this.transient.handles(e))return this.transient.signal(e);if(this.derived.handles(e))return this.derived.signal(e);throw new Error(`Key ${e} not handled in state`);}set(e,t){if(this.persistent.handles(e))this.persistent.signal(e).set(t);else if(this.router.handles(e))this.router.set(e,t);else if(this.session.handles(e))this.session.set(e,t);else if(this.transient.handles(e))this.transient.set(e,t);else throw this.derived.handles(e)?new Error("Key is derived and cannot be set"):new Error(`Key ${e} not handled in state`);}reset(){this.persistent.reset(),this.session.reset(),this.router.reset();}static ɵfac=function(t){return new(t||r)();};static ɵprov=c({token:r,factory:r.ɵfac,providedIn:"root"});};export{d as a,f as b,K as c,u as d,C as e,v as f,h as g,y as h,m as i,ce as j,I as k,P as l,O as m,oe as n};/**i18n:717214697a29241ab35fda4f803c9965e2e966609f94cbb4e7c0189a1847a6bb*/