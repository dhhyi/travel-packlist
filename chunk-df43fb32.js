import{c as Tt,d as $e}from"./chunk-3cba9ce3.js";import{a as ot,b as Ee,c as _t,d as lt,e as rt,k as at,m as me,n as st,p as pe,r as dt,s as ut,t as ct}from"./chunk-5d55dd8d.js";import{b as J,c as re,d as Z,e as Se,f as Rt,g as Ce,i as Pe,j as Ae,k as St,l as Ct,m as Pt,n as fe,o as At,p as Le,q as xe,r as ge}from"./chunk-7409a0ae.js";import{a as Et,b as mt,c as B,d as y,e as z,f as Te,g as D,h as oe,i as Re,j as _e,k as le,l as Y,n as H,o as pt,q as g}from"./chunk-1945fd1c.js";import{e as nt}from"./chunk-1549b54a.js";import{$a as Q,$b as L,Aa as d,Ab as w,B as se,Bb as j,Cb as Ye,Da as X,Db as U,E as de,Eb as ie,Fa as Me,Fb as ne,Ga as ke,Ha as G,Hb as He,Ia as Ke,Ib as Je,Jb as Ze,Ma as M,Ob as et,Q as qe,Qb as tt,Ra as p,T as Fe,Ub as ce,W as Qe,Ya as ue,_a as S,aa as P,ab as Xe,bc as x,cb as u,db as te,eb as Be,fb as q,gb as F,hb as r,ia as c,ib as l,ja as E,jb as T,kb as ze,kc as it,l as ae,lb as C,ob as A,p as Ne,pb as k,qb as K,rb as ve,sa as N,sb as m,ta as b,tb as a,ub as We,vb as je,x as Ge}from"./chunk-d4b54af9.js";import"./chunk-4b3a42dc.js";var Oe=(()=>{class n{parser=P(H);state=P(g);questions=this.state.signal("clipboardQuestions");items=this.state.signal("clipboardItems");itemsCount=L(()=>this.items().length);questionsCount=L(()=>this.questions().length);cutQuestion(e){this.questions.update(t=>[...t,e.toString()]);}cutItem(e){this.items.update(t=>[...t,e.toString()]);}paste(){let e={questions:this.questions().map(t=>this.parser.parseQuestion(t)),items:this.items().map(t=>this.parser.parseItem(t))};return this.questions.set([]),this.items.set([]),e;}static ɵfac=function(t){return new(t||n)();};static ɵprov=Qe({token:n,factory:n.ɵfac,providedIn:"root"});}return n;})();var ht=["content"],Nt=["keyword"],Mt=["variable"],vt=["select"],$t=n=>({width:n});function xt(n,_){if(n&1&&(r(0,"span",5),U(1),l()),n&2){let e=_.$implicit;d(),ie(e);}}function Vt(n,_){if(n&1&&(r(0,"span",6),U(1),l()),n&2){let e=_.$implicit,t=a();Q("text-green",t.highlighVariable()&&t.variableActive(e))("text-red",t.highlighVariable()&&!t.variableActive(e)),d(),ie(e);}}function Ut(n,_){if(n&1&&(r(0,"option",8),U(1),l()),n&2){let e=a(2).$implicit,t=a();S("value",t.NOT),d(),ne("NOT ",t.variablePlaceholder(e),"");}}function wt(n,_){if(n&1&&(r(0,"option",8),U(1),l()),n&2){let e=a(2).$implicit,t=a();S("value",t.AND),d(),ne("",t.variablePlaceholder(e)," AND x");}}function yt(n,_){if(n&1&&(r(0,"option",8),U(1),l()),n&2){let e=a(2).$implicit,t=a();S("value",t.OR),d(),ne("",t.variablePlaceholder(e)," OR x");}}function Dt(n,_){if(n&1&&(r(0,"option",8),U(1,"REMOVE"),l()),n&2){let e=a(4);S("value",e.REMOVE);}}function Gt(n,_){if(n&1&&p(0,Dt,2,1,"option",8),n&2){let e=a(2).$implicit,t=a();u(e!==t.PLEASE_SELECT?0:-1);}}function qt(n,_){if(n&1&&(r(0,"option",9),U(1),l()),n&2){let e=a().$implicit,t=a().$implicit,i=a();S("value",e)("selected",t===e)("disabled",e===i.PLEASE_SELECT),d(),ne(" ",e," ");}}function Ft(n,_){if(n&1&&p(0,Ut,2,2,"option",8)(1,wt,2,2,"option",8)(2,yt,2,2,"option",8)(3,Gt,1,1)(4,qt,2,4,"option",9),n&2){let e,t=_.$implicit,i=a(2);u((e=t)===i.NOT?0:e===i.AND?1:e===i.OR?2:e===i.REMOVE?3:4);}}function Qt(n,_){if(n&1){let e=C();r(0,"select",7,4),m("change",function(){let i=c(e),o=i.$implicit,s=i.selection,R=Ye(1);return E(s(R.value,o));}),q(2,Ft,5,1,null,null,te),l();}if(n&2){let e=_.options,t=_.width;Xe(et(2,$t,t)),d(2),F(e);}}var Ve="NOT",Ue="AND",we="OR",ye="REMOVE",ft=(()=>{class n{condition=b.required();selectVariables=b.required();content=G.required("content",{read:Me});keywordTemplate=G.required("keyword",{read:X});variableTemplate=G.required("variable",{read:X});selectTemplate=G.required("select",{read:X});state=P(g);activeAnswers=this.state.signal("activeAnswers");mode=this.state.signal("rulesMode");highlighVariable=L(()=>this.mode()!=="edit"&&this.state.signal("highlightVariableStatus")());serializedCondition=L(()=>this.condition().toString());PLEASE_SELECT=D.string;ALWAYS=oe.string;NOT=Ve;AND=Ue;OR=we;REMOVE=ye;conditionChanged=N();constructor(){x(()=>{this.mode(),this.condition(),this.selectVariables(),this.repaint();});}repaint(){this.content().clear(),this.paintKeyword("IF"),this.paintCondition(this.condition(),e=>{e?this.conditionChanged.emit(e):this.conditionChanged.emit(new D());});}calculateOptions(e){return[this.PLEASE_SELECT,this.ALWAYS,...this.selectVariables(),this.NOT,this.AND,this.OR,this.REMOVE].filter(t=>!e.includes(t));}createFromPrevious(e){return e===this.PLEASE_SELECT||e===this.ALWAYS?new D():new Te(e);}selection(e,t){return e===this.NOT?new Re(this.createFromPrevious(t)):e===this.AND?new _e(this.createFromPrevious(t),new D()):e===this.OR?new le(this.createFromPrevious(t),new D()):e===this.REMOVE?null:e===this.ALWAYS?new oe():new Te(e);}paintKeyword(e){this.content().createEmbeddedView(this.keywordTemplate(),{$implicit:e});}paintSelect(e,t,i){this.content().createEmbeddedView(this.selectTemplate(),{$implicit:e,options:this.calculateOptions(i),selection:(o,s)=>{t(this.selection(o,s));},width:(e.length*9+30).toString()+"px"});}paintVariable(e){this.content().createEmbeddedView(this.variableTemplate(),{$implicit:e});}paintCondition(e,t,i=[]){if(e instanceof Re){let o=i.filter(s=>s!==this.ALWAYS);this.paintKeyword("NOT"),this.paintCondition(e.not,s=>{t(s?new Re(s):null);},o);}else if(e instanceof _e){let o=[...i,this.ALWAYS];this.paintCondition(e.left,s=>{t(s?new _e(s,e.right):e.right);},o),this.paintKeyword("AND"),this.paintCondition(e.right,s=>{t(s?new _e(e.left,s):e.left);},o);}else if(e instanceof le){let o=[...i,this.ALWAYS];this.paintCondition(e.left,s=>{t(s?new le(s,e.right):e.right);},o),this.paintKeyword("OR"),this.paintCondition(e.right,s=>{t(s?new le(e.left,s):e.left);},o);}else e instanceof Te&&(this.mode()==="edit"?this.paintSelect(e.variable,t,i):this.paintVariable(e.variable));}variableActive(e){return this.activeAnswers()[e];}variablePlaceholder(e){return e===this.ALWAYS||e===this.PLEASE_SELECT?"x":e;}static ɵfac=function(t){return new(t||n)();};static ɵcmp=M({type:n,selectors:[["app-editor-condition"]],viewQuery:function(t,i){t&1&&(w(i.content,ht,5,Me),w(i.keywordTemplate,Nt,5,X),w(i.variableTemplate,Mt,5,X),w(i.selectTemplate,vt,5,X)),t&2&&j(4);},inputs:{condition:[1,"condition"],selectVariables:[1,"selectVariables"]},outputs:{conditionChanged:"conditionChanged"},decls:8,vars:0,consts:()=>{let e;return e="variable",[["content",""],["keyword",""],["variable",""],["select",""],["selectbox",""],["role","text",1,"font-bold"],[1,"font-mono","font-bold"],["role","combobox","aria-label",e,1,"font-mono",3,"change"],[3,"value"],[3,"value","selected","disabled"]];},template:function(t,i){t&1&&(ze(0,null,0),p(2,xt,2,1,"ng-template",null,1,ce)(4,Vt,2,5,"ng-template",null,2,ce)(6,Qt,4,4,"ng-template",null,3,ce));},styles:["[_nghost-%COMP%]{display:flex;min-height:2rem;flex-direction:row;flex-wrap:wrap;align-items:center;justify-content:flex-start;gap:.5rem}"],changeDetection:0});}return n;})();function kt(n,_){if(n&1&&(r(0,"option",4),U(1),l()),n&2){let e=_.$implicit;S("value",e),d(),ie(e);}}function Kt(n,_){n&1&&(r(0,"span"),A(1,0),l()),n&2&&(d(),k(_),K(1));}function Xt(n,_){n&1&&(r(0,"span"),A(1,1),l());}function Bt(n,_){if(n&1&&p(0,Kt,2,1,"span")(1,Xt,2,0,"span"),n&2){let e,t=a(2);u((e=t.form.controls.name.errors==null?null:t.form.controls.name.errors.pattern)?0:-1,e),d(),u(t.form.controls.name.errors!=null&&t.form.controls.name.errors.required?1:-1);}}function zt(n,_){if(n&1&&(r(0,"div",7),p(1,Bt,2,2),l()),n&2){let e=a();d(),u(e.form.controls.name.touched?1:-1);}}var gt=(()=>{class n{item=b.required();state=P(g);mode=this.state.signal("rulesMode");categories=this.state.signal("categories");itemChanged=N();fb=P(fe).nonNullable;form=this.fb.group({category:this.fb.control(""),name:this.fb.control("",{validators:[this.validateNamePattern(),re.required.bind(this)]})});parser=P(H);constructor(){x(()=>{this.item(),this.reset();});let e=ge(this.form.valueChanges.pipe(de(500),se(()=>this.form.valid)));x(()=>{let t=e();if(!t?.name)return;if(!t.category){this.addNewCategory();return;}let i=new z(t.category,t.name).toString();this.itemChanged.emit(this.parser.parseItem(i));}),x(()=>{this.mode()==="edit"?this.form.enable({emitEvent:!1}):this.form.disable({emitEvent:!1}),this.reset();});}blockPatch=!1;reset(){if(!this.blockPatch){let e=this.item().name;this.item().weight&&(e+=` ${mt(this.item().weight)}`),this.form.patchValue({category:this.item().category,name:e},{emitEvent:!1});}}focus(e){this.blockPatch=document.activeElement===e.target,this.form.controls.name.value===z.NEW_ITEM_NAME&&this.form.controls.name.setValue("",{emitEvent:!1});}blur(){this.blockPatch=!1,this.reset();}async addNewCategory(e=""){let t=await Tt("Enter new category name",e);if(t)try{this.parser.validateCategoryName(t),this.form.patchValue({category:t});}catch(i){if(i instanceof Y){let o=i.found;await $e("Category name cannot contain '"+o+"'");}else console.error(i),await $e("Invalid category name");this.addNewCategory(t);}else this.reset();}validateNamePattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateItemNameAndWeight(t),null;}catch(i){return e.markAsTouched(),i instanceof Y?{pattern:i.found}:{pattern:!0};}};}static ɵfac=function(t){return new(t||n)();};static ɵcmp=M({type:n,selectors:[["app-editor-item"]],inputs:{item:[1,"item"]},outputs:{itemChanged:"itemChanged"},decls:8,vars:2,consts:()=>{let e;e="item";let t;t="category";let i;i="item name";let o;o="Item name cannot contain the character '"+"\uFFFD0\uFFFD"+"'";let s;return s="Item name is required",[o,s,["role","group","aria-label",e,1,"flex",3,"formGroup"],["name","categories","formControlName","category","aria-label",t,1,"max-w-[5rem]"],[3,"value"],["value",""],["type","text","formControlName","name","aria-label",i,1,"w-0","flex-1",3,"focus","blur"],["role","alert",1,"text-red-light","m-1","text-sm"]];},template:function(t,i){t&1&&(r(0,"form",2)(1,"select",3),q(2,kt,2,2,"option",4,Be),r(4,"option",5),U(5,"+"),l()(),r(6,"input",6),m("focus",function(s){return i.focus(s);})("blur",function(){return i.blur();}),l()(),p(7,zt,2,1,"div",7)),t&2&&(S("formGroup",i.form),d(2),F(i.categories()),d(5),u(i.mode()==="edit"&&i.form.valid===!1&&i.form.touched?7:-1));},dependencies:[Le,Ce,Ct,Pt,J,St,Z,Se,Pe,Ae],encapsulation:2,changeDetection:0});}return n;})();function Wt(n,_){n&1&&(r(0,"span"),A(1,0),l()),n&2&&(d(),k(_),K(1));}function jt(n,_){n&1&&(r(0,"span"),A(1,1),l());}function Yt(n,_){n&1&&(r(0,"span"),A(1,2),l());}function Ht(n,_){if(n&1&&(r(0,"span"),A(1,3),l()),n&2){let e=a();d(),k(e),K(1);}}function Jt(n,_){n&1&&p(0,Yt,2,0,"span")(1,Ht,2,1,"span"),n&2&&u(_===" "?0:1);}function Zt(n,_){n&1&&(r(0,"span"),A(1,4),l());}function ei(n,_){n&1&&(r(0,"span"),A(1,5),l());}function ti(n,_){n&1&&(r(0,"span"),A(1,6),l());}function ii(n,_){if(n&1&&(r(0,"div",12),p(1,Wt,2,1,"span")(2,jt,2,0,"span")(3,Jt,2,1)(4,Zt,2,0,"span")(5,ei,2,0,"span")(6,ti,2,0,"span"),l()),n&2){let e,t,i=a();d(),u((e=i.form.controls.question.errors==null?null:i.form.controls.question.errors.pattern)?1:-1,e),d(),u(i.form.controls.question.errors!=null&&i.form.controls.question.errors.required?2:-1),d(),u((t=i.form.controls.variable.errors==null?null:i.form.controls.variable.errors.pattern)?3:-1,t),d(),u(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.required?4:-1),d(),u(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.reserved?5:-1),d(),u(i.form.controls.variable.errors!=null&&i.form.controls.variable.errors.used?6:-1);}}var Ot=(()=>{class n{question=b.required();parser=P(H);state=P(g);variables=this.state.signal("variables");mode=this.state.signal("rulesMode");highlighVariable=L(()=>this.mode()!=="edit"&&this.state.signal("highlightVariableStatus")());variableActive=L(()=>this.state.signal("activeAnswers")()[this.question().variable]);refactorVariables=this.state.signal("refactorVariables");questionChanged=N();variableChanged=N();fb=P(fe).nonNullable;form=this.fb.group({question:this.fb.control("",{validators:[this.validateQuestionPattern(),re.required.bind(this)]}),variable:this.fb.control("",{validators:[this.validateVariablePattern(),ni(),re.required.bind(this)],asyncValidators:[oi(xe(this.variables),xe(this.question))]})});constructor(){x(()=>{this.question(),this.reset();});let e=ge(this.form.valueChanges.pipe(de(500),se(()=>this.form.valid)));x(()=>{let t=e();t?.question&&t.question!==this.question().question&&t.variable?this.questionChanged.emit(new y(t.question,t.variable)):t?.variable&&t.variable.trim()!==this.question().variable&&(this.question().variable===y.NEW_VARIABLE_NAME||!this.refactorVariables()?this.questionChanged.emit(new y(this.question().question,t.variable.trim())):this.variableChanged.emit([this.question().variable,t.variable.trim()]));}),x(()=>{this.mode()==="edit"?this.form.enable({emitEvent:!1}):this.form.disable({emitEvent:!1}),this.reset();});}reset(){this.form.patchValue(this.question(),{emitEvent:!1});}focusQuestion(){this.form.controls.question.value===y.NEW_QUESTION_NAME&&this.form.controls.question.setValue("",{emitEvent:!1});}focusVariable(){this.form.controls.variable.value===y.NEW_VARIABLE_NAME&&this.form.controls.variable.setValue("",{emitEvent:!1});}validateVariablePattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateVariableName(t),null;}catch(i){return e.markAsTouched(),i instanceof Y?{pattern:i.found}:{pattern:!0};}};}validateQuestionPattern(){return e=>{let t=e.value?.trim()??"";try{return this.parser.validateQuestionString(t),null;}catch(i){return e.markAsTouched(),i instanceof Y?{pattern:i.found}:{pattern:!0};}};}static ɵfac=function(t){return new(t||n)();};static ɵcmp=M({type:n,selectors:[["app-editor-question"]],inputs:{question:[1,"question"]},outputs:{questionChanged:"questionChanged",variableChanged:"variableChanged"},decls:6,vars:6,consts:()=>{let e;e="question";let t;t="question";let i;i="question";let o;o="variable";let s;s="variable";let R;R="Questions cannot contain this character: '"+"\uFFFD0\uFFFD"+"'";let f;f="Question is required";let $;$="Variables cannot contain spaces";let v;v="Variables cannot contain this character: '"+"\uFFFD0\uFFFD"+"'";let V;V="Variable name is required";let O;O="This variable name is reserved";let ee;return ee="This variable name is already used",[R,f,$,v,V,O,ee,["role","group","aria-label",e,1,"flex","flex-col",3,"formGroup"],["type","text","placeholder",t,"aria-label",i,"formControlName","question",1,"grow",3,"focus"],[1,"flex","items-center","gap-2"],[1,"ml-2","h-4"],["type","text","placeholder",o,"aria-label",s,"formControlName","variable",1,"grow","font-mono","font-bold",3,"focus"],["role","alert",1,"text-red","m-1","flex","flex-col","text-sm"]];},template:function(t,i){t&1&&(r(0,"form",7)(1,"input",8),m("focus",function(){return i.focusQuestion();}),l(),r(2,"div",9),T(3,"app-icon-arrow-forward",10),r(4,"input",11),m("focus",function(){return i.focusVariable();}),l()(),p(5,ii,7,6,"div",12),l()),t&2&&(S("formGroup",i.form),d(4),Q("text-green",i.highlighVariable()&&i.variableActive())("text-red",i.highlighVariable()&&!i.variableActive()),d(),u(i.mode()==="edit"&&i.form.valid===!1&&i.form.touched?5:-1));},dependencies:[Le,Ce,J,Z,Se,Pe,Ae,ut],encapsulation:2,changeDetection:0});}return n;})();function ni(){return n=>[oe.string,Ve,Ue,we,ye].some(_=>_===n.value?.trim())?{reserved:!0}:null;}function oi(n,_){return e=>ae(e.value).pipe(Fe(n.pipe(Ne(t=>[...t])),_),qe(([t,i,o])=>Ge(()=>!i.find(s=>s===o.variable),ae(null),ae([t,i,o]).pipe(Ne(([s,R,f])=>{let $=R.findIndex(v=>v===f.variable);return R.splice($,1),R.includes(s?.trim()??"")?{used:!0}:null;})))));}function _i(n,_){if(n&1){let e=C();r(0,"button",8),m("click",function(){c(e);let i=a();return E(i.resetCondition());}),T(1,"app-icon-clear"),l();}}function li(n,_){if(n&1){let e=C();r(0,"button",15),m("click",function(){c(e);let i=a(2).$index,o=a();return E(o.swapQuestions(i,i+1));}),T(1,"app-icon-arrow-downward"),l();}}function ri(n,_){n&1&&T(0,"span",14);}function ai(n,_){if(n&1&&p(0,li,2,0,"button",13)(1,ri,1,0,"span",14),n&2){let e=a().$index,t=a();u(e<t.rule().questions.length-1?0:1);}}function si(n,_){if(n&1){let e=C();r(0,"button",16),m("click",function(){c(e);let i=a().$index,o=a();return E(o.deleteQuestion(i));}),T(1,"app-icon-delete"),l();}}function di(n,_){if(n&1){let e=C();r(0,"button",17),m("click",function(){c(e);let i=a().$index,o=a();return E(o.cutQuestion(i));}),T(1,"app-icon-cut"),l();}}function ui(n,_){if(n&1){let e=C();r(0,"button",18),m("click",function(){c(e);let i=a().$index,o=a();return E(o.swapQuestions(i-1,i));}),T(1,"app-icon-arrow-upward"),l();}}function ci(n,_){if(n&1){let e=C();r(0,"div",5),p(1,ai,2,1),r(2,"app-editor-question",9),m("questionChanged",function(i){let o=c(e).$index,s=a();return E(s.updateQuestion(o,i));})("variableChanged",function(i){c(e);let o=a();return E(o.variableChanged(i));}),l(),p(3,si,2,0,"button",10)(4,di,2,0,"button",11)(5,ui,2,0,"button",12),l();}if(n&2){let e=_.$implicit,t=_.$index,i=a();d(),u(i.mode()==="swap"&&i.rule().questions.length>1?1:-1),d(),S("question",e),d(),u(i.mode()==="delete"?3:i.mode()==="cut-paste"?4:i.mode()==="swap"&&t>0?5:-1);}}function Ei(n,_){if(n&1){let e=C();r(0,"button",24),m("click",function(){c(e);let i=a(2).$index,o=a();return E(o.swapItems(i,i+1));}),T(1,"app-icon-arrow-downward"),l();}}function mi(n,_){n&1&&T(0,"span",14);}function pi(n,_){if(n&1&&p(0,Ei,2,0,"button",23)(1,mi,1,0,"span",14),n&2){let e=a().$index,t=a();u(e<t.rule().items.length-1?0:1);}}function Ti(n,_){if(n&1){let e=C();r(0,"button",25),m("click",function(){c(e);let i=a().$index,o=a();return E(o.deleteItem(i));}),T(1,"app-icon-delete"),l();}}function Ri(n,_){if(n&1){let e=C();r(0,"button",26),m("click",function(){c(e);let i=a().$index,o=a();return E(o.cutItem(i));}),T(1,"app-icon-cut"),l();}}function Si(n,_){if(n&1){let e=C();r(0,"button",27),m("click",function(){c(e);let i=a().$index,o=a();return E(o.swapItems(i-1,i));}),T(1,"app-icon-arrow-upward"),l();}}function Ci(n,_){if(n&1){let e=C();r(0,"div",5),p(1,pi,2,1),r(2,"app-editor-item",19),m("itemChanged",function(i){let o=c(e).$index,s=a();return E(s.updateItem(o,i));}),l(),p(3,Ti,2,0,"button",20)(4,Ri,2,0,"button",21)(5,Si,2,0,"button",22),l();}if(n&2){let e=_.$implicit,t=_.$index,i=a();d(),u(i.mode()==="swap"&&i.rule().items.length>1?1:-1),d(),S("item",e),d(),u(i.mode()==="delete"?3:i.mode()==="cut-paste"?4:i.mode()==="swap"&&t>0?5:-1);}}function Pi(n,_){if(n&1){let e=C();r(0,"div",6)(1,"button",28),m("click",function(){c(e);let i=a();return E(i.addQuestion());}),A(2,0),l(),r(3,"button",29),m("click",function(){c(e);let i=a();return E(i.addItem());}),A(4,1),l()();}}function Ai(n,_){if(n&1){let e=C();r(0,"button",32),m("click",function(){c(e);let i=a(2);return E(i.deleteRule.emit());}),T(1,"app-icon-delete"),l();}}function fi(n,_){if(n&1){let e=C();r(0,"button",33),m("click",function(){c(e);let i=a(2);return E(i.paste());}),T(1,"app-icon-paste"),l();}}function Li(n,_){if(n&1&&(r(0,"div",7),p(1,Ai,2,0,"button",30)(2,fi,2,0,"button",31),l()),n&2){let e=a();d(),u(e.mode()==="delete"?1:-1),d(),u(e.mode()==="cut-paste"?2:-1);}}var It=(()=>{class n{rule=b.required();ruleChanged=N();deleteRule=N();renameVariable=N();state=P(g);mode=this.state.signal("rulesMode");selectVariables=L(()=>{let e=this.rule().questions.map(i=>i.variable);return this.state.get("variables").filter(i=>!e.includes(i));});clipboard=P(Oe);resetCondition(){this.updateCondition(new D());}updateCondition(e){let t=new B(e,this.rule().questions,this.rule().items);this.ruleChanged.emit(t);}emitNewQuestions(e){let t=new B(this.rule().condition,e,this.rule().items);this.ruleChanged.emit(t);}updateQuestion(e,t){let i=this.rule().questions;i[e]=t,this.emitNewQuestions(i);}addQuestion(){let e=new y(y.NEW_QUESTION_NAME,y.NEW_VARIABLE_NAME);this.updateQuestion(this.rule().questions.length,e);}deleteQuestion(e){let t=this.rule().questions;t.splice(e,1),this.emitNewQuestions(t);}cutQuestion(e){let t=this.rule().questions[e];this.deleteQuestion(e),this.clipboard.cutQuestion(t);}swapQuestions(e,t){let i=this.rule().questions,o=i[e];i[e]=i[t],i[t]=o,this.emitNewQuestions(i);}emitNewItems(e){let t=new B(this.rule().condition,this.rule().questions,e);this.ruleChanged.emit(t);}updateItem(e,t){let i=this.rule().items;i[e]=t,this.emitNewItems(i);}addItem(){let e=new z(z.NEW_CATEGORY_NAME,z.NEW_ITEM_NAME);this.updateItem(this.rule().items.length,e);}deleteItem(e){let t=this.rule().items;t.splice(e,1),this.emitNewItems(t);}cutItem(e){let t=this.rule().items[e];this.deleteItem(e),this.clipboard.cutItem(t);}swapItems(e,t){let i=this.rule().items,o=i[e];i[e]=i[t],i[t]=o,this.emitNewItems(i);}paste(){let{questions:e,items:t}=this.clipboard.paste(),i=new B(this.rule().condition,[...this.rule().questions,...e],[...this.rule().items,...t]);this.ruleChanged.emit(i);}variableChanged([e,t]){this.renameVariable.emit([e,t]);}static ɵfac=function(t){return new(t||n)();};static ɵcmp=M({type:n,selectors:[["app-editor-rule"]],inputs:{rule:[1,"rule"]},outputs:{ruleChanged:"ruleChanged",deleteRule:"deleteRule",renameVariable:"renameVariable"},decls:9,vars:4,consts:()=>{let e;e="condition";let t;t="reset condition";let i;i="delete question";let o;o="cut question";let s;s="move question up";let R;R="move question down";let f;f="delete item";let $;$="cut item";let v;v="move item up";let V;V="move item down";let O;O="add question";let ee;ee="add item";let h;h=" + Question ";let De;De=" + Item ";let be;be="delete rule";let he;return he="paste from clipboard",[h,De,["aria-label",e,"role","group",1,"mb-1","flex","items-center"],[1,"accessible-content","grow",3,"conditionChanged","condition","selectVariables"],["type","button","aria-label",t,1,"link"],[1,"mb-1","flex","items-center"],[1,"flex","justify-end","gap-2"],[1,"flex","justify-center"],["type","button","aria-label",t,1,"link",3,"click"],[1,"grow",3,"questionChanged","variableChanged","question"],["type","button","aria-label",i,1,"link"],["type","button","aria-label",o,1,"link"],["type","button","aria-label",s,1,"link","p-1"],["type","button","aria-label",R,1,"link","p-1"],[1,"ml-6"],["type","button","aria-label",R,1,"link","p-1",3,"click"],["type","button","aria-label",i,1,"link",3,"click"],["type","button","aria-label",o,1,"link",3,"click"],["type","button","aria-label",s,1,"link","p-1",3,"click"],[1,"grow",3,"itemChanged","item"],["type","button","aria-label",f,1,"link"],["type","button","aria-label",$,1,"link"],["type","button","aria-label",v,1,"link","p-1"],["type","button","aria-label",V,1,"link","p-1"],["type","button","aria-label",V,1,"link","p-1",3,"click"],["type","button","aria-label",f,1,"link",3,"click"],["type","button","aria-label",$,1,"link",3,"click"],["type","button","aria-label",v,1,"link","p-1",3,"click"],["type","button","aria-label",O,1,"h-8",3,"click"],["type","button","aria-label",ee,1,"h-8",3,"click"],["type","button","aria-label",be,1,"link"],["type","button","aria-label",he,1,"link"],["type","button","aria-label",be,1,"link",3,"click"],["type","button","aria-label",he,1,"link",3,"click"]];},template:function(t,i){t&1&&(r(0,"div",2)(1,"app-editor-condition",3),m("conditionChanged",function(s){return i.updateCondition(s);}),l(),p(2,_i,2,0,"button",4),l(),q(3,ci,6,3,"div",5,te),q(5,Ci,6,3,"div",5,te),p(7,Pi,5,0,"div",6)(8,Li,3,2,"div",7)),t&2&&(d(),S("condition",i.rule().condition)("selectVariables",i.selectVariables()),d(),u(i.mode()==="edit"?2:-1),d(),F(i.rule().questions),d(2),F(i.rule().items),d(2),u(i.mode()==="edit"?7:8));},dependencies:[ft,Ot,gt,me,st,rt,pe,ct,dt],encapsulation:2,changeDetection:0});}return n;})();var gi=["button"],Oi=["*"],Ie=(()=>{class n{state=P(g);mode=this.state.signal("rulesMode");type=b.required();label=b.required();disabled=b(!1);button=G("button");focusPrevious=N();focusNext=N();focus(){let e=this.button();e&&(e.nativeElement.focus(),this.mode.set(this.type()));}static ɵfac=function(t){return new(t||n)();};static ɵcmp=M({type:n,selectors:[["app-toolbar-button"]],viewQuery:function(t,i){t&1&&w(i.button,gi,5),t&2&&j();},inputs:{type:[1,"type"],label:[1,"label"],disabled:[1,"disabled"]},outputs:{focusPrevious:"focusPrevious",focusNext:"focusNext"},ngContentSelectors:Oi,decls:3,vars:6,consts:[["button",""],["type","button","role","radio",1,"link","h-full","w-full",3,"click","keypress","keydown.arrowLeft","keydown.arrowRight","tabIndex","disabled"]],template:function(t,i){if(t&1){let o=C();We(),r(0,"button",1,0),m("click",function(){return c(o),E(i.mode.set(i.type()));})("keypress",function(){return c(o),E(i.mode.set(i.type()));})("keydown.arrowLeft",function(){return c(o),E(i.focusPrevious.emit());})("keydown.arrowRight",function(){return c(o),E(i.focusNext.emit());}),je(2),l();}t&2&&(Q("active",i.mode()===i.type()),S("tabIndex",i.mode()===i.type()?0:-1)("disabled",i.disabled()),ue("aria-label",i.label())("aria-checked",i.mode()===i.type()));},encapsulation:2,changeDetection:0});}return n;})();var Ii=["searchInput"];function bi(n,_){if(n&1&&(r(0,"span"),A(1,2),l()),n&2){let e=_;d(),k(e)(e),K(1);}}function hi(n,_){if(n&1&&(r(0,"span"),A(1,3),l()),n&2){let e=_;d(),k(e)(e),K(1);}}function Ni(n,_){if(n&1&&(r(0,"div",14)(1,"span"),A(2,1),l(),p(3,bi,2,2,"span")(4,hi,2,2,"span"),l()),n&2){let e,t,i=a(2);d(3),u((e=i.clipboard.itemsCount())?3:-1,e),d(),u((t=i.clipboard.questionsCount())?4:-1,t);}}function Mi(n,_){if(n&1&&p(0,Ni,5,2,"div",14),n&2){let e=a();u(e.clipboard.itemsCount()>0||e.clipboard.questionsCount()>0?0:-1);}}function vi(n,_){if(n&1){let e=C();r(0,"div",13)(1,"input",15,0),Ze("ngModelChange",function(i){c(e);let o=a();return Je(o.searchTerm,i)||(o.searchTerm=i),E(i);}),l(),r(3,"button",16),m("click",function(){c(e);let i=a();return E(i.clearSearch());}),T(4,"app-icon-clear",17),l()();}if(n&2){let e=a();d(),He("ngModel",e.searchTerm);}}var bt=(()=>{class n{toolbarButtons=Ke(Ie);noOfVisibleRules=b.required();state=P(g);mode=this.state.signal("rulesMode");searchTerm=this.state.signal("filterRulesQuery");clipboard=P(Oe);sticky=L(()=>this.state.signal("scrollY")()>48);searchInput=G.required("searchInput");constructor(){x(()=>{this.toolbarButtons().forEach(e=>{e.focusNext.subscribe(()=>{this.focusNext();}),e.focusPrevious.subscribe(()=>{this.focusPrevious();});});});}focusNext(){let e=this.toolbarButtons(),t=e.length,i=e.findIndex(o=>o.type()===this.mode());if(i!==-1){let o=(i+1)%t;e[o].focus();}}focusPrevious(){let e=this.toolbarButtons(),t=e.length,i=e.findIndex(o=>o.type()===this.mode());if(i!==-1){let o=(i-1+t)%t;e[o].focus();}}focusSearch(){setTimeout(()=>{this.searchInput().nativeElement.focus();},50);}clearSearch(){this.searchTerm.set(""),this.focusSearch();}static ɵfac=function(t){return new(t||n)();};static ɵcmp=M({type:n,selectors:[["app-toolbar"]],viewQuery:function(t,i){t&1&&(w(i.toolbarButtons,Ie,5),w(i.searchInput,Ii,5)),t&2&&j(2);},inputs:{noOfVisibleRules:[1,"noOfVisibleRules"]},decls:16,vars:7,consts:()=>{let e;e="Editor Mode";let t;t="View";let i;i="Edit";let o;o="Delete";let s;s="Cut/Paste";let R;R="Swap";let f;f="Search";let $;$="Clipboard:";let v;v="{VAR_PLURAL, plural, one {1 Item} other {{INTERPOLATION} Items}}",v=ve(v,{INTERPOLATION:"\uFFFD1\uFFFD",VAR_PLURAL:"\uFFFD0\uFFFD"});let V;return V="{VAR_PLURAL, plural, one {1 Question} other {{INTERPOLATION} Questions}}",V=ve(V,{INTERPOLATION:"\uFFFD1\uFFFD",VAR_PLURAL:"\uFFFD0\uFFFD"}),[["searchInput",""],$,v,V,["role","toolbar","aria-orientation","horizontal",1,"bg-active","sticky","left-0","top-0","z-30","py-2"],["role","radiogroup","aria-label",e,1,"mb-1","grid","grid-cols-6","gap-2"],["type","view","label",t],[1,"my-auto","h-6","w-6"],["type","edit","label",i,3,"disabled"],["type","delete","label",o,3,"disabled"],["type","cut-paste","label",s,3,"disabled"],["type","swap","label",R,3,"disabled"],["type","search","label",f],[1,"mt-2","flex","items-center"],[1,"mt-2","flex","justify-center","gap-4"],["type","text",1,"grow",3,"ngModelChange","ngModel"],["type","button",1,"link",3,"click"],[1,"h-6","w-6"]];},template:function(t,i){t&1&&(r(0,"div",4)(1,"div",5)(2,"app-toolbar-button",6),T(3,"app-icon-view",7),l(),r(4,"app-toolbar-button",8),T(5,"app-icon-edit",7),l(),r(6,"app-toolbar-button",9),T(7,"app-icon-delete",7),l(),r(8,"app-toolbar-button",10),T(9,"app-icon-reorder",7),l(),r(10,"app-toolbar-button",11),T(11,"app-icon-swap",7),l(),r(12,"app-toolbar-button",12),T(13,"app-icon-search",7),l()(),p(14,Mi,1,1)(15,vi,5,1,"div",13),l()),t&2&&(Q("shadow-md",i.sticky()),d(4),S("disabled",!i.noOfVisibleRules()&&!!i.searchTerm()),d(2),S("disabled",!i.noOfVisibleRules()),d(2),S("disabled",i.noOfVisibleRules()<2&&!i.clipboard.itemsCount()&&!i.clipboard.questionsCount()),d(2),S("disabled",!i.noOfVisibleRules()),d(4),u(i.mode()==="cut-paste"?14:i.mode()==="search"||i.searchTerm()?15:-1));},dependencies:[At,J,Z,Rt,ot,at,me,lt,Ee,_t,pe,Ie],encapsulation:2,changeDetection:0});}return n;})();var $i=(n,_)=>_.index,xi=(n,_,e,t)=>({disabled:n,"animate-pulse":_,"mb-[2.25rem]":e,"mb-12":t});function Vi(n,_){if(n&1){let e=C();r(0,"div",4)(1,"div",7)(2,"p"),A(3,0),l(),r(4,"button",8),m("click",function(){c(e);let i=a();return E(i.addRuleAndEdit());}),A(5,1),l()()();}}function Ui(n,_){if(n&1){let e=C();r(0,"div",9)(1,"button",12),m("click",function(){c(e);let i=a().$implicit,o=a();return E(o.swapRules(i.index-1,i.index));}),T(2,"app-icon-swap"),l()();}}function wi(n,_){if(n&1){let e=C();p(0,Ui,3,0,"div",9),r(1,"div",10)(2,"app-editor-rule",11),m("ruleChanged",function(i){let o=c(e).$implicit,s=a();return E(s.updateRule(o.index,i));})("deleteRule",function(){let i=c(e).$implicit,o=a();return E(o.deleteRule(i.index));})("renameVariable",function(i){c(e);let o=a();return E(o.renameVariable(i));}),l()();}if(n&2){let e=_.$implicit,t=a();u(e.index>0&&t.mode()==="swap"&&!t.filter()?0:-1),d(),S("id","rule-"+e.index)("ngClass",tt(5,xi,t.showAsDisabled(e.rule),t.highlightRule()===e.index,(t.mode()==="view"||t.mode()==="search")&&t.accessibility()==="compact",(t.mode()==="view"||t.mode()==="search")&&t.accessibility()==="accessible")),ue("aria-label",t.ruleLabel(e.index)),d(),S("rule",e.rule);}}function yi(n,_){if(n&1){let e=C();r(0,"button",13),m("click",function(){c(e);let i=a();return E(i.addRule());}),A(1,2),l();}}function Di(n,_){n&1&&(r(0,"a",6),T(1,"img",14),l());}var Zn=(()=>{class n{refactor=P(pt);state=P(g);parsedRules=this.state.signal("parsedRules");activeRules=this.state.signal("activeRules");mode=this.state.signal("rulesMode");accessibility=this.state.signal("accessibility");filter=this.state.signal("filterRulesQuery");highlightRule=ke(void 0);visibleRules=L(()=>this.filter()===""?this.parsedRules().map((t,i)=>({rule:t,index:i})):this.parsedRules().map((t,i)=>({rule:t,index:i})).filter(t=>{let i=this.filter();return!i||this.refactor.contains(t.rule,i);}));goToPacklistButtonVisible=L(()=>this.state.signal("scrollY")()>100);ruleLabel(e){return"Rule #"+(e+1).toString()+"";}updateRules(e){let t=Et(e);this.state.set("rules",t);}updateRule(e,t){let i=this.parsedRules();i[e]=t,this.updateRules([...i]);}deleteRule(e){let t=this.parsedRules();t.splice(e,1),this.updateRules([...t]);}addRule(){let e=this.parsedRules().length,t=[];for(let s=0;s<this.parsedRules().length;s++){let R=document.querySelector(`#rule-${s.toString()}`);if(R){let f=R.getBoundingClientRect();f.top>=0&&f.bottom<=window.innerHeight&&t.push(s);}}t.includes(e-1)||(e=t[0]+1);let i=new B(new D()),o=this.parsedRules();o.splice(e,0,i),this.updateRules([...o]),this.highlightRule.set(e),setTimeout(()=>{this.highlightRule.set(void 0);},4e3);}addRuleAndEdit(){this.addRule(),this.mode.set("edit");}swapRules(e,t){let i=this.parsedRules(),o=i[e];i[e]=i[t],i[t]=o,this.updateRules([...i]);}showAsDisabled(e){return this.state.get("fadeOutDisabledRules")&&!this.activeRules().includes(e);}renameVariable([e,t]){let i=this.refactor.renameVariable(e,t,this.parsedRules());this.updateRules(i);}static ɵfac=function(t){return new(t||n)();};static ɵcmp=M({type:n,selectors:[["app-rules"]],decls:6,vars:4,consts:()=>{let e;e="Add rule";let t;t="Add rule";let i;i="There are no rules defined yet.";let o;o=" + Rule ";let s;s=" + Rule ";let R;return R="application icon",[i,o,s,[3,"noOfVisibleRules"],[1,"flex","h-[calc(100vh-4rem)]","items-center","justify-center"],["aria-label",e,"type","button",1,"fixed","bottom-2","z-50"],["routerLink","/packlist",1,"fixed","bottom-2","right-2","z-50"],[1,"flex","flex-col","items-center","gap-6"],["aria-label",t,"type","button",3,"click"],[1,"flex","justify-center"],["role","group","tabindex","0",1,"card","mb-1",3,"id","ngClass"],[3,"ruleChanged","deleteRule","renameVariable","rule"],["type","button",1,"link",3,"click"],["aria-label",e,"type","button",1,"fixed","bottom-2","z-50",3,"click"],["alt",R,"src","icon.svg",1,"h-12"]];},template:function(t,i){t&1&&(T(0,"app-toolbar",3),p(1,Vi,6,0,"div",4),q(2,wi,3,10,null,null,$i),p(4,yi,2,0,"button",5)(5,Di,2,0,"a",6)),t&2&&(S("noOfVisibleRules",i.visibleRules().length),d(),u(i.visibleRules().length?-1:1),d(),F(i.visibleRules()),d(2),u(i.mode()==="edit"&&!i.filter()&&i.visibleRules().length?4:-1),d(),u(i.goToPacklistButtonVisible()?5:-1));},dependencies:[It,bt,Ee,it,nt],encapsulation:2,changeDetection:0});}return n;})();export{Zn as default};/**i18n:11555cd2058de678625c5e5f6fa7389cec339f76ccf0b7ad1e93105d8d32fab0*/