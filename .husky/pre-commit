# .husky/pre-commit

cleanup() {
  if test -f .git/unstaged.diff
  then
    git apply .git/unstaged.diff
    rm -f .git/unstaged.diff
  fi
  exit 1
}

if ! git diff --exit-code >/dev/null
then
  echo "Unstaged changes detected, saving diff to .git/unstaged.diff"
  git diff >.git/unstaged.diff
  git apply -R .git/unstaged.diff
fi

npm run sort-localizations || cleanup
npm test || cleanup
npm run spellcheck || cleanup
npm run format || cleanup
npm run lint -- --fix || cleanup
npm run stylelint -- --fix || cleanup
npm run build || cleanup
git update-index --again
