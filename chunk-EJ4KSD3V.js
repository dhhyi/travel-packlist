import{h as _,i as ee,k as te}from"./chunk-C4UQJ6CT.js";import{B as X,W as c,Z,_a as p,aa as o,bc as l,dc as b,oa as x,p as G}from"./chunk-3LKDF7HW.js";import{a as g,b as Y}from"./chunk-2NFLSA4Y.js";var d=class{constructor(e,t=[],s=[]){this.condition=e;this.questions=t;this.items=s}},f=class{constructor(e,t){this.question=e;this.variable=t}static NEW_QUESTION_NAME=$localize`:@@model.new.question:New Question`;static NEW_VARIABLE_NAME="new_variable"},v=class{constructor(e,t,s){this.category=e;this.name=t;this.weight=s}static NEW_ITEM_NAME=$localize`:@@model.new.item:New Item`;static NEW_CATEGORY_NAME=$localize`:@@model.new.category:New`},u=class{constructor(e){this.variable=e}evaluate(e){return e[this.variable]}},W=class r extends u{static string="please_select";constructor(){super(r.string)}},K=class r extends u{static string="always";constructor(){super(r.string)}evaluate(){return!0}},h=class{constructor(e){this.not=e}evaluate(e){return!this.not.evaluate(e)}},y=class{constructor(e,t){this.left=e;this.right=t}evaluate(e){return this.left.evaluate(e)&&this.right.evaluate(e)}},m=class{constructor(e,t){this.left=e;this.right=t}evaluate(e){return this.left.evaluate(e)||this.right.evaluate(e)}};var E=class r{serializeRules(e){return e.map(this.serialize.bind(this)).map(t=>t+";").join(`

`)}serializeEffects(e){return e.questions.map(this.serialize.bind(this)).concat(e.items.map(this.serialize.bind(this)))}serializeWeight(e,t,s=-1){if(!e)return"0g";let a=(s<0?e/1e3:(e/1e3).toFixed(s)).toString()+"kg",i=(e*1).toString()+"g";return t?t==="kg"?a:i:a.length<=i.length?a:i}serialize(e){if(e instanceof d){let s=[];if(!(e.condition instanceof K)){let i=this.serialize(e.condition);i&&s.push(i," ")}s.push(":-");let a=this.serializeEffects(e);if(a.length===1&&s.length===1)s.push(" ",a[0]);else for(let i=0;i<a.length;i++){let S=a[i];i>0&&s.push(","),s.push(`
`,"   ",S)}return s.join("")}else{if(e instanceof f)return e.question+" $"+e.variable;if(e instanceof v){let s=`[${e.category}] ${e.name}`.trim();return e.weight&&(s+=" "+this.serializeWeight(e.weight)),s}else{if(e instanceof u)return e.variable;if(e instanceof h)return"NOT "+this.serialize(e.not);if(e instanceof y)return this.serialize(e.left)+" AND "+this.serialize(e.right);if(e instanceof m)return this.serialize(e.left)+" OR "+this.serialize(e.right)}}let t=e;throw new Error("Cannot serialize unknown input",t)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};var le={isTrackWeight:()=>!1},ce=new Z("PARSER_CONFIG_PROVIDER"),se=/^\s*\[(?<category>.+?)\]\s*(?<name>.+)\s*$/,re=/^\s*(?<question>.*)\s+\$(?<variable>[^ ]+)\s*$/,I=class r{injector=o(x);parseCondition(e){let t=e.replaceAll(/NOT\s+NOT/g,"").trim().split(" ");if(t.includes("OR")){let s=t.indexOf("OR");return new m(this.parseCondition(t.slice(0,s).join(" ")),this.parseCondition(t.slice(s+1).join(" ")))}else if(t.includes("AND")){let s=t.indexOf("AND");return new y(this.parseCondition(t.slice(0,s).join(" ")),this.parseCondition(t.slice(s+1).join(" ")))}else{if(t[0]==="NOT")return new h(this.parseCondition(t.slice(1).join(" ")));if(t.length===1&&t[0].trim()){let s=t[0].trim();return s===K.string?new K:s===W.string?new W:new u(s)}else throw new Error($localize`:@@parser.error.condition:Could not parse condition from '${e}:INPUT:'`)}}parseQuestion(e){let t=re.exec(e);if(!t?.groups)throw new Error($localize`:@@parser.error.question:Could not parse question from '${e}:INPUT:'`);return new f(t.groups.question,t.groups.variable)}isTrackWeight(){return this.injector.get(ce,le).isTrackWeight()}extractItemNameAndWeight(e,t=!1){if(!e)return["",0];if(!t&&!this.isTrackWeight())return[e.trim(),0];let s=/^(.+)\s+(\d+(\.\d+)?)(k?g)?$/.exec(e.trim());if(s){let a=s[1].trim(),i=parseFloat(s[2])*(s[4]==="kg"?1e3:1);return[a,i]}else return[e.trim(),0]}parseItem(e){let t=se.exec(e);if(!t?.groups)throw new Error($localize`:@@parser.error.item:Could not parse item from '${e}:INPUT:'`);let[s,a]=this.extractItemNameAndWeight(t.groups.name);return new v(t.groups.category,s,a)}parseEffects(e){let t=e.split(",").map(i=>i.trim()).filter(Boolean),s=[],a=[];for(let i of t)if(re.test(i))s.push(this.parseQuestion(i));else if(se.test(i))a.push(this.parseItem(i));else throw new Error($localize`:@@parser.error.effect:Could not parse effect from '${i}:INPUT:'`);return{questions:s,items:a}}parseRule(e){let t=e.split(":-");if(t.length!==2)throw new Error($localize`:@@parser.error.rule:Could not parse rule from '${e}:INPUT:'`);let s;t[0].trim()?s=this.parseCondition(t[0]):s=new K;let{questions:a,items:i}=this.parseEffects(t[1]);return new d(s,a,i)}parseRules(e){return e.split(`
`).filter(s=>!s.trim().startsWith("#")).map(s=>s.replace(/#.*/,"")).join(`
`).split(";").map(s=>s.trim()).filter(Boolean).map(this.parseRule.bind(this))}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};var O=class r{serializer=o(E);parser=o(I);extractVariables(e){return e.reduce((t,s)=>[...t,...s.questions.map(a=>a.variable)],[])}extractCategories(e){let t=new Set;for(let s of e)for(let a of s.items)t.add(a.category);return Array.from(t)}renameVariable(e,t,s){if(s instanceof Array)return s.map(i=>this.renameVariable(e,t,i));if(s instanceof f)return s.variable===e?new f(s.question,t):s;if(s instanceof d)return new d(this.renameVariable(e,t,s.condition),s.questions.map(i=>this.renameVariable(e,t,i)),s.items);if(s instanceof u)return s.variable===e?new u(t):s;if(s instanceof h)return new h(this.renameVariable(e,t,s.not));if(s instanceof y)return new y(this.renameVariable(e,t,s.left),this.renameVariable(e,t,s.right));if(s instanceof m)return new m(this.renameVariable(e,t,s.left),this.renameVariable(e,t,s.right));let a=s;throw new Error("Unknown item type",a)}filterActive(e){let t=e.rules.filter(a=>a.condition.evaluate(e.model)),s=this.extractVariables(t).reduce((a,i)=>Y(g({},a),{[i]:e.model[i]}),{});return t.length===e.rules.length?{model:s,rules:t}:this.filterActive({model:s,rules:t})}contains(e,t){let s=t.toLowerCase();if(e instanceof d)return this.contains(e.condition,t)||e.questions.some(i=>this.contains(i,t))||e.items.some(i=>this.contains(i,t));if(e instanceof f)return e.question.toLowerCase().includes(s)||e.variable.toLowerCase().includes(s);if(e instanceof v)return e.category.toLowerCase().includes(s)||e.name.toLowerCase().includes(s);if(e instanceof u)return e.variable.toLowerCase().includes(s);if(e instanceof h)return this.contains(e.not,t);if(e instanceof y)return this.contains(e.left,t)||this.contains(e.right,t);if(e instanceof m)return this.contains(e.left,t)||this.contains(e.right,t);let a=e;throw new Error("Unknown item type",a)}countItemsAndWeights(e){return e.reduce((t,s)=>s.items.reduce((a,i)=>{let S;if(this.parser.isTrackWeight())S=i.weight?1:0;else{let[,C]=this.parser.extractItemNameAndWeight(this.serializer.serialize(i),!0);S=C?1:0}return{items:a.items+1,weights:a.weights+S}},t),{items:0,weights:0})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};function A(r,e){let t=r.getItem("state"),s;if(t){let a=JSON.parse(t);s=g(g({},e),a)}else s=g({},e);return s}function ie(r,e){if(typeof r!=typeof e)return!1;if(r&&e&&typeof r=="object"){let t=Object.keys(r),s=Object.keys(e);return t.length===s.length&&t.every(a=>ie(r[a],e[a]))}return r===e}function ue(r,e){let t=Object.keys(e).filter(s=>!ie(r[s],e[s])).map(s=>[s,r[s]]);return t.length===0?null:Object.fromEntries(t)}function V(r,e,t){let s=ue(e,t);s===null?r.removeItem("state"):r.setItem("state",JSON.stringify(s))}var ae=["en","de"],P={answers:{},checkedItems:[],collapsedCategories:[],rules:void 0,fadeOutDisabledRules:!1,highlightVariableStatus:!1,refactorVariables:!0,categorySorting:"alphabetically",trackWeight:!1,answersLocked:!1,theme:"system",fontSize:"normal",language:"auto",exportReminder:!1,lastExportHash:"",lastExportDate:0},q=Object.keys(P),k=class r{state=A(localStorage,P);injector=o(x);signalMap=new Map;constructor(){this.loadLegacyState(),this.initializeSignals()}initializeSignals(){for(let e of q){let t=p(this.state[e]);b(()=>{let s=t();s!==this.state[e]&&(this.state[e]=s,this.persist())},{manualCleanup:!0,injector:this.injector}),this.signalMap.set(e,t)}}loadLegacyState(){if(localStorage.getItem("answers")&&(this.state.answers=JSON.parse(localStorage.getItem("answers")),localStorage.removeItem("answers")),localStorage.getItem("checkedItems")&&(this.state.checkedItems=JSON.parse(localStorage.getItem("checkedItems")),localStorage.removeItem("checkedItems")),localStorage.getItem("collapsedCategories")&&(this.state.collapsedCategories=JSON.parse(localStorage.getItem("collapsedCategories")),localStorage.removeItem("collapsedCategories")),localStorage.getItem("rules")&&(this.state.rules=localStorage.getItem("rules"),localStorage.removeItem("rules")),localStorage.getItem("config")){let e=JSON.parse(localStorage.getItem("config"));this.state.fadeOutDisabledRules=e.fadeOutDisabledRules,this.state.trackWeight=e.trackWeight,this.state.answersLocked=e.answersLocked,this.state.theme=e.theme,this.state.language=e.language,localStorage.removeItem("config")}this.persist()}persist(){V(localStorage,this.state,P)}handles(e){return q.includes(e)}signal(e){return this.signalMap.get(e)}set(e,t){this.signal(e).set(t)}get(e){return this.signal(e)()}reset(){this.state=g({},P),this.persist(),q.forEach(e=>{this.signal(e).set(P[e])})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};var ne=`:-
   [Utility] Paper Tissues,
   [Utility] Backpack;

:- Are you traveling longer than 3 days? $longer;

longer :-
   Do you have a washer or laundry service available? $laundry,
   Do you want to work? $work,
   [Electronics] Phone Charger,
   [Electronics] Tablet;

longer AND NOT laundry :-
   [Clothes] enough Shirts,
   [Clothes] enough Underwear,
   [Clothes] spare Pants;

laundry :-
   [Clothes] 3 Shirts,
   [Clothes] 3 sets of Underwear;

work :-
   [Electronics] Laptop;

:-
   Will it be sunny? $sunny,
   Will it be rainy? $rainy,
   Are you traveling abroad? $abroad;

sunny :-
   Do you expect a high UV index? $uv,
   [Utility] Sunglasses,
   [Clothes] Short Pants;

rainy :-
   [Clothes] Rain Jacket;

NOT rainy :-
   [Clothes] Jacket;

NOT sunny :-
   [Clothes] Long Pants;

uv :-
   [Utility] Sunscreen;

abroad :-
   [Documents] Passport,
   [Documents] Visa;
`;var z=class r{state=o(k);parser=o(I);refactor=o(O);signalMap=new Map;constructor(){this.initializeSignals()}initializeSignals(){this.signalMap.set("isMobile",l(()=>{let n=navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(n)}));let e=p(window.scrollY);window.addEventListener("scroll",()=>{e.set(window.scrollY)}),this.signalMap.set("scrollY",e.asReadonly()),this.signalMap.set("preferredLanguage",l(()=>{let n=this.state.signal("language")();return n==="auto"?navigator.languages.map(R=>R.split("-")[0]).find(R=>ae.includes(R))??"en":n})),this.signalMap.set("rulesContainComments",l(()=>{let n=this.state.signal("rules")();return!!n&&n.includes("#")}));let t=l(()=>{let n=this.state.signal("rules")();return n||ne});this.signalMap.set("rulesOrTemplate",t);let s=l(()=>{try{return{parsedRules:this.parser.parseRules(t()),ruleParserError:""}}catch(n){n instanceof Error?console.warn(n.message):console.error(n);let T=n instanceof Error?n.message:"An unknown error occurred";return{parsedRules:[],ruleParserError:T}}}),a=l(()=>{let{ruleParserError:n,parsedRules:T}=s();if(!n){let{items:j,weights:R}=this.refactor.countItemsAndWeights(T);return R/j}return 0});this.signalMap.set("percentageOfItemsWithWeights",a);let i=l(()=>s().parsedRules);this.signalMap.set("parsedRules",i),this.signalMap.set("ruleParserError",l(()=>s().ruleParserError)),this.signalMap.set("categories",l(()=>this.refactor.extractCategories(i()))),this.signalMap.set("variables",l(()=>this.refactor.extractVariables(i())));let S=l(()=>this.refactor.filterActive({rules:i(),model:this.state.signal("answers")()})),C=l(()=>S().rules);this.signalMap.set("activeRules",C),this.signalMap.set("activeAnswers",l(()=>S().model)),this.signalMap.set("activeQuestions",l(()=>C().flatMap(n=>n.questions))),this.signalMap.set("activeItems",l(()=>C().flatMap(n=>n.items)));let B=l(()=>pe(t()).toString(16));this.signalMap.set("rulesHash",B);let L=p(new Date().getTime());this.signalMap.set("lastRulesAction",L.asReadonly()),b(()=>{t(),L.set(new Date().getTime())}),this.signalMap.set("exportFileName",l(()=>{let n=new Date(L()).toISOString().replace(/\..*$/,"").replace(/[T:]/g,"-"),T=B();return`travel-packlist-rules-${n}-${T}.txt`})),this.signalMap.set("exportNeeded",l(()=>{let n=this.signal("rulesHash")(),T=this.state.signal("lastExportHash")(),j=n!==T;return!!this.state.signal("rules")()&&j}))}handles(e){return this.signalMap.has(e)}signal(e){return this.signalMap.get(e)}get(e){return this.signal(e)()}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})},pe=function(r,e=0){let t=3735928559^e,s=1103547991^e;for(let a=0,i;a<r.length;a++)i=r.charCodeAt(a),t=Math.imul(t^i,2654435761),s=Math.imul(s^i,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&s)+(t>>>0)};var Q={rulesMode:"view",filterRulesQuery:void 0},F=Object.keys(Q),N=class r{route=o(ee);router=o(te);signalMap=new Map;constructor(){for(let e of F)this.signalMap.set(e,this.createSignal(e))}createSignal(e){let t=p(void 0);return this.router.events.pipe(X(s=>s instanceof _),G(()=>this.route.snapshot.queryParams[e]??Q[e])).subscribe(s=>{s!==""&&t.set(s)}),b(()=>{let s=t()||void 0;s===Q[e]&&(s=void 0),this.route.snapshot.queryParams[e]!==s&&this.router.navigate([],{queryParams:{[e]:s},queryParamsHandling:"merge",relativeTo:this.route,replaceUrl:!0})}),t}handles(e){return F.includes(e)}signal(e){return this.signalMap.get(e)}get(e){return this.signal(e)()}set(e,t){this.signal(e).set(t)}reset(){for(let e of F)this.signal(e).set(void 0)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};var M={clipboardItems:[],clipboardQuestions:[]},U=Object.keys(M),$=class r{state=A(sessionStorage,M);injector=o(x);signalMap=new Map;constructor(){this.initializeSignals()}initializeSignals(){for(let e of U){let t=p(this.state[e]);b(()=>{let s=t();s!==this.state[e]&&(this.state[e]=s,this.persist())},{manualCleanup:!0,injector:this.injector}),this.signalMap.set(e,t)}}persist(){V(sessionStorage,this.state,M)}handles(e){return U.includes(e)}signal(e){return this.signalMap.get(e)}set(e,t){this.signal(e).set(t)}get(e){return this.signal(e)()}reset(){this.state=g({},M),this.persist(),U.forEach(e=>{this.signal(e).set(M[e])})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};var J={serviceWorkerStatus:"init"},H=Object.keys(J),D=class r{signalMap=new Map;constructor(){this.initializeSignals()}initializeSignals(){for(let e of H){let t=p(J[e]);this.signalMap.set(e,t)}}handles(e){return H.includes(e)}signal(e){return this.signalMap.get(e)}get(e){return this.signal(e)()}set(e,t){this.signal(e).set(t)}reset(){for(let e of H)this.signal(e).set(J[e])}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};var oe=class r{persistent=o(k);router=o(N);session=o($);transient=o(D);derived=o(z);get(e){if(this.persistent.handles(e))return this.persistent.get(e);if(this.router.handles(e))return this.router.get(e);if(this.session.handles(e))return this.session.get(e);if(this.transient.handles(e))return this.transient.get(e);if(this.derived.handles(e))return this.derived.get(e);throw new Error(`Key ${e} not handled in state`)}signal(e){if(this.persistent.handles(e))return this.persistent.signal(e);if(this.router.handles(e))return this.router.signal(e);if(this.session.handles(e))return this.session.signal(e);if(this.transient.handles(e))return this.transient.signal(e);if(this.derived.handles(e))return this.derived.signal(e);throw new Error(`Key ${e} not handled in state`)}set(e,t){if(this.persistent.handles(e))this.persistent.signal(e).set(t);else if(this.router.handles(e))this.router.set(e,t);else if(this.session.handles(e))this.session.set(e,t);else if(this.transient.handles(e))this.transient.set(e,t);else throw this.derived.handles(e)?new Error("Key is derived and cannot be set"):new Error(`Key ${e} not handled in state`)}reset(){this.persistent.reset(),this.session.reset(),this.router.reset()}static \u0275fac=function(t){return new(t||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};export{d as a,f as b,v as c,u as d,W as e,K as f,h as g,y as h,m as i,ce as j,I as k,E as l,O as m,oe as n};
