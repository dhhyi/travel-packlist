<div class="card mb-1">
  @let checkedItems = view().checked;
  @let totalItems = view().numberOfItems;
  @let checkedWeight = view().checkedWeight;
  @let totalWeight = view().totalWeight;
  @if (trackWeight()) {
    <div class="mb-1 flex">
      <progress
        role="progressbar"
        title="weight packing progress"
        i18n-title="@@packlist.weight-packing.progress"
        class="grow"
        [value]="checkedWeight"
        [max]="totalWeight"
      ></progress>
    </div>
    <div class="flex flex-col items-center">
      <span
        title="item packing status"
        i18n-title="@@packlist.item-packing.status"
        aria-live="polite"
        >{{ checkedItems }} / {{ totalItems }}</span
      >
      <span
        title="weight packing status"
        i18n-title="@@packlist.weight-packing.status"
        aria-live="polite"
        >{{ serializeWeightPartition(checkedWeight, totalWeight) }}</span
      >
    </div>
  } @else {
    <div class="mb-1 flex">
      <progress
        role="progressbar"
        title="item packing progress"
        i18n-title="@@packlist.item-packing.progress"
        class="grow"
        [value]="checkedItems"
        [max]="totalItems"
      ></progress>
    </div>
    <div class="flex justify-center">
      <span
        title="item packing status"
        i18n-title="@@packlist.item-packing.status"
        aria-live="polite"
        >{{ checkedItems }} / {{ totalItems }}</span
      >
    </div>
  }
</div>

@if (!view().numberOfItems) {
  <div class="flex flex-col items-center">
    <p i18n="@@packlist.no-items" class="text-center">No items available.</p>
  </div>
}

@for (group of view().categories | keyvalue: orderBy(); track group.key) {
  @let categoryName = group.key;
  @let category = group.value;
  <div class="card mb-1">
    <div
      role="button"
      tabindex="0"
      class="flex justify-between"
      (click)="toggleCategoryCollapse(categoryName)"
      (keypress)="toggleCategoryCollapse(categoryName)"
    >
      <div class="flex items-center gap-1">
        @if (category.collapsed) {
          <app-icon-key-right class="h-6 w-6" />
        } @else {
          <app-icon-key-down class="h-6 w-6" />
        }
        <span class="font-bold italic">{{ categoryName }}</span>
        @if (trackWeight() && category.totalWeight) {
          <span class="text-sm">
            @if (category.checkedWeight === category.totalWeight) {
              ({{ serializeWeight(category.checkedWeight, undefined, 1) }})
            } @else {
              ({{
                serializeWeightPartition(
                  category.checkedWeight,
                  category.totalWeight
                )
              }})
            }
          </span>
        }
      </div>
      <app-status [count]="category.checked" [total]="category.items.length" />
    </div>
    @if (!category.collapsed) {
      <ul class="pt-2">
        @for (item of category.items; track $index) {
          <li
            role="button"
            tabindex="0"
            class="flex justify-between"
            [attr.aria-pressed]="item.checked"
            [ngClass]="{
              'text-slate-600 line-through dark:text-slate-400': item.checked,
            }"
            (click)="toggleCheckedItem(item)"
            (keypress)="toggleCheckedItem(item)"
          >
            {{ item.name }}
            @if (item.weight && trackWeight()) {
              <span class="italic">{{ serializeWeight(item.weight) }}</span>
            }
          </li>
        }
      </ul>
    }
  </div>
}
