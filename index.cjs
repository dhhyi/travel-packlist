"use strict";var ss=Object.defineProperty;var rs=Object.getOwnPropertyDescriptor;var ie=(o,i,e,c)=>{for(var p=c>1?void 0:c?rs(i,e):i,h=o.length-1,x;h>=0;h--)(x=o[h])&&(p=(c?x(i,e,p):x(p))||p);return c&&p&&ss(i,e,p),p};var _=class{constructor(i,e=[],c=[]){this.condition=i;this.questions=e;this.items=c}},W=class{constructor(i,e){this.question=i;this.variable=e}static NEW_QUESTION_NAME="New Question";static NEW_VARIABLE_NAME="new_variable"};function Ze(o){return o?o.trim().replace(/[^\w]/g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,""):""}var q=class{constructor(i,e,c){this.category=i;this.name=e;this.weight=c}static NEW_ITEM_NAME="New Item";static NEW_CATEGORY_NAME="New";id(){return`${Ze(this.category)}-${Ze(this.name)}`}},v=class{constructor(i){this.variable=i}evaluate(i){return i[this.variable]}};var P=class o extends v{static string="always";constructor(){super(o.string)}evaluate(){return!0}},N=class{constructor(i){this.not=i}evaluate(i){return!this.not.evaluate(i)}},O=class{constructor(i,e){this.left=i;this.right=e}evaluate(i){return this.left.evaluate(i)&&this.right.evaluate(i)}},V=class{constructor(i,e){this.left=i;this.right=e}evaluate(i){return this.left.evaluate(i)||this.right.evaluate(i)}};function ns(o,i){let e=i.filter(p=>p instanceof W),c=i.filter(p=>p instanceof q);return new _(o??new P,e,c)}function Be(o){return o.length===1?o[0]:new O(o[0],Be(o.slice(1)))}function Ke(o){return o.length===1?o[0]:new V(o[0],Ke(o.slice(1)))}var Q=class extends SyntaxError{constructor(i,e,c,p){super(i),this.expected=e,this.found=c,this.location=p,this.name="SyntaxError"}format(i){let e="Error: "+this.message;if(this.location){let c=null,p=i.find(F=>F.source===this.location.source);p&&(c=p.text.split(/\r\n|\n|\r/g));let h=this.location.start,x=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(h):h,S=this.location.source+":"+x.line+":"+x.column;if(c){let F=this.location.end,D="".padEnd(x.line.toString().length," "),z=c[h.line-1],b=(h.line===F.line?F.column:z.length+1)-h.column||1;e+=`
 --> `+S+`
`+D+` |
`+x.line+" | "+z+`
`+D+" | "+"".padEnd(h.column-1," ")+"".padEnd(b,"^")}else e+=`
 at `+S}return e}static buildMessage(i,e){function c(b){return b.codePointAt(0).toString(16).toUpperCase()}let p=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function h(b){return p?b.replace(p,m=>"\\u{"+c(m)+"}"):b}function x(b){return h(b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,m=>"\\x0"+c(m)).replace(/[\x10-\x1F\x7F-\x9F]/g,m=>"\\x"+c(m)))}function S(b){return h(b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,m=>"\\x0"+c(m)).replace(/[\x10-\x1F\x7F-\x9F]/g,m=>"\\x"+c(m)))}let F={literal(b){return'"'+x(b.text)+'"'},class(b){let m=b.parts.map(I=>Array.isArray(I)?S(I[0])+"-"+S(I[1]):S(I));return"["+(b.inverted?"^":"")+m.join("")+"]"+(b.unicode?"u":"")},any(){return"any character"},end(){return"end of input"},other(b){return b.description}};function D(b){return F[b.type](b)}function z(b){let m=b.map(D);if(m.sort(),m.length>0){let I=1;for(let L=1;L<m.length;L++)m[L-1]!==m[L]&&(m[I]=m[L],I++);m.length=I}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}function T(b){return b?'"'+x(b)+'"':"end of input"}return"Expected "+z(i)+" but "+T(e)+" found."}};function C(o,i){i=i!==void 0?i:{};let e={},c=i.grammarSource,p={Rules:Te,Rule:fe,Condition:We,Effects:Qe,Question:ge,Item:he,VariableName:pe,QuestionString:je,ItemNameAndWeight:ze,CategoryName:De},h=Te,x="#",S=";",F=":-",D="OR",z="AND",T="NOT",b=",",m="$",I="[",L="]",$e="kg",rt="g",nt=".",J=/^[^\n\r]/,be=/^[^$,;#]/,it=/^[a-zA-Z]/,we=/^[a-zA-Z0-9\-[\](){}_]/,xe=/^[^\],;#[]/,ot=/^[,;]/,ye=/^[^ ,;#]/,ee=/^[0-9]/,Re=/^[ \t\n\r]/,lt=y("title"),Ae=A("#",!1),te=k([`
`,"\r"],!0,!1,!1),at=y("comment"),ct=y("rule end"),ft=A(";",!1),ut=y("rule"),gt=A(":-",!1),se=y("condition"),pt=A("OR",!1),ht=A("AND",!1),ce=A("NOT",!1),dt=A(",",!1),Ce=y("question"),mt=A("$",!1),Ee=k(["$",",",";","#"],!0,!1,!1),$t=y("variable name"),bt=k([["a","z"],["A","Z"]],!1,!1,!1),ve=k([["a","z"],["A","Z"],["0","9"],"-","[","]","(",")","{","}","_"],!1,!1,!1),wt=y("item"),xt=y("category"),yt=A("[",!1),Rt=A("]",!1),At=y("category name"),Ie=k(["]",",",";","#","["],!0,!1,!1),Ct=y("item name"),Et=y("word"),vt=k([",",";"],!1,!1,!1),Ne=k([" ",",",";","#"],!0,!1,!1),It=y("weight"),Nt=A("kg",!1),Ot=A("g",!1),Vt=y("number"),re=k([["0","9"]],!1,!1,!1),St=A(".",!1),Oe=k([" ","	",`
`,"\r"],!1,!1,!1),Ft=Kt();function Tt(t,s){return s.title=t?.trim(),s.rulesContainComments=Ge,s}function kt(t){if(t.trim().length)return t.trim()}function Wt(t){if(t.trim().length)return Ge=!0,t.trim()}function _t(t,s){return ns(t,s)}function Pt(t){return Ke(t)}function Qt(t){return Be(t)}function jt(t){return new N(t)}function Dt(t){return new v(t)}function zt(t,s){return new W(t.trim(),s.trim())}function Lt(t,s){let{name:n,weight:l}=s;return new q(t.trim(),n,l)}function qt(t,s){return i.trackWeight}function Mt(t,s){let n=t.trim();return n.length||Ve("item name"),{name:n,weight:s}}function Ut(t){let s=t.trim();return s.length||Ve("item name"),{name:s,weight:void 0}}function Gt(t){return t*1e3}function Ht(){return parseFloat(Zt())}let r=i.peg$currPos|0,w=r,M=[{line:1,column:1}],E=r,ne=i.peg$maxFailExpected||[],a=i.peg$silentFails|0,B;if(i.startRule){if(!(i.startRule in p))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');h=p[i.startRule]}function Zt(){return o.substring(w,r)}function hs(){return w}function ds(){return{source:c,start:w,end:r}}function ms(){return K(w,r)}function Ve(t,s){throw s=s!==void 0?s:K(w,r),Fe([y(t)],o.substring(w,r),s)}function $s(t,s){throw s=s!==void 0?s:K(w,r),Yt(t,s)}function Bt(t=r){let s=o.codePointAt(t);return s===void 0?"":String.fromCodePoint(s)}function A(t,s){return{type:"literal",text:t,ignoreCase:s}}function k(t,s,n,l){return{type:"class",parts:t,inverted:s,ignoreCase:n,unicode:l}}function Kt(){return{type:"any"}}function Xt(){return{type:"end"}}function y(t){return{type:"other",description:t}}function Se(t){let s=M[t],n;if(s)return s;if(t>=M.length)n=M.length-1;else for(n=t;!M[--n];);for(s=M[n],s={line:s.line,column:s.column};n<t;)o.charCodeAt(n)===10?(s.line++,s.column=1):s.column++,n++;return M[t]=s,s}function K(t,s,n){let l=Se(t),f=Se(s),u={source:c,start:{offset:t,line:l.line,column:l.column},end:{offset:s,line:f.line,column:f.column}};return n&&c&&typeof c.offset=="function"&&(u.start=c.offset(u.start),u.end=c.offset(u.end)),u}function g(t){r<E||(r>E&&(E=r,ne=[]),ne.push(t))}function Yt(t,s){return new Q(t,null,null,s)}function Fe(t,s,n){return new Q(Q.buildMessage(t,s),t,s,n)}function Te(){let t,s,n,l,f,u,d,R;for(t=r,s=$(),n=Jt(),n===e&&(n=null),l=$(),f=[],u=fe();u!==e;)f.push(u),u=r,d=ke(),d!==e?(d=fe(),d===e?(r=u,u=e):u=d):u=d;return u=ke(),u===e&&(u=null),d=$(),R=Ue(),R!==e?(w=t,t=Tt(n,f)):(r=t,t=e),t}function Jt(){let t,s,n,l,f,u;if(a++,t=r,o.charCodeAt(r)===35?(s=x,r++):(s=e,a===0&&g(Ae)),s!==e){if(n=$(),l=r,f=[],u=o.charAt(r),J.test(u)?r++:(u=e,a===0&&g(te)),u!==e)for(;u!==e;)f.push(u),u=o.charAt(r),J.test(u)?r++:(u=e,a===0&&g(te));else f=e;f!==e?l=o.substring(l,r):l=f,l!==e?(f=$(),w=t,t=kt(l)):(r=t,t=e)}else r=t,t=e;return a--,t===e&&(s=e,a===0&&g(lt)),t}function U(){let t,s,n,l,f;if(a++,t=r,o.charCodeAt(r)===35?(s=x,r++):(s=e,a===0&&g(Ae)),s!==e){if(n=r,l=[],f=o.charAt(r),J.test(f)?r++:(f=e,a===0&&g(te)),f!==e)for(;f!==e;)l.push(f),f=o.charAt(r),J.test(f)?r++:(f=e,a===0&&g(te));else l=e;l!==e?n=o.substring(n,r):n=l,n!==e?(l=$(),w=t,t=Wt(n)):(r=t,t=e)}else r=t,t=e;return a--,t===e&&(s=e,a===0&&g(at)),t}function ke(){let t,s,n,l,f,u;if(a++,t=r,s=$(),o.charCodeAt(r)===59?(n=S,r++):(n=e,a===0&&g(ft)),n!==e){for(l=$(),f=[],u=U();u!==e;)f.push(u),u=U();u=$(),s=[s,n,l,f,u],t=s}else r=t,t=e;return a--,t===e&&(s=e,a===0&&g(ct)),t}function fe(){let t,s,n,l,f,u,d,R;for(a++,t=r,s=[],n=U();n!==e;)s.push(n),n=U();return n=$(),l=We(),l===e&&(l=null),f=$(),o.substr(r,2)===F?(u=F,r+=2):(u=e,a===0&&g(gt)),u!==e?(d=$(),R=Qe(),w=t,t=_t(l,R)):(r=t,t=e),a--,t===e&&(s=e,a===0&&g(ut)),t}function We(){let t,s;return a++,t=es(),a--,t===e&&(s=e,a===0&&g(se)),t}function es(){let t,s,n,l,f,u,d,R;for(a++,t=r,s=r,n=[],l=_e();l!==e;)n.push(l),l=r,f=r,u=$(),o.substr(r,2)===D?(d=D,r+=2):(d=e,a===0&&g(pt)),d!==e?(R=$(),u=[u,d,R],f=u):(r=f,f=e),f!==e?(f=_e(),f===e?(r=l,l=e):l=f):l=f;return n.length<1?(r=s,s=e):s=n,s!==e&&(w=t,s=Pt(s)),t=s,a--,t===e&&(s=e,a===0&&g(se)),t}function _e(){let t,s,n,l,f,u,d,R;for(a++,t=r,s=r,n=[],l=ue();l!==e;)n.push(l),l=r,f=r,u=$(),o.substr(r,3)===z?(d=z,r+=3):(d=e,a===0&&g(ht)),d!==e?(R=$(),u=[u,d,R],f=u):(r=f,f=e),f!==e?(f=ue(),f===e?(r=l,l=e):l=f):l=f;return n.length<1?(r=s,s=e):s=n,s!==e&&(w=t,s=Qt(s)),t=s,a--,t===e&&(s=e,a===0&&g(se)),t}function ue(){let t,s,n,l,f,u;return a++,t=r,o.substr(r,3)===T?(s=T,r+=3):(s=e,a===0&&g(ce)),s!==e?(n=$(),o.substr(r,3)===T?(l=T,r+=3):(l=e,a===0&&g(ce)),l!==e?(f=$(),u=ue(),u!==e?t=u:(r=t,t=e)):(r=t,t=e)):(r=t,t=e),t===e&&(t=r,o.substr(r,3)===T?(s=T,r+=3):(s=e,a===0&&g(ce)),s!==e?(n=$(),l=Pe(),l!==e?(w=t,t=jt(l)):(r=t,t=e)):(r=t,t=e),t===e&&(t=r,s=Pe(),s!==e?t=s:(r=t,t=e))),a--,t===e&&(s=e,a===0&&g(se)),t}function Pe(){let t,s;return t=r,s=pe(),s!==e&&(w=t,s=Dt(s)),t=s,t}function Qe(){let t,s,n,l,f,u,d,R,G;for(t=r,s=[],n=ge(),n===e&&(n=he());n!==e;){if(s.push(n),n=r,l=r,f=$(),o.charCodeAt(r)===44?(u=b,r++):(u=e,a===0&&g(dt)),u!==e){for(d=$(),R=[],G=U();G!==e;)R.push(G),G=U();G=$(),f=[f,u,d,R,G],l=f}else r=l,l=e;l!==e?(l=ge(),l===e&&(l=he()),l===e?(r=n,n=e):n=l):n=l}return t=s,t}function ge(){let t,s,n,l;return a++,t=r,s=je(),s!==e?(o.charCodeAt(r)===36?(n=m,r++):(n=e,a===0&&g(mt)),n!==e?(l=pe(),l!==e?(w=t,t=zt(s,l)):(r=t,t=e)):(r=t,t=e)):(r=t,t=e),a--,t===e&&(s=e,a===0&&g(Ce)),t}function je(){let t,s,n;if(a++,t=r,s=[],n=o.charAt(r),be.test(n)?r++:(n=e,a===0&&g(Ee)),n!==e)for(;n!==e;)s.push(n),n=o.charAt(r),be.test(n)?r++:(n=e,a===0&&g(Ee));else s=e;return s!==e?t=o.substring(t,r):t=s,a--,t===e&&(s=e,a===0&&g(Ce)),t}function pe(){let t,s,n,l,f;if(a++,t=r,s=r,n=o.charAt(r),it.test(n)?r++:(n=e,a===0&&g(bt)),n!==e){for(l=[],f=o.charAt(r),we.test(f)?r++:(f=e,a===0&&g(ve));f!==e;)l.push(f),f=o.charAt(r),we.test(f)?r++:(f=e,a===0&&g(ve));n=[n,l],s=n}else r=s,s=e;return s!==e?t=o.substring(t,r):t=s,a--,t===e&&(s=e,a===0&&g($t)),t}function he(){let t,s,n,l;return a++,t=r,s=ts(),s!==e?(n=$(),l=ze(),l!==e?(w=t,t=Lt(s,l)):(r=t,t=e)):(r=t,t=e),a--,t===e&&(s=e,a===0&&g(wt)),t}function ts(){let t,s,n,l,f,u;return a++,t=r,o.charCodeAt(r)===91?(s=I,r++):(s=e,a===0&&g(yt)),s!==e?(n=$(),l=De(),l!==e?(f=$(),o.charCodeAt(r)===93?(u=L,r++):(u=e,a===0&&g(Rt)),u!==e?t=l:(r=t,t=e)):(r=t,t=e)):(r=t,t=e),a--,t===e&&(s=e,a===0&&g(xt)),t}function De(){let t,s,n;if(a++,t=r,s=[],n=o.charAt(r),xe.test(n)?r++:(n=e,a===0&&g(Ie)),n!==e)for(;n!==e;)s.push(n),n=o.charAt(r),xe.test(n)?r++:(n=e,a===0&&g(Ie));else s=e;return s!==e?t=o.substring(t,r):t=s,a--,t===e&&(s=e,a===0&&g(At)),t}function ze(){let t,s,n,l,f;for(a++,t=r,s=r,n=[],l=Le();l!==e;)n.push(l),l=r,f=$(),f=Le(),f===e?(r=l,l=e):l=f;if(s=o.substring(s,r),n=$(),l=qe(),l!==e?(w=r,f=qt(s,l),f?f=void 0:f=e,f!==e?(w=t,t=Mt(s,l)):(r=t,t=e)):(r=t,t=e),t===e){for(t=r,s=r,n=[],l=de();l!==e;)n.push(l),l=r,f=$(),f=de(),f===e?(r=l,l=e):l=f;s=o.substring(s,r),w=t,s=Ut(s),t=s}return a--,t===e&&(s=e,a===0&&g(Ct)),t}function Le(){let t,s,n,l,f,u;return a++,t=r,s=r,a++,n=r,l=qe(),l!==e?(f=$(),u=Ue(),u===e&&(u=o.charAt(r),ot.test(u)?r++:(u=e,a===0&&g(vt))),u!==e?(l=[l,f,u],n=l):(r=n,n=e)):(r=n,n=e),a--,n===e?s=void 0:(r=s,s=e),s!==e?(n=de(),n!==e?t=n:(r=t,t=e)):(r=t,t=e),a--,t===e&&(s=e,a===0&&g(Et)),t}function de(){let t,s,n;if(t=r,s=[],n=o.charAt(r),ye.test(n)?r++:(n=e,a===0&&g(Ne)),n!==e)for(;n!==e;)s.push(n),n=o.charAt(r),ye.test(n)?r++:(n=e,a===0&&g(Ne));else s=e;return s!==e?t=o.substring(t,r):t=s,t}function qe(){let t,s,n;return a++,t=r,s=Me(),s!==e?(o.substr(r,2)===$e?(n=$e,r+=2):(n=e,a===0&&g(Nt)),n!==e?(w=t,t=Gt(s)):(r=t,t=e)):(r=t,t=e),t===e&&(t=r,s=Me(),s!==e?(o.charCodeAt(r)===103?(n=rt,r++):(n=e,a===0&&g(Ot)),n===e&&(n=null),t=s):(r=t,t=e)),a--,t===e&&(s=e,a===0&&g(It)),t}function Me(){let t,s,n,l,f,u,d;if(a++,t=r,s=[],n=o.charAt(r),ee.test(n)?r++:(n=e,a===0&&g(re)),n!==e)for(;n!==e;)s.push(n),n=o.charAt(r),ee.test(n)?r++:(n=e,a===0&&g(re));else s=e;if(s!==e){if(n=r,o.charCodeAt(r)===46?(l=nt,r++):(l=e,a===0&&g(St)),l!==e){if(f=r,u=[],d=o.charAt(r),ee.test(d)?r++:(d=e,a===0&&g(re)),d!==e)for(;d!==e;)u.push(d),d=o.charAt(r),ee.test(d)?r++:(d=e,a===0&&g(re));else u=e;u!==e?f=o.substring(f,r):f=u,f!==e?(l=[l,f],n=l):(r=n,n=e)}else r=n,n=e;n===e&&(n=null),w=t,t=Ht()}else r=t,t=e;return a--,t===e&&(s=e,a===0&&g(Vt)),t}function $(){let t,s;for(a++,t=[],s=o.charAt(r),Re.test(s)?r++:(s=e,a===0&&g(Oe));s!==e;)t.push(s),s=o.charAt(r),Re.test(s)?r++:(s=e,a===0&&g(Oe));return a--,t}function Ue(){let t,s;return t=r,a++,o.length>r?(s=o.charAt(r),r++):(s=e,a===0&&g(Ft)),a--,s===e?t=void 0:(r=t,t=e),t}let Ge=!1;B=h();let me=B!==e&&r===o.length;function He(){throw B!==e&&r<o.length&&g(Xt()),Fe(ne,E<o.length?Bt(E):null,E<o.length?K(E,E+1):K(E,E))}if(i.peg$library)return{peg$result:B,peg$currPos:r,peg$FAILED:e,peg$maxFailExpected:ne,peg$maxFailPos:E,peg$success:me,peg$throw:me?void 0:He};if(me)return B;He()}var oe=class{constructor(i){this.description=i}},le=()=>{};var os={isTrackWeight:()=>!1},ls=new oe("PARSER_CONFIG_PROVIDER"),j=class{config=void 0??os;isTrackWeight(){return this.config.isTrackWeight()}makeOptions(i,e={}){return{startRule:i,trackWeight:e.forceWeightTracking??this.isTrackWeight()}}parseCondition(i){return C(i,this.makeOptions("Condition"))}parseQuestion(i){return C(i,this.makeOptions("Question"))}parseItem(i){return C(i,this.makeOptions("Item"))}parseEffects(i){return C(i,this.makeOptions("Effects"))}parseRule(i){return C(i,this.makeOptions("Rule"))}parseRules(i){try{return C(i,this.makeOptions("Rules"))}catch(e){let c=[];if(c.push("Error parsing rules"),e instanceof Q){let p=e.location.start.line.toString(),h=e.location.start.column.toString();c.push(" at line ",p," column ",h),c.push(":",`
`,e.message)}else e instanceof Error&&c.push(e.message);throw new Error(c.join(""))}}validateVariableName(i){C(i,this.makeOptions("VariableName"))}validateQuestionString(i){C(i,this.makeOptions("QuestionString"))}validateItemNameAndWeight(i){C(i,this.makeOptions("ItemNameAndWeight"))}validateCategoryName(i){C(i,this.makeOptions("CategoryName"))}forceParseWeight(i){return C(i,this.makeOptions("ItemNameAndWeight",{forceWeightTracking:!0})).weight??0}};j=ie([le({providedIn:"root"})],j);var X=class{parser=(j,void 0);extractVariables(i){return i.reduce((e,c)=>[...e,...c.questions.map(p=>p.variable)],[])}extractCategories(i){let e=new Set;for(let c of i)for(let p of c.items)e.add(p.category);return Array.from(e)}renameVariable(i,e,c){if(c instanceof Array)return c.map(h=>this.renameVariable(i,e,h));if(c instanceof W)return c.variable===i?new W(c.question,e):c;if(c instanceof _)return new _(this.renameVariable(i,e,c.condition),c.questions.map(h=>this.renameVariable(i,e,h)),c.items);if(c instanceof v)return c.variable===i?new v(e):c;if(c instanceof N)return new N(this.renameVariable(i,e,c.not));if(c instanceof O)return new O(this.renameVariable(i,e,c.left),this.renameVariable(i,e,c.right));if(c instanceof V)return new V(this.renameVariable(i,e,c.left),this.renameVariable(i,e,c.right));let p=c;throw new Error("Unknown item type: "+p)}filterActive(i){let e=i.rules.filter(p=>p.condition.evaluate(i.model)),c=this.extractVariables(e).reduce((p,h)=>({...p,[h]:i.model[h]}),{[P.string]:!0});return e.length===i.rules.length?{model:c,rules:e}:this.filterActive({model:c,rules:e})}contains(i,e){let c=e.toLowerCase();if(i instanceof _)return this.contains(i.condition,e)||i.questions.some(h=>this.contains(h,e))||i.items.some(h=>this.contains(h,e));if(i instanceof W)return i.question.toLowerCase().includes(c)||i.variable.toLowerCase().includes(c);if(i instanceof q)return i.category.toLowerCase().includes(c)||i.name.toLowerCase().includes(c);if(i instanceof v)return i.variable.toLowerCase().includes(c);if(i instanceof N)return this.contains(i.not,e);if(i instanceof O)return this.contains(i.left,e)||this.contains(i.right,e);if(i instanceof V)return this.contains(i.left,e)||this.contains(i.right,e);let p=i;throw new Error("Unknown item type: "+p)}countItemsAndWeights(i){return i.reduce((e,c)=>c.items.reduce((p,h)=>{let x;return this.parser.isTrackWeight()?x=h.weight?1:0:x=this.parser.forceParseWeight(h.name)?1:0,{items:p.items+1,weights:p.weights+x}},e),{items:0,weights:0})}};X=ie([le({providedIn:"root"})],X);function Xe(o){let i=o.title?.trim();return(i?`# ${i}

`:"")+o.map(c=>cs(c)).map(c=>c+";").join(`

`)+`
`}function as(o,i,e=-1){if(!o)return"0g";let c=(e<0?o/1e3:(o/1e3).toFixed(e)).toString()+"kg",p=o.toString()+"g";return i?i==="kg"?c:p:c.length<=p.length?c:p}function cs(o){let i=[];if(!(o.condition instanceof P)){let c=H(o.condition);c&&i.push(c," ")}i.push(":-");let e=o.questions.map(c=>fs(c)).concat(o.items.map(c=>us(c)));if(e.length===1&&i.length===1)i.push(" ",e[0]);else for(let c=0;c<e.length;c++){let p=e[c];c>0&&i.push(","),i.push(`
`,"   ",p)}return i.join("")}function fs(o){return o.question+" $"+o.variable}function us(o){let i=`[${o.category}] ${o.name}`.trim();return o.weight&&(i+=" "+as(o.weight)),i}function H(o){if(o instanceof v)return o.variable;if(o instanceof N)return"NOT "+H(o.not);if(o instanceof O)return H(o.left)+" AND "+H(o.right);if(o instanceof V)return H(o.left)+" OR "+H(o.right);throw new Error("Unknown condition type")}var ae=require("fs"),Ye=require("path"),Z=process.argv.slice(2);function Je(){console.log(`
Usage: node ${process.argv[0]} ${process.argv[1]} [options] file

Options:
  --validate       Validate the Rules file (default action)
  --format         Format the Rules file (in-place)
                   (implies --validate)

  --help, -h       Show this help message
  --version, -v    Show version information
`)}(Z.includes("--help")||Z.includes("-h"))&&(Je(),process.exit(0));(Z.includes("--version")||Z.includes("-v"))&&(console.log(`Version: 1.3.0
Build: 801fe34f275c334fa6464d80128edb20067a2caa`),process.exit(0));var et=Z.find(o=>!o.startsWith("-"));et||(console.error("Error: No input file specified."),Je(),process.exit(1));var Y=(0,Ye.resolve)(process.cwd(),et),tt;try{tt=(0,ae.readFileSync)(Y,"utf-8")}catch(o){console.error(`Error: Unable to read file '${Y}': ${o.message}`),process.exit(1)}var gs=new j,ps=Z.includes("--format"),st;try{st=gs.parseRules(tt)}catch(o){console.error(o.message),process.exit(1)}if(ps){let o=Xe(st);(0,ae.writeFileSync)(Y,o,{encoding:"utf-8"}),console.log(`File '${Y}' formatted successfully.`)}else console.log(`File '${Y}' is valid.`);
