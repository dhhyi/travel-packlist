import{a as at,b as ot,d as lt}from"./chunk-5bce0458.js";import{Ac as y,Bc as it,C as tt,Cc as ve,Dc as R,Y as de,_ as X,ba as L,ea as x,fb as E,ha as rt,i as Xe,la as me,q as et,sa as nt,ta as ee,vc as st}from"./chunk-fac6b1c2.js";import{a as D,b as he}from"./chunk-cb4c040a.js";function yr(n,i){!i?.injector&&me(yr);let e=i?.injector??x(nt),o=new Xe(1),c=R(()=>{let g;try{g=n();}catch(m){ve(()=>o.error(m));return;}ve(()=>o.next(g));},{injector:e,manualCleanup:!0});return e.get(ee).onDestroy(()=>{c.destroy(),o.complete();}),o.asObservable();}function Sr(n,i){let e=!i?.manualCleanup;e&&!i?.injector&&me(Sr);let o=e?i?.injector?.get(ee)??x(ee):null,c=xr(i?.equal),g;i?.requireSync?g=E({kind:0},{equal:c}):g=E({kind:1,value:i?.initialValue},{equal:c});let m=n.subscribe({next:v=>g.set({kind:1,value:v}),error:v=>{if(i?.rejectErrors)throw v;g.set({kind:2,error:v});}});if(i?.requireSync&&g().kind===0)throw new de(601,!1);return o?.onDestroy(m.unsubscribe.bind(m)),y(()=>{let v=g();switch(v.kind){case 1:return v.value;case 2:throw v.error;case 0:throw new de(601,!1);}},{equal:i?.equal});}function xr(n=Object.is){return(i,e)=>i.kind===1&&e.kind===1&&n(i.value,e.value);}function Er(n){return n.map(i=>i.toString()).map(i=>i+";").join(`

`);}function be(n,i,e=-1){if(!n)return"0g";let o=(e<0?n/1e3:(n/1e3).toFixed(e)).toString()+"kg",c=(n*1).toString()+"g";return i?i==="kg"?o:c:o.length<=c.length?o:c;}var V=class{condition;questions;items;constructor(i,e=[],o=[]){this.condition=i,this.questions=e,this.items=o;}toString(){let i=[];if(!(this.condition instanceof K)){let o=this.condition.toString();o&&i.push(o," ");}i.push(":-");let e=this.questions.map(o=>o.toString()).concat(this.items.map(o=>o.toString()));if(e.length===1&&i.length===1)i.push(" ",e[0]);else for(let o=0;o<e.length;o++){let c=e[o];o>0&&i.push(","),i.push(`
`,"   ",c);}return i.join("");}},N=class{question;variable;static NEW_QUESTION_NAME="New Question";static NEW_VARIABLE_NAME="new_variable";constructor(i,e){this.question=i,this.variable=e;}toString(){return this.question+" $"+this.variable;}},z=class{category;name;weight;static NEW_ITEM_NAME="New Item";static NEW_CATEGORY_NAME="New";constructor(i,e,o){this.category=i,this.name=e,this.weight=o;}toString(){let i=`[${this.category}] ${this.name}`.trim();return this.weight&&(i+=" "+be(this.weight)),i;}},j=class{variable;constructor(i){this.variable=i;}evaluate(i){return i[this.variable];}toString(){return this.variable;}},nn=(()=>{class n extends j{static string="please_select";constructor(){super(n.string);}}return n;})(),K=(()=>{class n extends j{static string="always";constructor(){super(n.string);}evaluate(){return!0;}}return n;})(),M=class{not;constructor(i){this.not=i;}evaluate(i){return!this.not.evaluate(i);}toString(){return"NOT "+this.not.toString();}},q=class{left;right;constructor(i,e){this.left=i,this.right=e;}evaluate(i){return this.left.evaluate(i)&&this.right.evaluate(i);}toString(){return this.left.toString()+" AND "+this.right.toString();}},F=class{left;right;constructor(i,e){this.left=i,this.right=e;}evaluate(i){return this.left.evaluate(i)||this.right.evaluate(i);}toString(){return this.left.toString()+" OR "+this.right.toString();}};function Rr(n,i){let e=i.filter(c=>c instanceof N),o=i.filter(c=>c instanceof z);return new V(n??new K(),e,o);}function ct(n){return n.length===1?n[0]:new q(n[0],ct(n.slice(1)));}function ut(n){return n.length===1?n[0]:new F(n[0],ut(n.slice(1)));}function Ar(n,i){function e(){this.constructor=n;}e.prototype=i.prototype,n.prototype=new e();}function W(n,i,e,o){var c=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(c,W.prototype),c.expected=i,c.found=e,c.location=o,c.name="SyntaxError",c;}Ar(W,Error);function we(n,i,e){return e=e||" ",n.length>i?n:(i-=n.length,e+=e.repeat(i),n+e.slice(0,i));}W.prototype.format=function(n){var i="Error: "+this.message;if(this.location){var e=null,o;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){e=n[o].text.split(/\r\n|\n|\r/g);break;}var c=this.location.start,g=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(c):c,m=this.location.source+":"+g.line+":"+g.column;if(e){var v=this.location.end,I=we("",g.line.toString().length," "),b=e[c.line-1],d=c.line===v.line?v.column:b.length+1,A=d-c.column||1;i+=`
 --> `+m+`
`+I+` |
`+g.line+" | "+b+`
`+I+" | "+we("",c.column-1," ")+we("",A,"^");}else i+=`
 at `+m;}return i;};W.buildMessage=function(n,i){var e={literal:function(b){return'"'+c(b.text)+'"';},class:function(b){var d=b.parts.map(function(A){return Array.isArray(A)?g(A[0])+"-"+g(A[1]):g(A);});return"["+(b.inverted?"^":"")+d.join("")+"]";},any:function(){return"any character";},end:function(){return"end of input";},other:function(b){return b.description;}};function o(b){return b.charCodeAt(0).toString(16).toUpperCase();}function c(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+o(d);}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+o(d);});}function g(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+o(d);}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+o(d);});}function m(b){return e[b.type](b);}function v(b){var d=b.map(m),A,U;if(d.sort(),d.length>0){for(A=1,U=1;A<d.length;A++)d[A-1]!==d[A]&&(d[U]=d[A],U++);d.length=U;}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1];}}function I(b){return b?'"'+c(b)+'"':"end of input";}return"Expected "+v(n)+" but "+I(i)+" found.";};function O(n,i){i=i!==void 0?i:{};var e={},o=i.grammarSource,c={Rules:qe,Rule:le,Condition:ze,Effects:Qe,Question:ue,Item:ge,VariableName:fe,QuestionString:He,ItemNameAndWeight:Ke,CategoryName:Be},g=qe,m=";",v=":-",I="OR",b="AND",d="NOT",A=",",U="$",At="[",kt="]",Re="kg",Ct="g",Ot=".",Ae=/^[^$,;#]/,Tt=/^[a-zA-Z]/,ke=/^[a-zA-Z0-9\-[\](){}_]/,Ce=/^[^\],;#[]/,It=/^[,;]/,Oe=/^[^ ,;#]/,G=/^[0-9]/,Te=/^[ \t\n\r]/,Dt=k("rule end"),jt=C(";",!1),Wt=k("rule"),Nt=C(":-",!1),J=k("condition"),Pt=C("OR",!1),Lt=C("AND",!1),oe=C("NOT",!1),Vt=C(",",!1),Ie=k("question"),Mt=C("$",!1),De=P(["$",",",";","#"],!0,!1),qt=k("variable name"),Ft=P([["a","z"],["A","Z"]],!1,!1),je=P([["a","z"],["A","Z"],["0","9"],"-","[","]","(",")","{","}","_"],!1,!1),zt=k("item"),Ut=k("category"),_t=C("[",!1),Qt=C("]",!1),Ht=k("category name"),We=P(["]",",",";","#","["],!0,!1),Bt=k("item name"),Kt=k("word"),Gt=P([",",";"],!1,!1),Ne=P([" ",",",";","#"],!0,!1),Jt=k("weight"),Yt=C("kg",!1),Zt=C("g",!1),Xt=k("number"),Y=P([["0","9"]],!1,!1),er=C(".",!1),tr=k("whitespace"),Pe=P([" ","	",`
`,"\r"],!1,!1),rr=mr(),nr=function(t,r){return Rr(t,r);},sr=function(t){return ut(t);},ir=function(t){return ct(t);},ar=function(t){return new M(t);},or=function(t){return new j(t);},lr=function(t,r){return new N(t.trim(),r.trim());},cr=function(t,r){let{name:a,weight:l}=r;return new z(t.trim(),a,l);},ur=function(t,r){return i.trackWeight;},fr=function(t,r){let a=t.trim();return a.length||Le("item name"),{name:a,weight:r};},gr=function(t){let r=t.trim();return r.length||Le("item name"),{name:r,weight:void 0};},pr=function(t){return t*1e3;},hr=function(){return parseFloat(dr());},s=i.peg$currPos|0,S=s,_=[{line:1,column:1}],T=s,Z=i.peg$maxFailExpected||[],u=i.peg$silentFails|0,Q;if(i.startRule){if(!(i.startRule in c))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');g=c[i.startRule];}function dr(){return n.substring(S,s);}function qr(){return S;}function Fr(){return{source:o,start:S,end:s};}function zr(){return H(S,s);}function Le(t,r){throw r=r!==void 0?r:H(S,s),Me([k(t)],n.substring(S,s),r);}function Ur(t,r){throw r=r!==void 0?r:H(S,s),br(t,r);}function C(t,r){return{type:"literal",text:t,ignoreCase:r};}function P(t,r,a){return{type:"class",parts:t,inverted:r,ignoreCase:a};}function mr(){return{type:"any"};}function vr(){return{type:"end"};}function k(t){return{type:"other",description:t};}function Ve(t){var r=_[t],a;if(r)return r;if(t>=_.length)a=_.length-1;else for(a=t;!_[--a];);for(r=_[a],r={line:r.line,column:r.column};a<t;)n.charCodeAt(a)===10?(r.line++,r.column=1):r.column++,a++;return _[t]=r,r;}function H(t,r,a){var l=Ve(t),f=Ve(r),h={source:o,start:{offset:t,line:l.line,column:l.column},end:{offset:r,line:f.line,column:f.column}};return a&&o&&typeof o.offset=="function"&&(h.start=o.offset(h.start),h.end=o.offset(h.end)),h;}function p(t){s<T||(s>T&&(T=s,Z=[]),Z.push(t));}function br(t,r){return new W(t,null,null,r);}function Me(t,r,a){return new W(W.buildMessage(t,r),t,r,a);}function qe(){var t,r,a,l,f,h;for(t=s,r=w(),a=[],l=le();l!==e;)a.push(l),l=s,f=Fe(),f!==e?(f=le(),f===e?(s=l,l=e):l=f):l=f;return l=Fe(),l===e&&(l=null),f=w(),h=Ze(),h!==e?t=a:(s=t,t=e),t;}function Fe(){var t,r,a,l;return u++,t=s,r=w(),n.charCodeAt(s)===59?(a=m,s++):(a=e,u===0&&p(jt)),a!==e?(l=w(),r=[r,a,l],t=r):(s=t,t=e),u--,t===e&&(r=e,u===0&&p(Dt)),t;}function le(){var t,r,a,l,f,h;return u++,t=s,r=ze(),r===e&&(r=null),a=w(),n.substr(s,2)===v?(l=v,s+=2):(l=e,u===0&&p(Nt)),l!==e?(f=w(),h=Qe(),S=t,t=nr(r,h)):(s=t,t=e),u--,t===e&&(r=e,u===0&&p(Wt)),t;}function ze(){var t,r;return u++,t=wr(),u--,t===e&&(r=e,u===0&&p(J)),t;}function wr(){var t,r,a,l,f,h,$,B;for(u++,t=s,r=s,a=[],l=Ue();l!==e;)a.push(l),l=s,f=s,h=w(),n.substr(s,2)===I?($=I,s+=2):($=e,u===0&&p(Pt)),$!==e?(B=w(),h=[h,$,B],f=h):(s=f,f=e),f!==e?(f=Ue(),f===e?(s=l,l=e):l=f):l=f;return a.length<1?(s=r,r=e):r=a,r!==e&&(S=t,r=sr(r)),t=r,u--,t===e&&(r=e,u===0&&p(J)),t;}function Ue(){var t,r,a,l,f,h,$,B;for(u++,t=s,r=s,a=[],l=ce();l!==e;)a.push(l),l=s,f=s,h=w(),n.substr(s,3)===b?($=b,s+=3):($=e,u===0&&p(Lt)),$!==e?(B=w(),h=[h,$,B],f=h):(s=f,f=e),f!==e?(f=ce(),f===e?(s=l,l=e):l=f):l=f;return a.length<1?(s=r,r=e):r=a,r!==e&&(S=t,r=ir(r)),t=r,u--,t===e&&(r=e,u===0&&p(J)),t;}function ce(){var t,r,a,l,f,h;return u++,t=s,n.substr(s,3)===d?(r=d,s+=3):(r=e,u===0&&p(oe)),r!==e?(a=w(),n.substr(s,3)===d?(l=d,s+=3):(l=e,u===0&&p(oe)),l!==e?(f=w(),h=ce(),h!==e?t=h:(s=t,t=e)):(s=t,t=e)):(s=t,t=e),t===e&&(t=s,n.substr(s,3)===d?(r=d,s+=3):(r=e,u===0&&p(oe)),r!==e?(a=w(),l=_e(),l!==e?(S=t,t=ar(l)):(s=t,t=e)):(s=t,t=e),t===e&&(t=s,r=_e(),r!==e?t=r:(s=t,t=e))),u--,t===e&&(r=e,u===0&&p(J)),t;}function _e(){var t,r;return t=s,r=fe(),r!==e&&(S=t,r=or(r)),t=r,t;}function Qe(){var t,r,a,l,f,h,$;for(t=s,r=[],a=ue(),a===e&&(a=ge());a!==e;)r.push(a),a=s,l=s,f=w(),n.charCodeAt(s)===44?(h=A,s++):(h=e,u===0&&p(Vt)),h!==e?($=w(),f=[f,h,$],l=f):(s=l,l=e),l!==e?(l=ue(),l===e&&(l=ge()),l===e?(s=a,a=e):a=l):a=l;return t=r,t;}function ue(){var t,r,a,l;return u++,t=s,r=He(),r!==e?(n.charCodeAt(s)===36?(a=U,s++):(a=e,u===0&&p(Mt)),a!==e?(l=fe(),l!==e?(S=t,t=lr(r,l)):(s=t,t=e)):(s=t,t=e)):(s=t,t=e),u--,t===e&&(r=e,u===0&&p(Ie)),t;}function He(){var t,r,a;if(u++,t=s,r=[],a=n.charAt(s),Ae.test(a)?s++:(a=e,u===0&&p(De)),a!==e)for(;a!==e;)r.push(a),a=n.charAt(s),Ae.test(a)?s++:(a=e,u===0&&p(De));else r=e;return r!==e?t=n.substring(t,s):t=r,u--,t===e&&(r=e,u===0&&p(Ie)),t;}function fe(){var t,r,a,l,f;if(u++,t=s,r=s,a=n.charAt(s),Tt.test(a)?s++:(a=e,u===0&&p(Ft)),a!==e){for(l=[],f=n.charAt(s),ke.test(f)?s++:(f=e,u===0&&p(je));f!==e;)l.push(f),f=n.charAt(s),ke.test(f)?s++:(f=e,u===0&&p(je));a=[a,l],r=a;}else s=r,r=e;return r!==e?t=n.substring(t,s):t=r,u--,t===e&&(r=e,u===0&&p(qt)),t;}function ge(){var t,r,a,l;return u++,t=s,r=$r(),r!==e?(a=w(),l=Ke(),l!==e?(S=t,t=cr(r,l)):(s=t,t=e)):(s=t,t=e),u--,t===e&&(r=e,u===0&&p(zt)),t;}function $r(){var t,r,a,l,f,h;return u++,t=s,n.charCodeAt(s)===91?(r=At,s++):(r=e,u===0&&p(_t)),r!==e?(a=w(),l=Be(),l!==e?(f=w(),n.charCodeAt(s)===93?(h=kt,s++):(h=e,u===0&&p(Qt)),h!==e?t=l:(s=t,t=e)):(s=t,t=e)):(s=t,t=e),u--,t===e&&(r=e,u===0&&p(Ut)),t;}function Be(){var t,r,a;if(u++,t=s,r=[],a=n.charAt(s),Ce.test(a)?s++:(a=e,u===0&&p(We)),a!==e)for(;a!==e;)r.push(a),a=n.charAt(s),Ce.test(a)?s++:(a=e,u===0&&p(We));else r=e;return r!==e?t=n.substring(t,s):t=r,u--,t===e&&(r=e,u===0&&p(Ht)),t;}function Ke(){var t,r,a,l,f;for(u++,t=s,r=s,a=[],l=Ge();l!==e;)a.push(l),l=s,f=w(),f=Ge(),f===e?(s=l,l=e):l=f;if(r=n.substring(r,s),a=w(),l=Je(),l!==e?(S=s,f=ur(r,l),f?f=void 0:f=e,f!==e?(S=t,t=fr(r,l)):(s=t,t=e)):(s=t,t=e),t===e){for(t=s,r=s,a=[],l=pe();l!==e;)a.push(l),l=s,f=w(),f=pe(),f===e?(s=l,l=e):l=f;r=n.substring(r,s),S=t,r=gr(r),t=r;}return u--,t===e&&(r=e,u===0&&p(Bt)),t;}function Ge(){var t,r,a,l,f,h;return u++,t=s,r=s,u++,a=s,l=Je(),l!==e?(f=w(),h=Ze(),h===e&&(h=n.charAt(s),It.test(h)?s++:(h=e,u===0&&p(Gt))),h!==e?(l=[l,f,h],a=l):(s=a,a=e)):(s=a,a=e),u--,a===e?r=void 0:(s=r,r=e),r!==e?(a=pe(),a!==e?t=a:(s=t,t=e)):(s=t,t=e),u--,t===e&&(r=e,u===0&&p(Kt)),t;}function pe(){var t,r,a;if(t=s,r=[],a=n.charAt(s),Oe.test(a)?s++:(a=e,u===0&&p(Ne)),a!==e)for(;a!==e;)r.push(a),a=n.charAt(s),Oe.test(a)?s++:(a=e,u===0&&p(Ne));else r=e;return r!==e?t=n.substring(t,s):t=r,t;}function Je(){var t,r,a;return u++,t=s,r=Ye(),r!==e?(n.substr(s,2)===Re?(a=Re,s+=2):(a=e,u===0&&p(Yt)),a!==e?(S=t,t=pr(r)):(s=t,t=e)):(s=t,t=e),t===e&&(t=s,r=Ye(),r!==e?(n.charCodeAt(s)===103?(a=Ct,s++):(a=e,u===0&&p(Zt)),a===e&&(a=null),t=r):(s=t,t=e)),u--,t===e&&(r=e,u===0&&p(Jt)),t;}function Ye(){var t,r,a,l,f,h,$;if(u++,t=s,r=[],a=n.charAt(s),G.test(a)?s++:(a=e,u===0&&p(Y)),a!==e)for(;a!==e;)r.push(a),a=n.charAt(s),G.test(a)?s++:(a=e,u===0&&p(Y));else r=e;if(r!==e){if(a=s,n.charCodeAt(s)===46?(l=Ot,s++):(l=e,u===0&&p(er)),l!==e){if(f=s,h=[],$=n.charAt(s),G.test($)?s++:($=e,u===0&&p(Y)),$!==e)for(;$!==e;)h.push($),$=n.charAt(s),G.test($)?s++:($=e,u===0&&p(Y));else h=e;h!==e?f=n.substring(f,s):f=h,f!==e?(l=[l,f],a=l):(s=a,a=e);}else s=a,a=e;a===e&&(a=null),S=t,t=hr();}else s=t,t=e;return u--,t===e&&(r=e,u===0&&p(Xt)),t;}function w(){var t,r;for(u++,t=[],r=n.charAt(s),Te.test(r)?s++:(r=e,u===0&&p(Pe));r!==e;)t.push(r),r=n.charAt(s),Te.test(r)?s++:(r=e,u===0&&p(Pe));return u--,r=e,u===0&&p(tr),t;}function Ze(){var t,r;return t=s,u++,n.length>s?(r=n.charAt(s),s++):(r=e,u===0&&p(rr)),u--,r===e?t=void 0:(s=t,t=e),t;}if(Q=g(),i.peg$library)return{peg$result:Q,peg$currPos:s,peg$FAILED:e,peg$maxFailExpected:Z,peg$maxFailPos:T};if(Q!==e&&s===n.length)return Q;throw Q!==e&&s<n.length&&p(vr()),Me(Z,T<n.length?n.charAt(T):null,T<n.length?H(T,T+1):H(T,T));}var Cr={isTrackWeight:()=>!1},Or=new L("PARSER_CONFIG_PROVIDER"),te=(()=>{class n{config=x(Or,{optional:!0})??Cr;isTrackWeight(){return this.config.isTrackWeight();}makeOptions(e,o={}){return{startRule:e,trackWeight:o.forceWeightTracking??this.isTrackWeight()};}parseCondition(e){return O(e,this.makeOptions("Condition"));}parseQuestion(e){return O(e,this.makeOptions("Question"));}parseItem(e){return O(e,this.makeOptions("Item"));}parseEffects(e){return O(e,this.makeOptions("Effects"));}parseRule(e){return O(e,this.makeOptions("Rule"));}parseRules(e){let o=e.split(/\r?\n/g).map(c=>c.replace(/#.*/,"")).join(`
`);try{return O(o,this.makeOptions("Rules"));}catch(c){let g=[];if(g.push("Error parsing rules"),c instanceof W){let m=c.location.start.line.toString(),v=c.location.start.column.toString();g.push(" at line ",m," column ",v),g.push(":",`
`,c.message);}else console.error(c);throw new Error(g.join(""));}}validateVariableName(e){O(e,this.makeOptions("VariableName"));}validateQuestionString(e){O(e,this.makeOptions("QuestionString"));}validateItemNameAndWeight(e){O(e,this.makeOptions("ItemNameAndWeight"));}validateCategoryName(e){O(e,this.makeOptions("CategoryName"));}forceParseWeight(e){return O(e,this.makeOptions("ItemNameAndWeight",{forceWeightTracking:!0})).weight??0;}static ɵfac=function(o){return new(o||n)();};static ɵprov=X({token:n,factory:n.ɵfac,providedIn:"root"});}return n;})();var $e=(()=>{class n{parser=x(te);extractVariables(e){return e.reduce((o,c)=>[...o,...c.questions.map(g=>g.variable)],[]);}extractCategories(e){let o=new Set();for(let c of e)for(let g of c.items)o.add(g.category);return Array.from(o);}renameVariable(e,o,c){if(c instanceof Array)return c.map(m=>this.renameVariable(e,o,m));if(c instanceof N)return c.variable===e?new N(c.question,o):c;if(c instanceof V)return new V(this.renameVariable(e,o,c.condition),c.questions.map(m=>this.renameVariable(e,o,m)),c.items);if(c instanceof j)return c.variable===e?new j(o):c;if(c instanceof M)return new M(this.renameVariable(e,o,c.not));if(c instanceof q)return new q(this.renameVariable(e,o,c.left),this.renameVariable(e,o,c.right));if(c instanceof F)return new F(this.renameVariable(e,o,c.left),this.renameVariable(e,o,c.right));let g=c;throw new Error("Unknown item type: "+g);}filterActive(e){let o=e.rules.filter(g=>g.condition.evaluate(e.model)),c=this.extractVariables(o).reduce((g,m)=>he(D({},g),{[m]:e.model[m]}),{[K.string]:!0});return o.length===e.rules.length?{model:c,rules:o}:this.filterActive({model:c,rules:o});}contains(e,o){let c=o.toLowerCase();if(e instanceof V)return this.contains(e.condition,o)||e.questions.some(m=>this.contains(m,o))||e.items.some(m=>this.contains(m,o));if(e instanceof N)return e.question.toLowerCase().includes(c)||e.variable.toLowerCase().includes(c);if(e instanceof z)return e.category.toLowerCase().includes(c)||e.name.toLowerCase().includes(c);if(e instanceof j)return e.variable.toLowerCase().includes(c);if(e instanceof M)return this.contains(e.not,o);if(e instanceof q)return this.contains(e.left,o)||this.contains(e.right,o);if(e instanceof F)return this.contains(e.left,o)||this.contains(e.right,o);let g=e;throw new Error("Unknown item type: "+g);}countItemsAndWeights(e){return e.reduce((o,c)=>c.items.reduce((g,m)=>{let v;return this.parser.isTrackWeight()?v=m.weight?1:0:v=this.parser.forceParseWeight(m.name)?1:0,{items:g.items+1,weights:g.weights+v};},o),{items:0,weights:0});}static ɵfac=function(o){return new(o||n)();};static ɵprov=X({token:n,factory:n.ɵfac,providedIn:"root"});}return n;})();var ft=`:-
   [Utility] Paper Tissues,
   [Utility] Backpack;

:- Are you traveling longer than 3 days? $longer;

longer :-
   Do you have a washer or laundry service available? $laundry,
   Do you want to work? $work,
   [Electronics] Phone Charger,
   [Electronics] Tablet;

longer AND NOT laundry :-
   [Clothes] enough Shirts,
   [Clothes] enough Underwear,
   [Clothes] spare Pants;

laundry :-
   [Clothes] 3 Shirts,
   [Clothes] 3 sets of Underwear;

work :-
   [Electronics] Laptop;

:-
   Will it be sunny? $sunny,
   Will it be rainy? $rainy,
   Are you traveling abroad? $abroad;

sunny :-
   Do you expect a high UV index? $uv,
   [Utility] Sunglasses,
   [Clothes] Short Pants;

rainy :-
   [Clothes] Rain Jacket;

NOT rainy :-
   [Clothes] Jacket;

NOT sunny :-
   [Clothes] Long Pants;

uv :-
   [Utility] Sunscreen;

abroad :-
   [Documents] Passport,
   [Documents] Visa;
`;var gt=`:-
   [N\xFCtzliches] Papiertaschent\xFCcher,
   [N\xFCtzliches] Rucksack;

:- Reist du l\xE4nger als 3 Tage? $longer;

longer :-
   Hast du eine Waschmaschine oder einen W\xE4scheservice zur Verf\xFCgung? $laundry,
   Willst du arbeiten? $work,
   [Elektronik] Handy-Ladeger\xE4t,
   [Elektronik] Tablet;

longer AND NOT laundry :-
   [Kleidung] genug Hemden,
   [Kleidung] genug Unterw\xE4sche,
   [Kleidung] Ersatzhosen;

laundry :-
   [Kleidung] 3 Hemden,
   [Kleidung] 3 S\xE4tze Unterw\xE4sche;

work :-
   [Elektronik] Laptop;

:-
   Wird es sonnig sein? $sunny,
   Wird es regnerisch sein? $rainy,
   Reist du ins Ausland? $abroad;

sunny :-
   Erwartest du einen hohen UV-Index? $uv,
   [N\xFCtzliches] Sonnenbrille,
   [Kleidung] Kurze Hosen;

rainy :-
   [Kleidung] Regenjacke;

NOT rainy :-
   [Kleidung] Jacke;

NOT sunny :-
   [Kleidung] Lange Hosen;

uv :-
   [N\xFCtzliches] Sonnencreme;

abroad :-
   [Dokumente] Reisepass,
   [Dokumente] Visum;
`;var ye=new L("RULES_TEMPLATE");function Tr(n){return n.startsWith("de")?gt:ft;}function On(){return rt([{provide:ye,useFactory:Tr,deps:[st]}]);}function re(n,i){let e=n.getItem("state"),o;if(e){let c=JSON.parse(e);o=D(D({},i),c);}else o=D({},i);return o;}function pt(n,i){if(typeof n!=typeof i)return!1;if(n&&i&&typeof n=="object"){let e=Object.keys(n),o=Object.keys(i);return e.length===o.length&&e.every(c=>pt(n[c],i[c]));}return n===i;}function Ir(n,i){let e=Object.keys(i).filter(o=>!pt(n[o],i[o])).map(o=>[o,n[o]]);return e.length===0?null:Object.fromEntries(e);}function ne(n,i,e){let o=Ir(i,e);o===null?n.removeItem("state"):n.setItem("state",JSON.stringify(o));}var ht=["en","de"],Se={rules:void 0,answers:{},checkedItems:[],collapsedCategories:[],categorySorting:"alphabetically",trackWeight:!1,answersLocked:!1,fadeOutDisabledRules:!1,highlightVariableStatus:!1,refactorVariables:!0,theme:"system",fontSize:"normal",accessibility:"accessible",language:"auto",exportReminder:!1,lastExportHash:"",lastExportDate:0},se=re(localStorage,Se);function Dr(){ne(localStorage,se,Se);}var jr=function(n){let i=E(se[n]);return R(()=>{let e=i();e!==se[n]&&(se[n]=e,Dr());},{manualCleanup:!0}),R(()=>{this.triggerReset()&&i.set(Se[n]);}),i;},dt=n=>{let i=jr.bind({triggerReset:n}),e=x(ye),o=i("rules"),c=it(()=>o()??e);return R(()=>{let g=c();o.set(g===e?void 0:g);}),{rules:{raw:c,customized:y(()=>!!o())},packlist:{answers:i("answers"),checkedItems:i("checkedItems"),collapsedCategories:i("collapsedCategories"),answersLocked:i("answersLocked")},config:{categorySorting:i("categorySorting"),trackWeight:i("trackWeight"),fadeOutDisabledRules:i("fadeOutDisabledRules"),highlightVariableStatus:i("highlightVariableStatus"),refactorVariables:i("refactorVariables"),theme:i("theme"),fontSize:i("fontSize"),accessibility:i("accessibility"),language:i("language"),exportReminder:i("exportReminder")},export:{lastHash:i("lastExportHash"),lastDate:i("lastExportDate")}};};var xe={rulesMode:"view",filterRulesQuery:void 0},mt=(n,i)=>{let e=x(lt),o=x(ot),c=E(void 0);return e.events.pipe(tt(g=>g instanceof at),et(()=>o.snapshot.queryParams[n]??xe[n])).subscribe(g=>{g!==""&&c.set(g);}),R(()=>{let g=c()||void 0;g===xe[n]&&(g=void 0),o.snapshot.queryParams[n]!==g&&e.navigate([],{queryParams:{[n]:g},queryParamsHandling:"merge",relativeTo:o,replaceUrl:!0});}),R(()=>{i()&&c.set(xe[n]);}),c;},vt=n=>({router:{rulesMode:mt("rulesMode",n),filterRulesQuery:mt("filterRulesQuery",n)}});var Ee={clipboardItems:[],clipboardQuestions:[]},ie=re(sessionStorage,Ee),bt=(n,i)=>{let e=E(ie[n]);return R(()=>{let o=e();o!==ie[n]&&(ie[n]=o,Wr());},{manualCleanup:!0}),R(()=>{i()&&e.set(Ee[n]);}),e;},Wr=()=>{ne(sessionStorage,ie,Ee);},wt=n=>({clipboard:{items:bt("clipboardItems",n),questions:bt("clipboardQuestions",n)}});var Nr=(n,i)=>{let e=E(n);return R(()=>{i()&&e.set(n);}),e;},$t=n=>({serviceWorker:{status:Nr("init",n)}});var yt=({config:{language:n}})=>{let i=E(window.scrollY);return window.addEventListener("scroll",()=>{i.set(window.scrollY);}),{browser:{scrollY:i,isMobile:y(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(navigator.userAgent))},config:{preferredLanguage:y(()=>{let e=n();return e==="auto"?navigator.languages.map(g=>g.split("-")[0]).find(g=>ht.includes(g))??"en":e;})}};};var St=({rules:{parsed:n},packlist:{answers:i}})=>{let e=x($e),o=y(()=>e.filterActive({rules:n(),model:i()})),c=y(()=>o().rules);return{rules:{categories:y(()=>e.extractCategories(n())),variables:y(()=>e.extractVariables(n()))},active:{rules:c,answers:y(()=>o().model),questions:y(()=>c().flatMap(g=>g.questions)),items:y(()=>c().flatMap(g=>g.items))}};};var xt=({rules:{raw:n,customized:i},export:{lastHash:e}})=>{let o=x(te),c=y(()=>{try{return{parsedRules:o.parseRules(n()),ruleParserError:""};}catch(v){v instanceof Error?console.warn(v.message):console.error(v);let I=v instanceof Error?v.message:"An unknown error occurred";return{parsedRules:[],ruleParserError:I};}}),g=E(new Date().getTime());R(()=>{n(),g.set(new Date().getTime());});let m=y(()=>Pr(n()).toString(16));return{rules:{parsed:y(()=>c().parsedRules),parserError:y(()=>c().ruleParserError),lastAction:g,hash:m,exportNeeded:y(()=>i()&&m()!==e())}};},Pr=function(n,i=0){let e=3735928559^i,o=1103547991^i;for(let c=0,g;c<n.length;c++)g=n.charCodeAt(c),e=Math.imul(e^g,2654435761),o=Math.imul(o^g,1597334677);return e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(o^o>>>13,3266489909),o=Math.imul(o^o>>>16,2246822507),o^=Math.imul(e^e>>>13,3266489909),4294967296*(2097151&o)+(e>>>0);};function Et(n,i){return Object.entries(n).concat(Object.entries(i)).reduce((e,[o,c])=>(e[o]=D(D({},e[o]),c),e),{});}var ae=class n{state;triggerReset;constructor(i,e){this.state=i,this.triggerReset=e;}static builder(){return new n({},E(!1));}extend(i){let e=i(this.triggerReset);return new n(Et(this.state,e),this.triggerReset);}derive(i){return new n(Et(this.state,i(this.state)),this.triggerReset);}build(){return this.state;}reset(){this.triggerReset.set(Date.now());}};function Lr(){return ae.builder().extend(dt).extend(vt).extend(wt).extend($t).derive(yt).derive(xt).derive(St);}var Rt=new L("STATE_BUILDER",{providedIn:"root",factory:()=>Lr()}),Vr=new L("GLOBAL_STATE",{providedIn:"root",factory:()=>x(Rt).build()}),Mr=new L("RESET_SWITCH",{providedIn:"root",factory:()=>{let n=x(Rt);return()=>{n.reset();};}});export{yr as a,Sr as b,On as c,Er as d,be as e,V as f,N as g,z as h,j as i,nn as j,K as k,M as l,q as m,F as n,W as o,Or as p,te as q,$e as r,Vr as s,Mr as t};/**i18n:015bdb808d2848989c3b91cbfc9cad629f58047ff6617f7ac5d9a7ed8c5b6894*/